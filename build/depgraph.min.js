/*! depgraph 04-09-2013 */
!function(){function a(){var a={};return a.windowOpenPost=function(b,c){a.windowOpenPostForm='<form id="depgraphlibWindowOpenPostForm" method="post" action="'+c+'" target="_blank"></form>';var d=jQuery("#depgraphlibWindowOpenPostForm");d.length||(d=jQuery(a.windowOpenPostForm),jQuery("body").append(d)),d.html("");for(param in b){var e=null;e="string"==typeof b[param]?b[param]:JSON.stringify(b[param]),d.append('<input type="hidden" name="'+param+'" value="">'),d[0][param].value=e}document.getElementById("depgraphlibWindowOpenPostForm").submit()},a.clone=function(b){if(null==b||"object"!=typeof b)return b;if(b instanceof Date){var c=new Date;return c.setTime(b.getTime()),c}if(b instanceof Array){for(var c=[],d=0,e=b.length;e>d;d++)c[d]=a.clone(b[d]);return c}if(b instanceof Object){var c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a.clone(b[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")},a.setGroupPosition=function(a,b,c){a.attr("transform","translate("+b+","+c+")")},a.center=function(a,b){var c=b.node().getBBox(),d=a.node().getBBox();a.attr("x",-d.width/2+c.width/2)},a.getTransformValues=function(a){for(var b,c=a.attr("transform"),d=/(\w+)\((.*?)\)/g,e=new Object;null!=(b=d.exec(c));){var f=/(-*\w+\.*\w*)/g;e[b[1]]=[];for(var g;null!=(g=f.exec(b[2]));)e[b[1]].push(parseFloat(g[1]))}return e},a.JSONresolveReferences=function(a,b){function c(a,b,d,e){for(var f in a)if(a.hasOwnProperty(f))if("id"!=f){var g=typeof a[f];if("object"==g)c(a[f],b,d,e);else if("string"==g&&0==a[f].indexOf(b)){var h=a[f].substring(1);null!=d[h]?(a[f]=d[h],c(a[f],b,d,e)):e.push[a[f]]}}else d[a[f]]=a}var d=[],e=[];c(a,b,d,e);for(elt in e){if(null==d[elt])throw"This object has missing references!";elt=d[elt]}},a.removeUnit=function(a){var b=/(-*)(\d+\.*\d*)px/,c=b.exec(a);if(null!=c){var d=0==c[1].length%2?"":"-";a=d+c[2]}return parseFloat(a)},a.addPxs=function(){for(var b=0,c=0;c<arguments.length;c++){var d=a.removeUnit(arguments[c]);b+=parseInt(d)}return b+"px"},a.rgbToHex=function(a,b,c){return"#"+((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},a.hexToRgb=function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},a.rgbToHsl=function(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f==g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}},a.hslToRgb=function(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a}var e,f,g;if(0==b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return{r:Math.floor(255*e),g:Math.floor(255*f),b:Math.floor(255*g)}},window.depgraphlib=a,a}"undefined"==typeof define?a():define(a)}(),function(){function a(a){function b(){var a=jQuery(this),b=f.getInstance(a[0].id);a.parent().animate({bottom:"0px"}),a.removeClass("slide-up"),a.addClass("slide-down"),b.mainpanel.css("border","1px solid grey")}function c(){var a=jQuery(this),b=f.getInstance(a[0].id),c=a.parent();c.animate({bottom:-c.height()+20+"px"}),a.removeClass("slide-down"),a.addClass("slide-up"),b.mainpanel.css("border","none")}function d(){var a=jQuery(this);a.hasClass("slide-up")?b.call(a):c.call(a)}function e(a){for(var b=0;b<a.length;b++)a[b].method.call(a[b].caller,a[b].args)}var f=function(a,b){null==b&&(b=Math.floor(1e16*Math.random()).toString()),this.allowFullScreen=!0,this.imagemode=!1,this.debugPanelActive=!1,this.fixedToolbar=!1,this._height="600px",this._width="100%",this.basemargin=10,this.margin={top:100,left:0,right:0,bottom:10},this.borders=!0,f.instances[b]&&(b+="_");var b=this.uid=b;"string"==typeof a&&(a=jQuery(a));var a=this.container=a;a.css("display","inline-block");var c=this.mainpanel=this.createDiv("gv-main-panel","gv-main-panel");a.append(c);var d=this.chart=this.createDiv("gv-chart","gv-chart");c.append(d),this.toolbar=this.initToolBar(),this.debugpanel=this.createDebugPanel(),this.tooltip=this.createToolTipPanel(),this.tooltip.hide(),this.altpanel=this.createDiv("gv-alt-panel","gv-alt-panel"),this.altpanelcontent=this.createDiv("alt-panel-content","alt-panel-content"),this.ajaxLoader=this.createDiv("ajax-loader","ajax-loader"),this.ajaxLoader.hide(),this.mainpanel.append(this.ajaxLoader),this.extraDiv=this.createDiv("gv-extra","gv-extra"),this.extraDiv.hide(),this.mainpanel.append(this.extraDiv),c.append(this.tooltip),c.append(this.altpanel),this.altpanel.append(this.altpanelcontent),f.instances[b]=this,this.callbacks=new Object,this.callbacks.fullscreen=new Object,this.callbacks.fullscreen.oncomplete=[],this.callbacks.fullscreen.onclose=[],this.callbacks.showaltpanel=[],this.callbacks.hidealtpanel=[],this.toolbar.hide(),this.toolbar_landing_area.hover(function(){var a=f.getInstance(this);a.fixedToolbar||(0==a.toolbar.queue().length?(a.toolbar.slideDown(100,function(){1==a.toolbar.queue("depgraph_toolbar_hiding_bufferqueue").length%2&&a.toolbar.dequeue("depgraph_toolbar_hiding_bufferqueue")}),a.mainpanel.css("border","1px solid grey")):a.toolbar.slideDown({duration:100,queue:"depgraph_toolbar_hiding_bufferqueue"}))},function(){var a=f.getInstance(this);a.fixedToolbar||(0==a.toolbar.queue().length?(a.toolbar.slideUp(100,function(){1==a.toolbar.queue("depgraph_toolbar_hiding_bufferqueue").length%2&&a.toolbar.dequeue("depgraph_toolbar_hiding_bufferqueue")}),a.borders||a.mainpanel.css("border","none")):a.toolbar.slideUp({duration:100,queue:"depgraph_toolbar_hiding_bufferqueue"}))})};return f.instances=f.instances||[],f.getInstance=function(a){var b="";if(f.prototype.isPrototypeOf(a))return a;b=null!=a.ownerSVGElement?a.ownerSVGElement.parentNode.id:"object"==typeof a&&null!=a.id?a.id:a,regex=/.*-(\w+)/;var c=regex.exec(b),d=null;return null!=c&&(d=f.instances[c[1]]),null==d&&(d=f.getInstance(a.parentNode)),d},f.prototype.initToolBar=function(){var a=this.toolbar_landing_area=this.createDiv("gv-toolbar-landing-area","gv-toolbar-landing-area"),b=this.createDiv("gv-toolbar","gv-toolbar");a.append(b),this.mainpanel.append(this.toolbar_landing_area);var c=this.toolbarbuttons=this.createDiv("gv-toolbarbuttons","gv-toolbarbuttons");return b.append(c),this.addFullScreenButton(),b},f.prototype.createDebugPanel=function(){var a=this.debugpanel=this.createDiv("gv-debug-panel","gv-debug-panel");this.debugpanelinfo=this.createDiv("debug-panel-info","debug-panel-info"),a.append(this.debugpanelinfo);var b=this.createDiv("debug-panel-slider","debug-panel-slider slider-button slide-up");b.click(d),a.append(b);var e=this.createDiv("debug-panel-fullscreen","debug-panel-fullscreen slider-button maximize");e.click(function(){var a=f.getInstance(this);if(null!=a){a.viewAltContent("debug-panel-content"+a.appendOwnID(""));var b=jQuery("#debug-panel-slider"+a.appendOwnID(""));b.hasClass("slide-down")&&c.call(b)}}),a.append(e);var g=this.debugcontentcontainer=this.createDiv("debug-panel-container","debug-panel-container");return a.append(g),this.debugpanelcontent=this.createDiv("debug-panel-content","debug-panel-content"),g.append(this.debugpanelcontent),this.mainpanel.append(a),this.adjustDebugHeight(),a.hide(),a},f.prototype.debugLog=function(a){this.debugpanelcontent.append(a+"<br/>")},f.prototype.createToolTipPanel=function(){var a=this;this.tooltip=this.createDiv("gv-tooltip","gv-tooltip");var b=jQuery('<div style="display:inline-block;"></div>');return this.tooltip.append(b),this.tooltipExitButton=this.createDiv("tooltip-exit-button","tooltip-exit-button"),this.tooltipExitButton.css("float","right"),this.tooltipExitButton.css("display","block"),this.tooltipExitButton.click(function(){a.hideToolTip()}),b.append(this.tooltipExitButton),this.tooltipExitButton.hide(),this.tooltip.draggable(),this.tooltipContainer=this.createDiv("tooltip-container"),b.append(this.tooltipContainer),this.tooltip},f.prototype.appendOwnID=function(a){return a.endsWith(this.uid)?a:a+"-"+this.uid},f.prototype.addWrapper=function(a){var b=this,c=this.wrapper=b.createElement("a","gv-wrapper","gv-wrapper");return c.html(a),b.container.prepend(c),b.mainpanel.hide(),c.click(function(){b.mainpanel.toggle()}),c},f.prototype.createDiv=function(a,b){return this.createElement("div",a,b)},f.prototype.createElement=function(a,b,c){c=null!=c?'class="'+c+'"':"";var d="<"+a+' id="'+this.appendOwnID(b)+'" '+c+"></"+a+">";return jQuery(d)},f.prototype.adjustDebugHeight=function(){var a=this.mainpanel.height()-this.toolbar.height();this.debugpanel.css("height",a),this.debugcontentcontainer.css("height",a-20),this.debugpanel.css("bottom",-a+20)},f.prototype.shrinkHeightToContent=function(b){null==b&&(b=0);var c=d3.select(this.chart.children()[0]).select("g"),d=c.node().getBBox(),e=a.getTransformValues(c);this.setHeight(e.translate[1]+d.y*e.scale[0]+d.height*e.scale[0]+b*e.scale[0])},f.prototype.shrinkWidthToContent=function(b){null==b&&(b=0);var c=d3.select(this.chart.children()[0]).select("g"),d=c.node().getBBox(),e=a.getTransformValues(c);this.setWidth(e.translate[0]+d.x+d.width+marginLeft)},f.prototype.shrinkToContent=function(b,c){null==c&&(c=0),null==b&&(b=0);var d=d3.select(this.chart.children()[0]).select("g"),e=d.node().getBBox(),f=a.getTransformValues(d);this.mainpanel.width();var g=f.translate[0]+e.x+e.width+b;this.setSize(g,f.translate[1]+e.y+e.height+c)},f.prototype.setSize=function(a,b){this.setWidth(a),this.setHeight(b)},f.prototype.setImageMode=function(a){null==a&&(a=!0),this.imagemode=a,a?(this.toolbar.detach(),this.debugpanel.detach(),this.tooltip.detach()):(this.mainpanel.append(this.toolbar),this.mainpanel.append(this.debugpanel),this.mainpanel.append(this.tooltip)),this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20),this.margin.bottom=this.basemargin+(this.imagemode?0:20)},f.prototype.noBorders=function(){this.borders=!1,this.mainpanel.css("border","none")},f.prototype.debugMode=function(a){null==a&&(a=!0),this.debugPanelActive=a,a?this.debugpanel.show():this.debugpanel.hide()},f.prototype.setWidth=function(a){this._width=a,this.mainpanel.css("width",a),this.ajaxLoader.width(a)},f.prototype.setHeight=function(a){a+=30,this._height=a,this.mainpanel.css("height",a),this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20),this.margin.bottom=this.basemargin+this.imagemode?0:20,this.ajaxLoader.height(a-this.toolbar.height()),this.ajaxLoader.css("top",this.toolbar.height()),this.debugPanelActive&&this.adjustDebugHeight()},f.prototype.setFixedToolbar=function(a){null==a&&(a=!0),this.fixedToolbar=a,a?this.toolbar.show():this.toolbar.hide()},f.prototype.addFullScreenButton=function(){this.allowFullScreen&&"undefined"!=typeof this.container.colorbox&&(this.addToolbarButton("fullscreen",null,"right","fullscreen","View in fullscreen"),this.initFullscreenMode())},f.prototype.existToolbarButton=function(a){return jQuery("#button-"+this.appendOwnID(a)).length>0},f.prototype.getToolbarButton=function(a){return jQuery("#button-"+this.appendOwnID(a))},f.prototype.setToolbarButtons=function(a){this.tmpLeft=[],a.forEach(function(a){"left"==a[2]?this.tmpLeft.push(a):this.addToolbarButton(a[0],a[1],a[2],a[3],a[4])},this),this.tmpLeft.forEach(function(a){this.addToolbarButton(a[0],a[1],a[2],a[3],a[4])},this),this.tmpLeft=null},f.prototype.resetToolbarButtons=function(){var a=this.toolbarbuttons.children();a.remove(),this.addFullScreenButton()},f.prototype.addToolbarElement=function(a,b){a.css("float",b),this.toolbarbuttons.append(a)},f.prototype.addToolbarButton=function(a,b,c,d,e){var f="";null==d?(d="tab white",f=a):d+=" icon",null==c&&(c="left");var g='<div id="button-'+this.appendOwnID(a)+'" title="'+(e||a)+'" class="'+d+" tab "+c+'">'+f+"</div>";g=jQuery(g),g.click(b),this.toolbarbuttons.append(g)},f.prototype.removeToolbarButton=function(a){jQuery("#button-"+this.appendOwnID(a)).remove()},f.createDropDownMenu=function(a,b,c,d){var e=jQuery('<div class="gv-menu"><div class="gv-menu-header"></div><div class="gv-menu-body"></div></div>'),f=jQuery(".gv-menu-header",e),g=jQuery(".gv-menu-body",e);g.hide(),f.html(a),f.attr("title",d||a),f.addClass("white");for(i in b){var h=jQuery("<div>"+i+"</div>");h.attr("title",b[i].tt||i),g.append(h),jQuery(h).click(b[i].cb)}return c===!1?(jQuery(".gv-menu-header",e).click(function(a){jQuery(".gv-menu-body",a.currentTarget.parentNode).slideDown()}),jQuery(e).mouseleave(function(a){jQuery(".gv-menu-body",a.currentTarget).slideUp()})):e.hover(function(a){jQuery(".gv-menu-body",a.currentTarget).slideDown()},function(a){jQuery(".gv-menu-body",a.currentTarget).slideUp()}),e},f.prototype.viewAltContent=function(a){this.resetAltPanel(),this.addContentToAltPanel(a),this.showAltPanel()},f.prototype.hideAltPanel=function(){this.chart.show(),this.altpanel.hide(),this.removeToolbarButton("back"),e(this.callbacks.hidealtpanel)},f.prototype.showAltPanel=function(){this.chart.hide(),this.altpanel.show(),this.addToolbarButton("back",function(){f.getInstance(this.id).hideAltPanel()},"left","back"),e(this.callbacks.showaltpanel)},f.prototype.addContentToAltPanel=function(a,b){this.altpanelcontent.html(jQuery("#"+this.appendOwnID(a)).html()),null!=b&&this.addToolbarButton(b,function(){f.getInstance(this.id).addContentOnAltPanel(a)},"left")},f.prototype.resetAltPanel=function(){this.altpanelcontent.html("")},f.prototype.createBox=function(b){return b.viewer=this,new a.Box(b)},a.Box=function(b){var c=this;if(null!=b.viewer&&(a.Box.instances.push(this),this.viewer=b.viewer),this.object=jQuery('<div class="depgraphlib-box"><div class="depgraphlib-box-header"></div><div class="depgraphlib-box-content"></div><div class="depgraphlib-box-footer"></div></div>'),b.id&&this.object.attr("id",b.id),b.closeButton){var d=jQuery('<div class="tooltip-exit-button"/>');d.css("float","right"),d.css("display","block"),d.click(function(){c.close(!0)}),jQuery(".depgraphlib-box-header",this.object).append(d)}return b.position&&(this.object.css("top",b.position.y),this.object.css("left",b.position.x)),b.draggable&&this.object.draggable(),b.autodestroy&&(this.tooltipCreationBug=!0,d3.select(document).on("click.box_"+a.Box.instances.length,function(){c.tooltipCreationBug||jQuery.contains(c.object[0],d3.event.originalTarget)||c.destroy(),delete c.tooltipCreationBug})),jQuery("body").append(this.object),this},a.Box.prototype.setContent=function(a){var b=jQuery(".depgraphlib-box-content",this.object);return b.html(a.html()),this},a.Box.prototype.setHeader=function(){return this},a.Box.prototype.setFooter=function(){return this},a.Box.instances=a.Box.instances||[],a.Box.prototype.open=function(a){return a&&(this.object.css("top",a.y),this.object.css("left",a.x)),this.object.show(),this},a.Box.prototype.getDOM=function(a){return a?this.dom:this.object},a.Box.getBox=function(b){for(var c=0;c<a.Box.instances.length;++c)if(jQuery.contains(a.Box.instances[c],b))return a.Box.instances[c]},a.Box.prototype.close=function(a){a?this.destroy():this.object.hide()},a.Box.prototype.destroy=function(){this.object.remove()},f.prototype.loadTooltipContent=function(a){var b,c=f.getInstance(this);b="string"==typeof a?jQuery("#"+c.appendOwnID(a)):a,c.tooltipContainer.html(b.html())},f.prototype.showTooltip=function(a){var b=f.getInstance(this);b.tooltip.css("left",a.x),b.tooltip.css("top",a.y),b.tooltip.show()},f.prototype.hideToolTip=function(){var a=f.getInstance(this);a.tooltip.hide()},f.prototype.ajaxStart=function(){this.ajaxLoader.show()},f.prototype.ajaxFinished=function(){this.ajaxLoader.hide()},f.prototype.initFullscreenMode=function(){var a=this,b=jQuery("#button-fullscreen"+this.appendOwnID(""));b.colorbox({inline:!0,href:"#gv-main-panel"+a.appendOwnID(""),width:"95%",height:"95%",onLoad:function(){a.removeToolbarButton("fullscreen"),a.mainpanel.width("99%"),a.mainpanel.height("99%")},onComplete:function(){a.adjustDebugHeight(),e(a.callbacks.fullscreen.oncomplete)},onClosed:function(){a.mainpanel.width(a._width),a.mainpanel.height(a._height),a.addToolbarButton("fullscreen",null,"right","fullscreen"),a.adjustDebugHeight(),a.initFullscreenMode(),e(a.callbacks.fullscreen.onclose)}})},String.prototype.endsWith=function(a){return-1!==this.indexOf(a,this.length-a.length)},f.prototype.screenCoordsForElt=function(a){for(;"[object Array]"===Object.prototype.toString.call(a);)a=a[0];var b=a.getBBox(),c=this.chart[0].querySelector("svg"),d=c.createSVGPoint(),e={},f=a.getScreenCTM();return d.x=b.x,d.y=b.y,e.nw=d.matrixTransform(f),d.x+=b.width,e.ne=d.matrixTransform(f),d.y+=b.height,e.se=d.matrixTransform(f),d.x-=b.width,e.sw=d.matrixTransform(f),e},a.GraphViewer=f,f}"undefined"==typeof define?a(depgraphlib):define(["app/depgraphlib"],a)}(),function(){function a(a){function b(b,c,d){for(var e=c.split("/"),f=b,g=0;g<e.length-1;g++){var h=f[e[g]];"object"==typeof h&&(null==h&&(f[e[g]]=new Object),f=null,f=h)}var i=a.clone(f[e[e.length-1]]);return f[e[e.length-1]]=d,i}function c(b){if(b.editObject.highlightMode){var c=!a.isObjectPermanentHighlighted(this);return a.highlightObject(this,c,!0),b.editObject.setNeedToSave(),void 0}b.editObject.selectObject(this)}function d(a,b){if("linkRemoval"==b.baseAction){var c=b.link,d=a.getWordNodeByOriginalId(c.__data__.source),e=a.getWordNodeByOriginalId(c.__data__.target);w(a,d,e,c.__data__.label,c.color,c.__data__["#id"])}else if("linkAddition"==b.baseAction)x(a,b.addedLink["#id"]);else if("wordAddition"==b.baseAction)v(a,b.addedWord["#id"]);else if("wordRemoval"==b.baseAction){var f=b.word;if(t(a,f),null!=b.affectedLinks)for(var g=0;g<b.affectedLinks.length;g++){var c=b.affectedLinks[g],d=a.getWordNodeByOriginalId(c.source),e=a.getWordNodeByOriginalId(c.target);c.color=c["#style"]["link-color"]?c["#style"]["link-color"]:a.data.graph["#link-style"]["link-color"],w(a,d,e,c.label,c.color,c["#id"])}}else if("changeAttr"==b.baseAction){var h=b.obj["#id"],i=a.getObjectById(h);a.editObject.changeAttributes(i,b.oldAttrs),a.update(),a.postProcesses()}}function e(b,c){if(46==c.keyCode&&null!=b.editObject.previousSelectedObject)if(y(b.editObject.previousSelectedObject)){var d=a.clone(b.editObject.previousSelectedObject);d.color=a.getStyleElement(b.editObject.previousSelectedObject,"link-color","black");var e=x(b,b.editObject.previousSelectedObject.__data__["#id"]);if(b.editObject.previousSelectedObject=null,e)return{baseAction:"linkRemoval",link:d}}else if(z(b.editObject.previousSelectedObject)){var f=a.clone(b.editObject.previousSelectedObject.__data__),g=v(b,b.editObject.previousSelectedObject.__data__["#id"]);return b.editObject.previousSelectedObject=null,{baseAction:"wordRemoval",word:f,affectedLinks:g}}}function f(a,b){var c=a.viewer.screenCoordsForElt(b[0]),d={x:(c.ne.x+c.nw.x)/2,y:c.nw.y},e=n(a,b[0]);a.viewer.createBox({closeButton:!0,draggable:!0}).setContent(e).open(d)}function g(a,b,c){var d=null!=c["#style"]&&null!=c["#style"]["link-color"]?c["#style"]["link-color"]:a.data.graph["#link-style"]["link-color"];return b+='<tr><td>label</td><td><input type="text" name="label" value="'+c.label+'"></td></tr>',b+="<tr><td>source</td><td>"+k(a,c.source)+"</td></tr>",b+="<tr><td>target</td><td>"+k(a,c.target)+"</td></tr>",b+="<tr><td>color</td><td>"+j("colorPicker",d)+"</td></tr>"}function h(a,b,c){var d=a.editObject.dataModel;if(!d.words){d.words=[],d.words[0]={name:"label"};for(var e=0;e<c.sublabel.length;e++)d.words[e+1]={name:"sublabel"+e}}b+="<tr><td>"+d.words[0].name+'</td><td><input id="word-edit-'+d.words[0].name+'" type="text" name="'+d.words[0].name+'" value="'+c.label+'"></td></tr>';for(var e=1;e<d.words.length;e++)b+="<tr><td>"+d.words[e].name+'</td><td><input id="word-edit-'+d.words[e].name+'" type="text" name="'+d.words[e].name+'" value="'+c.sublabel[e-1]+'"></td></tr>';return b}function j(a,b){var c='<table><tr><td><input type="text" name="'+a+'" value="'+b+'" onkeydown="jQuery(jQuery(jQuery(this).parent().parent().children()[1]).children()[0]).css(\'background-color\',this.value+String.fromCharCode(event.keyCode));"></td><td><div style="display:inline-block; width:30px; height:30px; background-color:'+b+';"></div></td></tr></table>';return c}function k(a,b){for(var c="<select>",d=0;d<a.data.graph.words.length;d++){var e=a.data.graph.words[d];c+='<option value="'+e.id+'" ',c+=e.id==b?'selected="true"':"",c+=">#"+e["#position"]+" "+e.label+" ("+e.id+")",c+="</option>"}return c+="</select>"}function l(a){for(var b="<select>",c=0;c<a.data.graph.words.length+1;c++){var d=c>0&&c<a.data.graph.words.length+1?a.data.graph.words[c-1]:{label:"^"},e=c<a.data.graph.words.length?a.data.graph.words[c]:{label:"$"};b+='<option value="'+c+'" ',b+=">#"+c+" ("+d.label+" x "+e.label+")",b+="</option>"}return b+="</select>"}function m(a){var b="";return b+="<div><h3>Add a new word</h3>",b+="<table><tr>",b+="<td><label>Label</label></td>",b+='<td><input type="text" name="label"></td></tr>',b+="<tr><td><label>Sublabels (separated by commas, use \\, for commas)</label></td>",b+='<td><input type="text" name="sublabels"></td></tr>',b+="<tr><td><label>Position</label></td>",b+="<td>"+l(a)+"</td></tr>",b+="</table></div>"}function n(a,b){var c=b.__data__,d="";null!=b.classList&&b.classList.length>0&&(d=b.classList[0]);var e='<div><h3 id="edit-info-title">Edit '+d+" (original id: "+c.id+")</h3>"+'<table class="main-properties-table" ref="'+c["#id"]+'">';"word"==d?e=h(a,e,c):"link"==d&&(e=g(a,e,c)),e+="</table>",e+='<input id="'+a.viewer.appendOwnID(d+"-save-properties")+'" type="button" value="Save" onclick="depgraphlib.saveProperties.call(this,arguments);">',e+="</div>";var f=jQuery(e);return f}function o(){var b=this.id.substring(0,this.id.indexOf("-")),c=a.DepGraph.getInstance(this);c.viewer;var d=jQuery(this).parent().find("table.main-properties-table");"link"==b?p(c,d):"word"==b&&q(c,d),c.update(),c.postProcesses();var e=a.Box.getBox(this);e.destroy()}function p(a,b){for(var c=a.getLinkById(b.attr("ref")),d=b[0].rows,e=[],f=0;f<d.length;f++){var g=d[f],h=g.cells,i=h[0].innerHTML,j=h[1];"label"==i?e.push({path:"label",value:j.firstChild.value}):"color"==i?e.push({path:"#style/link-color",value:j.firstChild.rows[0].cells[0].firstChild.value}):"source"==i?e.push({path:"source",value:j.childNodes[0].options[j.childNodes[0].options.selectedIndex].value}):"target"==i&&e.push({path:"target",value:j.childNodes[0].options[j.childNodes[0].options.selectedIndex].value})}a.editObject.changeAttributes(c,e,!0)}function q(a,b){for(var c=a.getWordNodeById(b.attr("ref")).__data__,d=b[0].rows,e=[],f=0;f<d.length;f++){var g=d[f],h=g.cells;h[0].innerHTML;var i=h[1];0==f?e.push({path:"label",value:i.firstChild.value}):e.push({path:"sublabel/"+(f-1),value:i.firstChild.value})}a.editObject.changeAttributes(c,e,!0)}function r(a,b){if(null==a.editObject.previousSelectedObject||y(a.editObject.previousSelectedObject))c.call(this,a,b);else{if(this.__data__["#id"]==a.editObject.previousSelectedObject.__data__["#id"])return a.editObject.clearSelection(),void 0;s(a,a.editObject.previousSelectedObject,this,b)}}function s(a,b,c,d){var e=a.viewer.screenCoordsForElt(c),f={x:(e.ne.x+e.nw.x)/2,y:e.nw.y},g='<div><table style="margin:5px 0px 0px 0px;"><tr><td>Link name : </td><td><input type="text" name="link-name" value=""></td></tr><tr><td>Link color : </td><td><input type="text" name="link-color" value="black"></td></tr><tr><td colspant="2"><input id="link-settings'+a.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Create Link"></td></tr>'+"</table></div>";g=jQuery(g);var h=a.viewer.createBox({closeButton:!0,draggable:!0}).setContent(g).open(f);a.editObject.clearSelection(),jQuery("#link-settings"+a.viewer.appendOwnID("")).click(function(){var e=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value,f=this.parentNode.parentNode.parentNode.childNodes[1].childNodes[1].childNodes[0].value,g=w(a,b,c,e,f),i={baseAction:"linkAddition",addedLink:g};a.editObject.pushAction({mode:a.editObject.editMode,rollbackdata:i,data:{event:"onWordSelect",params:d}}),h.destroy()})}function t(b,c){var d=c["#position"];return b.insertWord(c,d),b.editObject.init(),b.autoHighLightOnMouseOver(),a.clone(c)}function u(a,b,c){var d=a.viewer.screenCoordsForElt(b),e={x:(d.ne.x+d.nw.x)/2,y:d.nw.y},f='<div><table style="margin:5px 0px 0px 0px;"><tr><td>Word label : </td><td><input type="text" name="word-label" value=""></td></tr><tr><td colspant="2"><input id="word-settings'+a.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Insert Word"></td></tr>'+"</table></div>";f=jQuery(f);var g=a.viewer.createBox({closeButton:!0,draggable:!0}).setContent(f).open(e);a.editObject.clearSelection(),jQuery("#word-settings"+a.viewer.appendOwnID("")).click(function(){var d=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value;if(null==d||""==d)return alert("you must fill all required fields"),void 0;var e={label:d,sublabel:[],"#position":b.__data__["#position"]+c},f=t(a,e),h={baseAction:"wordAddition",addedWord:f};a.editObject.pushAction({mode:a.editObject.editMode,rollbackdata:h,data:{event:"onWordContext",params:b}}),g.destroy()})}function v(a,b){var c=a.removeWord(b);return c}function w(a,b,c,d,e,f){null==e&&(e="black"),null==f&&(f=a.id++),b=b.__data__,c=c.__data__;var g=new Object;return g.source=b.id,g.target=c.id,g["#style"]={"link-color":e},g.label=d,g["#id"]=f,a.addLink(g),a.editObject.init(),a.autoHighLightOnMouseOver(),g}function x(a,b){var c=a.removeLink(b);return c}function y(a){return null!=a.__data__.target&&null!=a.__data__.source}function z(a){return null!=a.__data__["#position"]}function A(a){return null!=a.elements}var B=function(b){this.depgraph=b,this.editMode=!1,this.mode=[],this.highlightMode=!1,this.dataModel={},this.previousSelectedObject=null,this.actionsLog=[],this.currentPtr=-1,this.lastSavedPtr=-1,this.defaultMode={name:"default",onWordSelect:r,onLinkSelect:c,onChunkSelect:c,onWordContext:{"Show Infos":function(a,b){f(a,b)},"Add Node to the left":function(a,b){u(a,b[0],0)},"Add Node to the right":function(a,b){u(a,b[0],1)},Delete:function(b,c){var d=a.clone(c[0].__data__),e=v(b,c[0].__data__["#id"]);return b.editObject.previousSelectedObject=null,{baseAction:"wordRemoval",word:d,affectedLinks:e}}},onLinkContext:{"Show Infos":function(a,b){f(a,b)},Delete:function(b,c){var d=a.clone(c[0]);d.color=a.getStyleElement(c[0],"link-color","black");var e=x(b,c[0].__data__["#id"]);return b.editObject.previousSelectedObject=null,e?{baseAction:"linkRemoval",link:d}:void 0}},onChunkContext:null,keyHandler:e,save:null,undo:d,redo:null},this.addEditMode(this.defaultMode)};return B.prototype.setDataModel=function(a){this.dataModel=a},B.prototype.dataChanged=function(){return this.needToSaveState?!0:0==this.actionsLog.length?!1:this.currentPtr!=this.lastSavedPtr?!0:!1},B.prototype.setEditMode=function(a){var b=this;if(null==a)a="default";else{editModeExist=!1;for(i in this.mode)if(this.mode[i].name==a){editModeExist=!0;break}editModeExist||(alert("this edition mode does not exist! switching to default mode"),a="default")}this.editMode=a,this.needToSaveState=!1,window.onbeforeunload=a?function(a){if(b.dataChanged()){var c="Changes made to the graph are not saved. If you leave this page all modifications will be lost.";return a=a||window.event,a&&(a.returnValue=c),c}}:null,this.init(),this.initToolbar()},B.prototype.initToolbar=function(){function b(){var a=h.editObject;a.highlightMode=!a.highlightMode,a.highlightMode?(a.clearSelection(),h.viewer.getToolbarButton("highlight").removeClass("tab").addClass("tab_on")):h.viewer.getToolbarButton("highlight").removeClass("tab_on").addClass("tab")}function c(){var a=h.editObject;null!=a.mode[a.editMode].save&&a.mode[a.editMode].save(h)}function d(){var a=h.editObject;0==h.editObject.currentPtr&&h.viewer.getToolbarButton("undo").hide();var b=h.editObject.actionsLog[h.editObject.currentPtr];null!=a.mode[b.mode].undo&&a.mode[b.mode].undo.call(a,h,b.rollbackdata),h.editObject.currentPtr--,null!=a.mode[b.mode].redo&&h.viewer.getToolbarButton("redo").show(),a.updateSaveState()}function e(){var a=h.editObject;h.editObject.currentPtr++,h.editObject.currentPtr==h.editObject.actionsLog.length-1&&h.viewer.getToolbarButton("redo").hide();var b=h.editObject.actionsLog[h.editObject.currentPtr];null!=a.mode[b.mode].redo&&a.mode[b.mode].redo.call(a,h,b.rollbackdata),h.viewer.getToolbarButton("undo").show(),a.updateSaveState()}function f(){var b=this.getBoundingClientRect(),c={x:b.left,y:b.top+b.height+2},d="<div>";d+='Export Format : <select name="type"><option value="png">png</option><option value="json" selected>json</option><option value="depxml">depxml</option><option value="dep2pict">dep2pict</option><option value="conll">conll</option></select><br/><input id="export-data'+h.viewer.appendOwnID("")+'"  type="button" value="Export"></div>',d=jQuery(d);var e=h.viewer.createBox({closeButton:!0,autodestroy:!0});e.setContent(jQuery(d)),jQuery("#export-data"+h.viewer.appendOwnID("")).click(function(){var b=jQuery("select",this.parentNode),c=b[0].options[b[0].selectedIndex].value;"png"==c?g():(h.cleanData(),a.windowOpenPost({action:"export",data:h.data,source_format:"json",target_format:c},h.wsurl)),e.destroy()}),e.open(c)}function g(){d3.select("rect.export_bg").attr("width","100%").attr("height","100%");var b=h.svg.node().getBBox();h.svg.attr("width",b.width),h.svg.attr("height",b.height);var c=(new XMLSerializer).serializeToString(h.svg.node());a.windowOpenPost({action:"export",data:c,source_format:"json",target_format:"png"},h.wsurl),d3.select("rect.export_bg").attr("width","0").attr("height","0")}var h=this.depgraph;h.viewer.resetToolbarButtons();var i=[["save",c,"right","saved"],["undo",d,"left","undo"],["redo",e,"left","redo"],["highlight",b,"left","highlightoff"],["export",f,"right","export"]];if(null!=this.mode[this.editMode].buttons)for(button in this.mode[this.editMode].buttons)i.push(button);h.viewer.setToolbarButtons(i),(this.currentPtr<0||null==this.mode[this.editMode].undo)&&h.viewer.getToolbarButton("undo").hide(),(this.currentPtr==this.actionsLog.length-1||null==this.mode[this.editMode].redo)&&h.viewer.getToolbarButton("redo").hide()},B.prototype.setNeedToSave=function(){this.needToSaveState=!0,this.updateSaveState()},B.prototype.updateSaveState=function(){this.lastSavedPtr!=this.currentPtr||this.needToSaveState?this.depgraph.viewer.getToolbarButton("save").removeClass("saved").addClass("save"):this.depgraph.viewer.getToolbarButton("save").removeClass("save").addClass("saved")},B.prototype.init=function(){function a(a,b,c){var d=f.editObject,b=b.menu;if(null!=d.mode[d.editMode][a][b]){var e=d.mode[d.editMode][a][b].call(this,f,c);d.pushAction({mode:d.editMode,rollbackdata:e,data:{event:"onContextClick",params:{object_type:a,menu:b,object:c}}})}}function b(a,b){var c=f.editObject;if(null!=c.mode[c.editMode].onWordSelect){var d=c.mode[c.editMode].onWordSelect.call(this,f,{d:a,i:b});c.pushAction({mode:c.editMode,rollbackdata:d,data:{event:"onWordSelect",params:{d:a,i:b}}})}}function c(a,b){var c=f.editObject;if(null!=c.mode[c.editMode].onLinkSelect){var d=c.mode[c.editMode].onLinkSelect.call(this,f,{d:a,i:b});c.pushAction({mode:c.editMode,rollbackdata:d,data:{event:"onLinkSelect",params:{d:a,i:b}}})}}function d(a,b){var c=f.editObject;if(null!=c.mode[c.editMode].onChunkSelect){var d=c.mode[c.editMode].onChunkSelect.call(this,f,{d:a,i:b});c.pushAction({mode:c.editMode,rollbackdata:d,data:{event:"onChunkSelect",params:{d:a,i:b}}})}}function e(){var a=f.editObject;if(null!=a.mode[a.editMode].keyHandler){var b=a.mode[a.editMode].keyHandler.call(this,f,{keyCode:d3.event.keyCode});a.pushAction({mode:a.editMode,rollbackdata:b,data:{event:"keyHandler",params:{keyCode:d3.event.keyCode}}})}}var f=this.depgraph;if(!this.editMode)return this.depgraph.vis.selectAll("g.word").on("click",null),this.depgraph.vis.selectAll("g.link").on("click",null),this.depgraph.vis.selectAll("g.chunk").on("click",null),d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,null),this.depgraph.viewer.resetToolbarButtons(),jQuery(".link",this.depgraph.vis.node()).contextMenu("",{}),jQuery(".word",this.depgraph.vis.node()).contextMenu("",{}),jQuery(".chunk",this.depgraph.vis.node()).contextMenu("",{}),void 0;
if(this.depgraph.vis.selectAll("g.word").on("click",b),this.depgraph.vis.selectAll("g.link").on("click",c),this.depgraph.vis.selectAll("g.chunk").on("click",d),d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,e),null!=this.mode[this.editMode].onLinkContext){var g={};for(menu in this.mode[this.editMode].onLinkContext)g[menu]={menu:menu,click:function(b){a("onLinkContext",this,b)},klass:"menu-item-1"};jQuery(".link",this.depgraph.vis.node()).contextMenu("link-context-menu",g)}if(null!=this.mode[this.editMode].onWordContext){var g={};for(menu in this.mode[this.editMode].onWordContext)g[menu]={menu:menu,click:function(b){a("onWordContext",this,b)},klass:"menu-item-1"};jQuery(".word",this.depgraph.vis.node()).contextMenu("word-context-menu",g)}if(null!=this.mode[this.editMode].onChunkContext){var g={};for(menu in this.mode[this.editMode].onChunkContext)g[menu]={menu:menu,click:function(b){a("onChunkContext",this,b)},klass:"menu-item-1"};jQuery(".chunk",this.depgraph.vis.node()).contextMenu("chunk-context-menu",g)}jQuery(this.depgraph.svg.node()).contextMenu("main-menu",{"add word":{menu:"add word",click:function(a){var b=f.viewer.screenCoordsForElt(a[0]),c={x:(b.ne.x+b.nw.x)/2,y:b.nw.y},d=jQuery(m(f));f.viewer.createBox({closeButton:!0,draggable:!0}).setContent(d).open(c)}}})},B.prototype.addEditMode=function(a){this.mode[a.name]=a},B.prototype.pushAction=function(a){if(null!=a.rollbackdata&&null!=this.mode[a.mode].undo){this.depgraph.viewer.getToolbarButton("redo").hide();var b=this.depgraph.viewer.getToolbarButton("undo");b.show(),this.actionsLog.splice(++this.currentPtr,this.actionsLog.length-this.currentPtr,a),this.updateSaveState()}},B.prototype.clearSelection=function(){if(null!=this.previousSelectedObject){try{this.previousSelectedObject.selected=!1,a.highlightObject(this.previousSelectedObject,!1)}catch(b){}this.previousSelectedObject=null}},B.prototype.selectObject=function(b){return this.previousSelectedObject==b?(this.clearSelection(),void 0):(this.clearSelection(),this.previousSelectedObject=b,a.highlightObject(this.previousSelectedObject,!0),b.selected=!0,void 0)},B.prototype.changeAttributes=function(c,d,e){for(var f=a.clone(c),g=[],h=0;h<d.length;h++){var i=b(c,d[h].path,d[h].value);g.push({path:d[h].path,value:i})}if(null!=e&&e){var j={mode:this.editMode,rollbackdata:{baseAction:"changeAttr",obj:f,attrs:d,oldAttrs:g}};this.pushAction(j)}},a.selectObject=function(a,b){return c(a,b)},a.showEditPanel=function(a,b){return f(a,b)},a.saveProperties=o,a.isALink=function(a){return y(a)},a.isAWord=function(a){return z(a)},a.isAChunk=function(a){return A(a)},a.EditObject=B,B}"undefined"==typeof define?a(depgraphlib):define(["app/depgraphlib"],a)}(),function(){function a(a,b,c){function d(b,c){var d=d3.select(this),e=d.node(),f=e.getStyle("font-size"),g=e.getStyle("sub-font-size"),h=e.getStyle("color"),i=e.getStyle("sub-color"),j=e.getStyle("font-weight"),l=e.getStyle("sub-font-weight"),m=e.getStyle("font-style"),n=e.getStyle("sub-font-style"),o=null!=e.components?e.components.rect:d.append("rect"),p=null!=e.components?e.components.text:d.append("text"),q=null!=e.components?e.components.label:p.append("tspan"),r=null!=e.components?e.components.sublabels:[];if(q.text(b.label).style("fill",h).style("font-style",m).style("font-weight",j).style("font-size",f),b.sublabel)for(var c=0;c<b.sublabel.length;++c){var s=null;null!=r[c]?s=r[c]:(s=p.append("tspan"),r.push(s)),s.text(b.sublabel[c]).style("font-size",g).style("font-style",n).style("font-weight",l).style("fill",i).attr("x","0px").attr("dy","1.25em")}var t="none";(null!=b.selected||e.getStyle("highlighted",!1))&&(t="yellow");var u=p.node().getBBox();o.attr("x",0).attr("y",u.y).attr("rx",10).attr("ry",10).attr("width",u.width).attr("height",u.height).style("stroke","transparent").style("fill",t).style("stroke-width",1);var v=k.getInstance(this),w=v.getWordNodeByPosition(d.datum()["#position"]-1),x=e.getStyle("margin");if(null!=w){var y=a.getTransformValues(d3.select(w)),u=w.getBBox(),z=a.removeUnit(a.addPxs(y.translate[0],u.width,x.right,x.left)),A=a.removeUnit(x.top);a.setGroupPosition(d,z,A)}else{var z=a.removeUnit(x.left),A=a.removeUnit(x.top);a.setGroupPosition(d,z,A)}d.node().components={text:p,label:q,rect:o,sublabels:r}}function e(b,c){for(var d=d3.select(this),e=k.getInstance(d.node()),f=d.node(),g=d.append("rect"),h={x:99999,y:99999},i={x:0,y:0},c=0;c<b.elements.length;c++){var j=e.getWordNodeByOriginalId(b.elements[c]),l=a.getTransformValues(d3.select(j)),m={x:l.translate[0],y:l.translate[1]},n=j.getBBox();m.x+n.x<h.x&&(h.x=m.x+n.x),m.y+n.y<h.y&&(h.y=m.y+n.y),m.x+n.width+n.x>i.x&&(i.x=m.x+n.width+n.x),m.y+n.height+n.y>i.y&&(i.y=m.y+n.height+n.y)}var o=f.getStyle("margin"),p=f.getStyle("font-size"),q=f.getStyle("sub-font-size"),r=f.getStyle("color"),s=f.getStyle("sub-color"),t=f.getStyle("font-weight"),u=f.getStyle("sub-font-weight"),v=f.getStyle("font-style"),w=f.getStyle("sub-font-style"),x=f.getStyle("background-color"),y=f.getStyle("border-color"),z=f.getStyle("border-size"),A=d.append("line");A.attr("y1",a.addPxs(i.y,2*a.removeUnit(o.top))).attr("x1",0).attr("y2",a.addPxs(i.y,2*a.removeUnit(o.top))).attr("x2",i.x-h.x+a.removeUnit(o.left)+a.removeUnit(o.right)).style("stroke",y).style("stroke-width",z);var B=d.append("text");if(B.attr("y",a.addPxs(20,i.y,2*a.removeUnit(o.top))),B.append("tspan").text(b.label).style("fill",r).style("font-style",v).style("font-weight",t).style("font-size",p),b.sublabel)for(var c=0;c<b.sublabel.length;++c)B.append("tspan").text(b.sublabel[c]).style("font-size",q).style("font-style",w).style("font-weight",u).style("fill",s).attr("dx",-(b.sublabel[c].length-1)*a.removeUnit(q)).attr("dy","1.25em");a.center(B,d);var C=B.node().getBBox().height;g.attr("x",0).attr("y",0).attr("rx",10).attr("ry",10).attr("width",i.x-h.x+a.removeUnit(o.left)+a.removeUnit(o.right)).attr("height",a.addPxs(i.y,-h.y,C,2*a.removeUnit(o.top),20)).style("fill",x).style("stroke",y).style("stroke-width",z),d.node().components={text:B,rect:g},a.setGroupPosition(d,h.x-a.removeUnit(o.left),h.y-a.removeUnit(o.top))}function f(b,c){var d=d3.select(this),e=k.getInstance(this),f=this,g=e.getLinkProperties(d.node()),h=f.getStyle("margin"),i=f.getStyle("font-size"),l=f.getStyle("color"),m=f.getStyle("link-color"),n=f.getStyle("link-size"),o=f.getStyle("font-weight"),p=f.getStyle("font-style"),q=f.getStyle("oriented");f.getStyle("align");var r=f.getStyle("highlighted",!1),s=f.getStyle("stroke-dasharray","none"),t=!1;g.nodeStart||(g.nodeStart=g.nodeEnd,t=!0);var u=a.getNodePosition(g.nodeEnd)-a.getNodePosition(g.nodeStart)>0?1:-1,v=g.strate>0?1:-1,w=a.getTransformValues(d3.select(g.nodeStart)).translate,x=a.getTransformValues(d3.select(g.nodeEnd)).translate,y=g.nodeStart.getBBox(),z=g.nodeEnd.getBBox(),A=y.width/2,B=z.width/2,C=3,D=u>0?5*g.offsetXmin+C:-5*g.offsetXmax-C,E=u>0?-5*g.offsetXmax-C:5*g.offsetXmin+C,F=5,G=w[0]+A+D,H=x[0]+B+E,I=H-G-2*u*F;if(null==e.wordY){var J=e.vis.selectAll("g.word");e.wordY=0,e.wordHeight=0;for(var c=0;c<J[0].length;++c){var K=J[0][c].getBBox();e.wordY>K.y&&(e.wordY=K.y),e.wordHeight<K.height&&(e.wordHeight=K.height)}}var L="chunk"==g.nodeStart.className.animVal?y.height:y.height+e.wordY,M="chunk"==g.nodeEnd.className.animVal?z.height:z.height+e.wordY,N="chunk"==g.nodeStart.className.animVal?0:e.wordY,O="chunk"==g.nodeEnd.className.animVal?0:e.wordY,P=v>0?N:L,Q=v>0?O:M,R=w[1]+P,S=x[1]+Q,T=15,U=30,V=-v*T-U*g.strate;t&&(V=-v*T-U*v*e.maxLinksStrate);var W=-(V+R-S),X=(1+u*v)/2,Y=(1+u*v)/2,Z="transparent";r&&(Z=j(m));var $=null!=f.components?f.components.highlightPath:d.append("path"),_=null!=f.components?f.components.path:d.append("path");t?($.attr("d","M "+G+","+(R+V)+" v "+-V),_.attr("d","M "+G+","+(R+V)+" v "+-V)):($.attr("d","M "+G+","+R+" v "+V+" a 5 5 0 0 "+X+" "+u*F+" "+-v*F+" h "+I+" a 5 5 0 0 "+Y+" "+u*F+" "+v*F+" v "+W),_.attr("d","M "+G+","+R+" v "+V+" a 5 5 0 0 "+X+" "+u*F+" "+-v*F+" h "+I+" a 5 5 0 0 "+Y+" "+u*F+" "+v*F+" v "+W)),$.attr("stroke",Z).attr("stroke-width",a.removeUnit(n)+3).attr("fill","none"),_.attr("stroke",m).attr("stroke-dasharray",s).attr("stroke-width",n).attr("fill","none"),q&&_.attr("marker-end","url(#"+e.viewer.appendOwnID("arrow")+")");var ab=null!=f.components?f.components.label:d.append("text");ab.text(b.label).style("fill",l).style("font-weight",o).style("font-style",p).style("font-size",i);var bb=ab.node().getBBox();ab.attr("x",-bb.width/2+G+I/2+u*F).attr("y",a.removeUnit(a.addPxs(-a.removeUnit(h.top),R,V,-v*F))),f.components={highlightPath:$,path:_,label:ab}}function g(b,c,d){if(d||!b.selected&&!b.getStyle("highlighted",!1)){d&&a.setStyle(b,"highlighted",c);var e=b.getStyle("link-color"),f=b.getStyle("font-weight");c!==!1?(b.components.highlightPath.attr("stroke",j(e)),b.components.label.style("font-weight","bold")):(b.components.highlightPath.attr("stroke","transparent"),b.components.label.style("font-weight",f))}}function h(b,c,d){(d||!b.selected&&!b.getStyle("highlighted",!1))&&(d&&a.setStyle(b,"highlighted",c),b.components.rect.style("fill",c?"yellow":"none"))}function i(a,b,c){if(null!=a.classList&&a.classList.length>0){var d=a.classList[0];"link"==d?g(a,b,c):(d="word")&&h(a,b,c)}}function j(b){if("#000000"==b||"#"!=b.slice(0,1))return"yellow";var c=-.3,d=a.hexToRgb(b),e=a.rgbToHsl(d.r,d.g,d.b);return e.l+=c,e.l=e.l<0?0:e.l>1?1:e.l,d=a.hslToRgb(e.h,e.s,e.l),a.rgbToHex(d.r,d.g,d.b)}var k=function(d,e,f){this.options=f||{},this.viewer=new b(d,this.options.uid),k.instances[this.viewer.uid]=this,this.callbacks=new Object,this.setData(e),this.original_data=a.clone(this.data),this.createLayout(),this.update(),this.postProcesses(),this.autoHighLightOnMouseOver(),this.viewerSettings(),this.editObject=new c(this)};return k.prototype.getOriginalUID=function(){return this.viewer.uid.replace(/_*$/g,"")},k.prototype.viewerSettings=function(){this.viewer.callbacks.fullscreen.oncomplete.push({method:this.centerGraph,caller:this}),this.viewer.callbacks.fullscreen.onclose.push({method:this.centerGraph,caller:this})},k.prototype.centerGraph=function(){var b=this.viewer.chart,c=b[0].getBoundingClientRect(),d=this.vis.node().getBBox(),e=a.getTransformValues(this.vis),f=(c.width-d.width)/2,g=(c.height-d.height)/2;g=g>0?g:a.removeUnit(this.data.graph["#style"].margin.top),f=f>0?f:a.removeUnit(this.data.graph["#style"].margin.left),this.vis.attr("transform","translate("+(f-d.x)+","+(g-d.y)+") scale("+e.scale[0]+")")},k.prototype.autoHighLightOnMouseOver=function(a){null==a||a?(this.vis.selectAll("g.link").on("mouseover.autohighlight",function(){g(this,!0)}),this.vis.selectAll("g.link").on("mouseout.autohighlight",function(){g(this,!1)}),this.vis.selectAll("g.word").on("mouseover.autohighlight",function(){h(this,!0)}),this.vis.selectAll("g.word").on("mouseout.autohighlight",function(){h(this,!1)})):(this.vis.selectAll("g.link").on("mouseover.autohighlight",null),this.vis.selectAll("g.link").on("mouseout.autohighlight",null),this.vis.selectAll("g.word").on("mouseover.autohighlight",null),this.vis.selectAll("g.word").on("mouseout.autohighlight",null))},k.instances=k.instances||[],k.getInstance=function(a){if(a){if(k.prototype.isPrototypeOf(a))return a;null!=a.ownerSVGElement?a=a.ownerSVGElement.parentNode.id:a.nodeName&&"svg"==a.nodeName?a=a.parentNode.id:"object"==typeof a&&null!=a.id&&(a=a.id),regex=/.*-(\w+)/;var b=regex.exec(a);return null!=b?k.instances[b[1]]:null}},k.prototype.setData=function(a){this.data=a,this.prepareData()},k.prototype.resetData=function(a){this.setData(a),this.createLayout(),this.update(),this.postProcesses(),this.autoHighLightOnMouseOver(),this.editObject.init()},k.prototype.cleanData=function(){var a=this.vis.selectAll("g.link");this.resetLinksProperties(a)},k.prototype.prepareData=function(){a.JSONresolveReferences(this.data,"@"),this.id=0;for(var b=0;this.data.graph.words&&b<this.data.graph.words.length;b++){var c=this.data.graph.words[b];c["#id"]=this.id++,c["#position"]=b}for(var b=0;this.data.graph.links&&b<this.data.graph.links.length;b++)this.data.graph.links[b]["#id"]=this.id++,this.data.graph.links[b]["#properties"]=null;for(var b=0;this.data.graph.chunks&&b<this.data.graph.chunks.length;b++)this.data.graph.chunks[b]["#id"]=this.id++;var d=this.data.graph["#style"]?this.data.graph["#style"]:this.data.graph["#style"]=new Object,e=this.data.graph["#word-style"]?this.data.graph["#word-style"]:this.data.graph["#word-style"]=new Object,f=this.data.graph["#link-style"]?this.data.graph["#link-style"]:this.data.graph["#link-style"]=new Object,g=this.data.graph["#chunk-style"]?this.data.graph["#chunk-style"]:this.data.graph["#chunk-style"]=new Object;d.margin=d.margin?d.margin:{top:"50px",right:"20px",bottom:"20px",left:"20px"},d.margin.top=d["margin-top"]?d["margin-top"]:d.margin.top,d.margin.right=d["margin-right"]?d["margin-right"]:d.margin.right,d.margin.left=d["margin-left"]?d["margin-left"]:d.margin.left,d.margin.bottom=d["margin-bottom"]?d["margin-bottom"]:d.margin.bottom,d["background-color"]=d["background-color"]?d["background-color"]:"white",d["font-family"]=d["font-family"]?d["font-family"]:"inherit",e.margin=e.margin?e.margin:{top:"10px",right:"15px",bottom:"10px",left:"15px"},e["sub-margin"]=e["sub-margin"]?e["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"},e["font-size"]=e["font-size"]?e["font-size"]:"14px",e["sub-font-size"]=e["sub-font-size"]?e["sub-font-size"]:"10px",e.color=e.color?e.color:"black",e["sub-color"]=e["sub-color"]?e["sub-color"]:"black",e["font-weight"]=e["font-weight"]?e["font-weight"]:"normal",e["sub-font-weight"]=e["sub-font-weight"]?e["sub-font-weight"]:"normal",e["font-style"]=e["font-style"]?e["font-style"]:"normal",e["sub-font-style"]=e["sub-font-style"]?e["sub-font-style"]:"normal",f.margin=f.margin?f.margin:{top:"5px",right:"10px",bottom:"10px",left:"10px"},f["font-size"]=f["font-size"]?f["font-size"]:"12px",f.color=f.color?f.color:"black",f["link-color"]=f["link-color"]?f["link-color"]:"#000000",f["link-size"]=f["link-size"]?f["link-size"]:"2px",f["font-weight"]=f["font-weight"]?f["font-weight"]:"normal",f["font-style"]=f["font-style"]?f["font-style"]:"normal",f.oriented=f.oriented?f.oriented:!0,f.align=f.align?f.align:"center",f.higlighted=!1,g.margin=g.margin?g.margin:{top:"10px",right:"10px",bottom:"10px",left:"10px"},g["sub-margin"]=g["sub-margin"]?g["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"},g["font-size"]=g["font-size"]?g["font-size"]:"12px",g["sub-font-size"]=g["sub-font-size"]?g["sub-font-size"]:"10px",g["background-color"]=g["background-color"]?g["background-color"]:"transparent",g.color=g.color?g.color:"black",g["sub-color"]=g["sub-color"]?g["sub-color"]:"black",g["border-color"]=g["border-color"]?g["border-color"]:"black",g["font-weight"]=g["font-weight"]?g["font-weight"]:"normal",g["sub-font-weight"]=g["sub-font-weight"]?g["sub-font-weight"]:"normal",g["font-style"]=g["font-style"]?g["font-style"]:"normal",g["sub-font-style"]=g["sub-font-style"]?g["sub-font-style"]:"normal",g["border-size"]=g["border-size"]?g["border-size"]:"1px"},k.prototype.postProcesses=function(){var b=this.vis.node().getBBox();this.vis.attr("transform","translate("+(a.removeUnit(this.data.graph["#style"].margin.left)-b.x)+","+(a.removeUnit(this.data.graph["#style"].margin.top)-b.y)+") scale(1)"),this.setViewMode()},k.prototype.setViewMode=function(){if(this.options.viewmode&&"full"!=this.options.viewmode)this.setWidthLimitedViewMode("600px");else{var a=this.vis.node().getBBox();this.options.maxwidth&&this.options.maxwidth<a.width?(this.options.viewmode="cropped",this.setWidthLimitedViewMode(this.options.maxwidth,!0)):(this.options.viewmode="full",this.setFullViewMode())}},k.prototype.setFullViewMode=function(){this.viewer.shrinkToContent(a.removeUnit(this.data.graph["#style"].margin.right),a.removeUnit(this.data.graph["#style"].margin.bottom)+20)},k.prototype.setWidthLimitedViewMode=function(b,c){if(this.viewer.shrinkHeightToContent(a.removeUnit(this.data.graph["#style"].margin.bottom)+20),this.options.viewsize||(this.options.viewsize=b),this.viewer.setWidth(this.options.viewsize),c||"cropped"==this.options.viewmode)this.createScrollBar();else{var d=this.vis.node().getBBox(),e=this.viewer.chart.width()/(d.width+2*a.removeUnit(this.data.graph["#style"].margin.right));this.scale(e),this.viewer.shrinkHeightToContent(a.removeUnit(this.data.graph["#style"].margin.bottom)+20)}},k.prototype.createScrollBar=function(){var b=this,c=this.vis.node().getBBox(),d=c.width+2*a.removeUnit(this.data.graph["#style"].margin.right),e=this.viewer.mainpanel.width();if(d>e){var f=2*e-d,g=1;0>=f&&(f=20,g=(d-e)/(e-f)),this.scrollbar=this.svg.select(".scrollbar"),null==this.scrollbar.node()&&(this.scrollbar=this.svg.append("rect").classed("scrollbar",!0)),this.scrollbar.attr("x",0).attr("y",this.viewer.mainpanel.height()-40).attr("rx",1).attr("ry",1).attr("width",f).attr("height",5).style("stroke","grey").style("fill","lightgrey").style("stroke-width",1).__info__={maxX:e-f,k:g},this.scrollMouseSelected=null,this.scrollbar.on("mousedown",function(){var a=k.getInstance(this);k.depgraphActive="-"+a.viewer.uid,a.scrollMouseSelected=d3.event.clientX,d3.event.preventDefault?d3.event.preventDefault():d3.event.returnValue=!1}),d3.select(document).on("click.focus",function(){var a=k.getInstance(d3.event.originalTarget);k.depgraphActive=a?"-"+a.viewer.uid:null}),d3.select(document).on("wheel.scrollbar",function(){var a=k.getInstance(k.depgraphActive);a&&a.scrollbar&&(a.translateGraph(3*d3.event.deltaY,0),d3.event.preventDefault?d3.event.preventDefault():d3.event.returnValue=!1)}),d3.select(document).on("mousemove.scrollbar"+b.viewer.uid,function(){var a=k.getInstance(k.depgraphActive);if(a&&(a.scrollMouseSelected||0===a.scrollMouseSelected)){var b=d3.event.clientX-a.scrollMouseSelected;a.scrollbar&&(b*=a.scrollbar.__info__.k),a.translateGraph(b,0),a.scrollMouseSelected=d3.event.clientX}}),d3.select(document).on("mouseup.scrollbar"+b.viewer.uid,function(){var a=k.getInstance(k.depgraphActive);a&&(a.scrollMouseSelected=null)})}d3.select(document).on("keydown.move"+b.viewer.uid,function(){var a=10;if(k.depgraphActive){var b=k.getInstance(k.depgraphActive);37==d3.event.keyCode?b.translateGraph(-a,0):39==d3.event.keyCode&&b.translateGraph(a,0)}})},k.prototype.createLayout=function(){null!=this.svg&&this.svg.remove(),this.svg=d3.select(this.viewer.chart[0]).append("svg").attr("width","100%").attr("height","100%").style("margin-top","30px"),this.viewer.chart.css("background-color",this.data.graph["#style"]["background-color"]),this.svg.append("rect").classed("export_bg",!0).attr("width","0").attr("height","0").style("fill",this.data.graph["#style"]["background-color"]),this.setSVGDefs(),this.vis=this.svg.append("g").attr("transform","translate("+a.removeUnit(this.data.graph["#style"].margin.left)+","+a.removeUnit(this.data.graph["#style"].margin.top)+") scale(1)")},k.prototype.scale=function(b){var c=k.getInstance(this),d=a.getTransformValues(c.vis);c.vis.attr("transform","translate("+d.translate[0]*b+","+d.translate[1]*b+")"+" scale("+b+")")},k.prototype.translateGraph=function(b,c){var d=k.getInstance(this),e=a.getTransformValues(d.vis);if(d.scrollbar){var f=parseFloat(d.scrollbar.attr("x")),g=b/d.scrollbar.__info__.k;d.scrollbar.__info__.maxX<f+g?g=d.scrollbar.__info__.maxX-f:0>f+g&&(g=-f),b=d.scrollbar.__info__.k*g,d.scrollbar.attr("x",f+g)}d.vis.attr("transform","translate("+(e.translate[0]-b)+","+(e.translate[1]-c)+")"+" scale("+e.scale[0]+")")},k.prototype.update=function(){var a,b;null!=this.data.graph.chunks&&(a=this.chunks=this.vis.selectAll("g.chunk").data(this.data.graph.chunks,function(a){return a["#id"]}),b=a.enter().append("g").classed("chunk",!0));var c=this.words=this.vis.selectAll("g.word").data(this.data.graph.words,function(a){return a["#id"]});c.enter().append("g").classed("word",!0);var g=c.exit();g.remove(),c.each(d),null!=this.data.graph.chunks&&b.each(e);var h=this.links=this.vis.selectAll("g.link").data(this.data.graph.links,function(a){return a["#id"]});h.enter().append("g").classed("link",!0);var i=h.exit();i.remove(),this.resetLinksProperties(h),this.preprocessLinksPosition(h),h.each(f)},k.prototype.insertWord=function(a,b){null==a["#id"]&&(a["#id"]=this.id++),null==a.id&&(a.id="_w"+a["#id"]),this.data.graph.words.splice(b,0,a);for(var c=b+1;c<this.data.graph.words.length;++c)this.data.graph.words[c]["#position"]++;this.update(),this.postProcesses()},k.prototype.addLink=function(a){null==a["#id"]&&(a["#id"]=this.id++),this.data.graph.links.push(a),this.update(),this.postProcesses()},k.prototype.addChunk=function(){},k.prototype.removeWord=function(b){var c=[],d=this.getWordIndexById(b);if(null==d)return!1;var e=this.data.graph.words[d]["#position"],f=this.data.graph.words[d].id;this.data.graph.words.splice(d,1);for(var g=e;g<this.data.graph.words.length;++g)this.data.graph.words[g]["#position"]--;for(var g=0;g<this.data.graph.links.length;g++){var h=this.data.graph.links[g];(h.source==f||h.target==f)&&(c.push(a.clone(h)),this.data.graph.links.splice(g,1),g--)}return this.update(),this.postProcesses(),c},k.prototype.removeLink=function(a){var b=this.getLinkIndexById(a);return null==b?!1:(this.data.graph.links.splice(b,1),this.update(),this.postProcesses(),!0)},k.prototype.removeChunk=function(){},k.prototype.getWordNodeByPosition=function(a){for(var b=this.vis.selectAll("g.word"),c=0;c<b[0].length;c++)if(b[0][c].__data__["#position"]==a)return b[0][c];return null},k.prototype.getWordNodeByOriginalId=function(a){for(var b=this.vis.selectAll("g.word"),c=0;c<b[0].length;c++)if(b[0][c].__data__.id==a)return b[0][c]},k.prototype.getChunkNodeByOriginalId=function(a){for(var b=this.vis.selectAll("g.chunk"),c=0;c<b[0].length;c++)if(b[0][c].__data__.id==a)return b[0][c]},k.prototype.getWordNodeById=function(a){for(var b=this.vis.selectAll("g.word"),c=0;c<b[0].length;c++)if(b[0][c].__data__["#id"]==a)return b[0][c]},k.prototype.getWordIndexById=function(a){for(var b in this.data.graph.words)if(this.data.graph.words[b]["#id"]==a)return b},k.prototype.getLinkById=function(a){for(var b in this.data.graph.links)if(this.data.graph.links[b]["#id"]==a)return this.data.graph.links[b]},k.prototype.getLinkIndexById=function(a){for(var b in this.data.graph.links)if(this.data.graph.links[b]["#id"]==a)return b},k.prototype.getLinkIndexByOriginalId=function(a){for(var b in this.data.graph.links)if(this.data.graph.links[b].id==a)return b},k.prototype.getObjectById=function(a){for(var b in this.data.graph.words)if(this.data.graph.words[b]["#id"]==a)return this.data.graph.words[b];for(var b in this.data.graph.links)if(this.data.graph.links[b]["#id"]==a)return this.data.graph.links[b];for(var b in this.data.graph.chunks)if(this.data.graph.chunks[b]["#id"]==a)return this.data.graph.chunks[b]},k.prototype.getObjectNodeFromObject=function(){},a.getStyleElement=function(a,b,c){return null!=a.__data__["#style"]&&null!=a.__data__["#style"][b]?a.__data__["#style"][b]:c},SVGElement.prototype.getStyle=function(a,b){var c=k.getInstance(this);if(null!=this.__data__["#style"]&&null!=this.__data__["#style"][a])return this.__data__["#style"][a];var d=null;return null!=this.className&&(d=c.data.graph["#"+this.className.animVal+"-style"][a]),null==d&&null!=b?b:d},a.setStyle=function(a,b,c){null==a.__data__["#style"]&&(a.__data__["#style"]={}),c?a.__data__["#style"][b]=c:delete a.__data__["#style"][b]},a.highlightObject=function(a,b,c){return i(a,b,c)},a.isObjectPermanentHighlighted=function(a){return a.getStyle("highlighted",!1)},k.prototype.setSVGDefs=function(){this.defs=this.svg.append("defs"),this.defs.append("marker").attr("id",this.viewer.appendOwnID("arrow")).attr("viewBox","0 0 10 10").attr("refX","8").attr("refY","5").attr("markerUnits","strokeWidth").attr("orient","auto").attr("markerWidth","3").attr("markerHeight","3").append("polyline").attr("points","0,0 10,5 0,10 1,5")},a.getNodePosition=function(a){if(a){if(null!=a.__data__["#position"])return a.__data__["#position"];var b=k.getInstance(a),c=Math.floor(a.__data__.elements.length/2),d=b.getWordNodeByOriginalId(a.__data__.elements[c]);return d.__data__["#position"]}return-1},a.DepGraph=k,k}"undefined"==typeof define?a(depgraphlib,depgraphlib.GraphViewer,depgraphlib.EditObject):define(["app/depgraphlib","app/graphviewer","app/editobject"],a)}(),function(){function a(a,b){function c(b,c){return 2*a.getNodePosition(b)<2*c.min||2*a.getNodePosition(b)>2*c.max}function d(b,c){return 2*a.getNodePosition(b)>2*c.min&&2*a.getNodePosition(b)<2*c.max}b.prototype.crossed=function(a,b){var e=this.getLinkProperties(a),f=this.getLinkProperties(b);return d(e.nodeStart,f)&&c(e.nodeEnd,f)||d(e.nodeEnd,f)&&c(e.nodeStart,f)},b.prototype.preprocessLinksPosition=function(a){function b(a){var b=Math.abs(a);c.maxLinksStrate=c.maxLinksStrate<b?b:c.maxLinksStrate}var c=this;this.sortLinksByLength(a[0]);for(var d=a[0].length,e=[],f=0;d>f;++f)for(var g=a[0][f],h=this.getLinkProperties(g),i=1;;){if(null==e[i]){e[i]=new Array;for(var j=2*h.min;j<2*h.max;j++)e[i][j]=g;h.strate=i,b(i);break}for(var k=null,j=2*h.min;j<2*h.max&&(null==e[i][j]||(k=e[i][j],!this.crossed(g,k)));j++);if(null==k){for(var j=2*h.min;j<2*h.max;j++)e[i][j]=g;h.strate=i,b(i);break}if(this.crossed(g,k)){for(i=-1;;){if(null==e[i]){e[i]=new Array;for(var j=2*h.min;j<2*h.max;j++)e[i][j]=g;h.strate=i,b(i);break}for(var l=null,j=2*h.min;j<2*h.max;j++)if(null!=e[i][j]){l=e[i][j];break}if(null==l){for(var j=2*h.min;j<2*h.max;j++)e[i][j]=g;h.strate=i,b(i);break}i--}break}i++}for(var f=0;d>f;f++){var m,g=a[0][f],h=this.getLinkProperties(g);m=h.strate>0?-1:1;for(var i=h.strate;0!=i;i+=m){var n=e[i][2*h.min];if(null!=n&&n!=g){var o=this.getLinkProperties(n);o.min==h.min&&o.offsetXmin++}if(n=e[i][2*h.max-1],null!=n&&n!=g){var o=this.getLinkProperties(n);o.max==h.max&&o.offsetXmax++}}}},b.prototype.sortLinksByLength=function(a){var b=this;a.sort(function(a,c){return b.getLinkProperties(a).length-b.getLinkProperties(c).length})},b.prototype.getLinkProperties=function(b){var c=b.__data__;if(null==c["#properties"]){var d=new Object;d.nodeStart=this.getWordNodeByOriginalId(c.source),null==d.nodeStart&&(d.nodeStart=this.getChunkNodeByOriginalId(c.source)),d.nodeEnd=this.getWordNodeByOriginalId(c.target),null==d.nodeEnd&&(d.nodeEnd=this.getChunkNodeByOriginalId(c.target)),a.getNodePosition(d.nodeStart)<a.getNodePosition(d.nodeEnd)?(d.min=a.getNodePosition(d.nodeStart),d.max=a.getNodePosition(d.nodeEnd),d.hdir=1):(d.max=a.getNodePosition(d.nodeStart),d.min=a.getNodePosition(d.nodeEnd),d.hdir=-1),d.vdir=1,d.offsetXmax=0,d.offsetXmin=0,d.strate=0,d.length=d.max-d.min,d.nodeStart||(d.length=0),d.outer=0,c["#properties"]=d}return c["#properties"]},b.prototype.resetLinksProperties=function(a){a.each(function(a){a["#properties"]=null}),this.maxLinksStrate=0}}"undefined"==typeof define?a(depgraphlib,depgraphlib.DepGraph):define(["app/depgraphlib","app/graphlayout"],a)}();