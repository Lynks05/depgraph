if(typeof jQuery=="undefined"){alert("DepGraph : Error. This library needs jQuery!")}(function(e,t,n){function r(e,t){var n=jQuery('<div class="gv-menu"><div class="gv-menu-header"></div><div class="gv-menu-body"></div></div>');var r=jQuery(".gv-menu-header",n);var s=jQuery(".gv-menu-body",n);s.hide();r.html(e);for(i in t){var o=jQuery("<div>"+i+"</div>");s.append(o);jQuery(o).click(t[i])}n.hover(function(e){jQuery(".gv-menu-body",e.currentTarget).slideDown()},function(e){jQuery(".gv-menu-body",e.currentTarget).slideUp()});return n}function s(){var e=jQuery(this);e.parent().animate({bottom:"0px"});e.removeClass("slide-up");e.addClass("slide-down")}function o(){var e=jQuery(this);var t=e.parent();t.animate({bottom:-t.height()+20+"px"});e.removeClass("slide-down");e.addClass("slide-up")}function u(){var e=jQuery(this);if(e.hasClass("slide-up")){s.call(e)}else{o.call(e)}}function a(e){for(var t=0;t<e.length;t++){e[t].method.call(e[t].caller,e[t].args)}}function f(e,t,n){if(e.__data__["#style"]!=null&&e.__data__["#style"][t]!=null){return e.__data__["#style"][t]}return n}function l(e,t,n){if(e.__data__["#style"]==null){e.__data__["#style"]={}}e.__data__["#style"][t]=n}function c(t,n){var r=d3.select(this);var i=r.node();var s=i.getStyle("font-size");var o=i.getStyle("sub-font-size");var u=i.getStyle("color");var a=i.getStyle("sub-color");var f=i.getStyle("font-weight");var l=i.getStyle("sub-font-weight");var c=i.getStyle("font-style");var h=i.getStyle("sub-font-style");var p=i.components!=null?i.components.rect:r.append("rect");var d=i.components!=null?i.components.text:r.append("text");var v=i.components!=null?i.components.label:d.append("tspan");var m=i.components!=null?i.components.sublabels:[];v.text(t.label).style("fill",u).style("font-style",c).style("font-weight",f).style("font-size",s);if(t.sublabel){for(var n=0;n<t.sublabel.length;++n){var g=null;if(m[n]!=null){g=m[n]}else{g=d.append("tspan");m.push(g)}g.text(t.sublabel[n]).style("font-size",o).style("font-style",h).style("font-weight",l).style("fill",a).attr("x","0px").attr("dy","1.25em")}}var y="transparent";if(t.selected!=null||i.getStyle("highlighted",false)){y="yellow"}var b=d.node().getBBox();p.attr("x",0).attr("y",b.y).attr("rx",10).attr("ry",10).attr("width",b.width).attr("height",b.height).style("stroke","transparent").style("fill",y).style("stroke-width",1);var w=e.DepGraph.getInstance(this);var E=w.getWordNodeByPosition(r.datum()["#position"]-1);var S=i.getStyle("margin");if(E!=null){var x=K(d3.select(E));var b=E.getBBox();var T=G(Y(x.translate[0],b.width,S.right,S.left));var N=G(S.top);$(r,T,N)}else{var T=G(S.left);var N=G(S.top);$(r,T,N)}r.node().components={text:d,label:v,rect:p,sublabels:m}}function h(t,n){var r=d3.select(this);var i=e.DepGraph.getInstance(r.node());var s=r.node();var o=r.append("rect");var u={x:99999,y:99999};var a={x:0,y:0};for(var n=0;n<t.elements.length;n++){var f=i.getWordNodeByOriginalId(t.elements[n]);var l=K(d3.select(f));var c={x:l.translate[0],y:l.translate[1]};var h=f.getBBox();if(c.x+h.x<u.x){u.x=c.x+h.x}if(c.y+h.y<u.y){u.y=c.y+h.y}if(c.x+h.width+h.x>a.x){a.x=c.x+h.width+h.x}if(c.y+h.height+h.y>a.y){a.y=c.y+h.height+h.y}}var p=s.getStyle("margin");var d=s.getStyle("font-size");var v=s.getStyle("sub-font-size");var m=s.getStyle("color");var g=s.getStyle("sub-color");var y=s.getStyle("font-weight");var b=s.getStyle("sub-font-weight");var w=s.getStyle("font-style");var E=s.getStyle("sub-font-style");var S=s.getStyle("background-color");var x=s.getStyle("border-color");var T=s.getStyle("border-size");var N=r.append("line");N.attr("y1",Y(a.y,2*G(p.top))).attr("x1",0).attr("y2",Y(a.y,2*G(p.top))).attr("x2",a.x-u.x+G(p.left)+G(p.right)).style("stroke",x).style("stroke-width",T);var C=r.append("text");C.attr("y",Y(20,a.y,2*G(p.top)));C.append("tspan").text(t.label).style("fill",m).style("font-style",w).style("font-weight",y).style("font-size",d);if(t.sublabel){for(var n=0;n<t.sublabel.length;++n){var k=C.append("tspan").text(t.sublabel[n]).style("font-size",v).style("font-style",E).style("font-weight",b).style("fill",g).attr("dx",-(t.sublabel[n].length-1)*G(v)).attr("dy","1.25em")}}J(C,r);var L=C.node().getBBox().height;o.attr("x",0).attr("y",0).attr("rx",10).attr("ry",10).attr("width",a.x-u.x+G(p.left)+G(p.right)).attr("height",Y(a.y,-u.y,L,2*G(p.top),20)).style("fill",S).style("stroke",x).style("stroke-width",T);r.node().components={text:C,rect:o};$(r,u.x-G(p.left),u.y-G(p.top))}function p(t,n){var r=d3.select(this);var i=e.DepGraph.getInstance(this);var s=this;var o=i.getLinkProperties(r.node());var u=s.getStyle("margin");var a=s.getStyle("font-size");var f=s.getStyle("color");var l=s.getStyle("link-color");var c=s.getStyle("link-size");var h=s.getStyle("font-weight");var p=s.getStyle("font-style");var d=s.getStyle("oriented");var v=s.getStyle("align");var m=s.getStyle("highlighted",false);var g=E(o.nodeEnd)-E(o.nodeStart)>0?1:-1;var b=o.strate>0?1:-1;var w=K(d3.select(o.nodeStart)).translate;var S=K(d3.select(o.nodeEnd)).translate;var x=o.nodeStart.getBBox();var T=o.nodeEnd.getBBox();var N=x.width/2;var C=T.width/2;var k=3;var L=g>0?5*o.offsetXmin+k:-5*o.offsetXmax-k;var A=g>0?-5*o.offsetXmax-k:5*o.offsetXmin+k;var O=5;var M=w[0]+N+L;var _=S[0]+C+A;var D=_-M-g*2*O;if(i.wordY==null){var P=i.vis.selectAll("g.word");i.wordY=0;i.wordHeight=0;for(var n=0;n<P[0].length;++n){var H=P[0][n].getBBox();if(i.wordY>H.y){i.wordY=H.y}if(i.wordHeight<H.height){i.wordHeight=H.height}}}var B=o.nodeStart.className.animVal=="chunk"?x.height:x.height+i.wordY;var j=o.nodeEnd.className.animVal=="chunk"?T.height:T.height+i.wordY;var F=o.nodeStart.className.animVal=="chunk"?0:i.wordY;var I=o.nodeEnd.className.animVal=="chunk"?0:i.wordY;var q=b>0?F:B;var R=b>0?I:j;var U=w[1]+q;var z=S[1]+R;var W=15;var X=30;var V=-b*W-X*o.strate;var $=-(V+U-z);var J=(1+g*b)/2;var Q=(1+g*b)/2;var Z=l;var et="transparent";if(m){et=y(l)}var tt=s.components!=null?s.components.highlightPath:r.append("path");tt.attr("d","M "+M+","+U+" v "+V+" a 5 5 0 0 "+J+" "+g*O+" "+ -b*O+" h "+D+" a 5 5 0 0 "+Q+" "+g*O+" "+b*O+" v "+$).attr("stroke",et).attr("stroke-width",G(c)+3).attr("fill","none");var nt=s.components!=null?s.components.path:r.append("path");nt.attr("d","M "+M+","+U+" v "+V+" a 5 5 0 0 "+J+" "+g*O+" "+ -b*O+" h "+D+" a 5 5 0 0 "+Q+" "+g*O+" "+b*O+" v "+$).attr("stroke",l).attr("stroke-width",c).attr("fill","none");if(d){nt.attr("marker-end","url(#"+i.viewer.appendOwnID("arrow")+")")}var rt=s.components!=null?s.components.label:r.append("text");rt.text(t.label).style("fill",f).style("font-weight",h).style("font-style",p).style("font-size",a);var it=rt.node().getBBox();rt.attr("x",-it.width/2+M+D/2+g*O).attr("y",G(Y(-G(u.top),U,V,-b*O)));s.components={highlightPath:tt,path:nt,label:rt}}function d(e,t,n){if(e.selected||!n&&e.getStyle("highlighted",false)){return}if(n){l(e,"highlighted",t)}var r=e.getStyle("link-color");var i=e.getStyle("font-weight");if(t!==false){e.components.highlightPath.attr("stroke",y(r));e.components.label.style("font-weight","bold")}else{e.components.highlightPath.attr("stroke","transparent");e.components.label.style("font-weight",i)}}function v(e,t,n){if(e.selected||!n&&e.getStyle("highlighted",false)){return}if(n){l(e,"highlighted",t)}e.components.rect.style("fill",t?"yellow":"transparent")}function m(e,t,n){if(e.classList!=null&&e.classList.length>0){var r=e.classList[0];if(r=="link"){d(e,t,n)}else if(r="word"){v(e,t,n)}}}function g(e){return e.getStyle("highlighted",false)}function y(e){if(e=="#000000"||e.slice(0,1)!="#")return"yellow";var t=-.3;var n=et(e);var r=tt(n.r,n.g,n.b);r.l+=t;r.l=r.l<0?0:r.l>1?1:r.l;n=nt(r.h,r.s,r.l);return Z(n.r,n.g,n.b)}function b(e,t){return E(e)*2<t.min*2||E(e)*2>t.max*2}function w(e,t){return E(e)*2>t.min*2&&E(e)*2<t.max*2}function E(t){if(t.__data__["#position"]!=null)return t.__data__["#position"];else{var n=e.DepGraph.getInstance(t);var r=Math.floor(t.__data__["elements"].length/2);var i=n.getWordNodeByOriginalId(t.__data__["elements"][r]);return i.__data__["#position"]}}function S(e,t,n){var r=t.split("/");var i=e;for(var s=0;s<r.length-1;s++){var o=i[r[s]];if(typeof o=="object"){if(o==null){i[r[s]]=new Object}i=null;i=o}else{}}var u=V(i[r[r.length-1]]);i[r[r.length-1]]=n;return u}function x(e,t){if(e.editObject.highlightMode){var n=!g(this);m(this,n,true)}e.editObject.selectObject(this)}function T(e,t){if(t.baseAction=="linkRemoval"){var n=t.link;var r=e.getWordNodeByOriginalId(n.__data__["source"]);var i=e.getWordNodeByOriginalId(n.__data__["target"]);R(e,r,i,n.__data__.label,n.color,n.__data__["#id"])}else if(t.baseAction=="linkAddition"){U(e,t.addedLink["#id"])}else if(t.baseAction=="wordAddition"){q(e,t.addedWord["#id"])}else if(t.baseAction=="wordRemoval"){var s=t.word;F(e,s);if(t.affectedLinks!=null){for(var o=0;o<t.affectedLinks.length;o++){var n=t.affectedLinks[o];var r=e.getWordNodeByOriginalId(n["source"]);var i=e.getWordNodeByOriginalId(n["target"]);n.color=n["#style"]["link-color"]?n["#style"]["link-color"]:e.data.graph["#link-style"]["link-color"];R(e,r,i,n.label,n.color,n["#id"])}}}else if(t.baseAction=="changeAttr"){var u=t.obj["#id"];var a=e.getObjectById(u);e.editObject.changeAttributes(a,t.oldAttrs);e.update();e.postProcesses()}}function N(e,t){}function C(e,t){if(t.keyCode==46){if(e.editObject.previousSelectedObject!=null){if(z(e.editObject.previousSelectedObject)){var n=V(e.editObject.previousSelectedObject);n.color=f(e.editObject.previousSelectedObject,"link-color","black");var r=U(e,e.editObject.previousSelectedObject.__data__["#id"]);e.editObject.previousSelectedObject=null;if(r){return{baseAction:"linkRemoval",link:n}}}else if(W(e.editObject.previousSelectedObject)){var i=V(e.editObject.previousSelectedObject.__data__);var s=q(e,e.editObject.previousSelectedObject.__data__["#id"]);e.editObject.previousSelectedObject=null;return{baseAction:"wordRemoval",word:i,affectedLinks:s}}}}}function k(e,t){var n=e.viewer.screenCoordsForElt(t[0]);var r={x:(n.ne.x+n.nw.x)/2,y:n.nw.y};var i=_(e,t[0]);e.viewer.loadTooltipContent(i);e.viewer.tooltipExitButton.show();e.viewer.showTooltip(r)}function L(e,t,n){var r=n["#style"]!=null&&n["#style"]["link-color"]!=null?n["#style"]["link-color"]:e.data.graph["#link-style"]["link-color"];t+='<tr><td>label</td><td><input type="text" name="label" value="'+n.label+'"></td></tr>';t+="<tr><td>source</td><td>"+M(e,n.source)+"</td></tr>";t+="<tr><td>target</td><td>"+M(e,n.target)+"</td></tr>";t+="<tr><td>color</td><td>"+O("colorPicker",r)+"</td></tr>";return t}function A(e,t,n){t+='<tr><td>label</td><td><input type="text" name="label" value="'+n.label+'"></td></tr>';for(var r=0;r<n.sublabel.length;r++){t+="<tr><td>sublabel"+r+'</td><td><input type="text" name="sublabel'+r+'" value="'+n.sublabel[r]+'"></td></tr>'}return t}function O(e,t){var n='<table><tr><td><input type="text" name="'+e+'" value="'+t+'" onkeydown="jQuery(jQuery(jQuery(this).parent().parent().children()[1]).children()[0]).css(\'background-color\',this.value+String.fromCharCode(event.keyCode));"></td><td><div style="display:inline-block; width:30px; height:30px; background-color:'+t+';"></div></td></tr></table>';return n}function M(e,t){var n="<select>";for(var r in e.data.graph.words){var i=e.data.graph.words[r];n+='<option value="'+i.id+'" ';n+=i.id==t?'selected="true"':"";n+=">#"+i["#position"]+" "+i["label"]+" ("+i.id+")";n+="</option>"}n+="</select>";return n}function _(e,t){var n=t.__data__;var r="";if(t.classList!=null&&t.classList.length>0){r=t.classList[0]}var i="<div>"+'<h3 id="edit-info-title">Edit '+r+" (original id: "+n.id+")</h3>"+'<table class="main-properties-table" ref="'+n["#id"]+'">';if(r=="word"){i=A(e,i,n)}else if(r=="link"){i=L(e,i,n)}else{}i+="</table>";i+='<input id="'+e.viewer.appendOwnID(r+"-save-properties")+'" type="button" value="Save" onclick="saveProperties.call(this,arguments);">';i+="</div>";var s=jQuery(i);return s}function D(){var t=this.id.substring(0,this.id.indexOf("-"));var n=e.DepGraph.getInstance(this);var r=n.viewer;var i=jQuery(this).parent().find("table.main-properties-table");if(t=="link"){P(n,i)}else if(t=="word"){H(n,i)}else{}n.update();n.postProcesses();r.hideToolTip()}function P(e,t){var n=e.getLinkById(t.attr("ref"));var r=t[0].rows;var i=[];for(var s=0;s<r.length;s++){var o=r[s];var u=o.cells;var a=u[0].innerHTML;var f=u[1];if(a=="label"){i.push({path:"label",value:f.firstChild.value})}else if(a=="color"){i.push({path:"#style/link-color",value:f.firstChild.rows[0].cells[0].firstChild.value})}else if(a=="source"){i.push({path:"source",value:f.childNodes[0].options[f.childNodes[0].options.selectedIndex].value})}else if(a=="target"){i.push({path:"target",value:f.childNodes[0].options[f.childNodes[0].options.selectedIndex].value})}else{}}e.editObject.changeAttributes(n,i,true)}function H(e,t){var n=e.getWordNodeById(t.attr("ref")).__data__;var r=t[0].rows;var i=[];for(var s=0;s<r.length;s++){var o=r[s];var u=o.cells;var a=u[0].innerHTML;var f=u[1];if(a=="label"){i.push({path:"label",value:f.firstChild.value})}else if(a.substring(0,8)=="sublabel"){i.push({path:"sublabel/"+a.substring(8),value:f.firstChild.value})}else{}}e.editObject.changeAttributes(n,i,true)}function B(e,t){if(e.editObject.previousSelectedObject==null||z(e.editObject.previousSelectedObject)){x.call(this,e,t)}else{if(this.__data__["#id"]==e.editObject.previousSelectedObject.__data__["#id"]){e.editObject.clearSelection();return}j(e,e.editObject.previousSelectedObject,this,t)}}function j(e,t,n,r){var i=e.viewer.screenCoordsForElt(n);var s={x:(i.ne.x+i.nw.x)/2,y:i.nw.y};var o='<div><table style="margin:5px 0px 0px 0px;">'+"<tr><td>Link name : </td>"+'<td><input type="text" name="link-name" value=""></td></tr>'+"<tr><td>Link color : </td>"+'<td><input type="text" name="link-color" value="black"></td></tr>'+'<tr><td colspant="2"><input id="link-settings'+e.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Create Link"></td></tr>'+"</table></div>";o=jQuery(o);e.viewer.loadTooltipContent(o);e.editObject.clearSelection();jQuery("#link-settings"+e.viewer.appendOwnID("")).click(function(){var i=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value;var s=this.parentNode.parentNode.parentNode.childNodes[1].childNodes[1].childNodes[0].value;var o=R(e,t,n,i,s);var u={baseAction:"linkAddition",addedLink:o};e.editObject.pushAction({mode:e.editObject.editMode,rollbackdata:u,data:{event:"onWordSelect",params:r}});e.viewer.hideToolTip()});e.viewer.tooltipExitButton.show();e.viewer.showTooltip(s)}function F(e,t){var n=t["#position"];e.insertWord(t,n);e.editObject.init();e.autoHighLightOnMouseOver();return V(t)}function I(e,t,n){var r=e.viewer.screenCoordsForElt(t);var i={x:(r.ne.x+r.nw.x)/2,y:r.nw.y};var s='<div><table style="margin:5px 0px 0px 0px;">'+"<tr><td>Word label : </td>"+'<td><input type="text" name="word-label" value=""></td></tr>'+'<tr><td colspant="2"><input id="word-settings'+e.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Insert Word"></td></tr>'+"</table></div>";s=jQuery(s);e.viewer.loadTooltipContent(s);e.editObject.clearSelection();jQuery("#word-settings"+e.viewer.appendOwnID("")).click(function(){var r=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value;if(r==null||r==""){alert("you must fill all required fields");return}var i={label:r,"#position":t.__data__["#position"]+n};var s=F(e,i);var o={baseAction:"wordAddition",addedWord:s};e.editObject.pushAction({mode:e.editObject.editMode,rollbackdata:o,data:{event:"onWordContext",params:t}});e.viewer.hideToolTip()});e.viewer.tooltipExitButton.show();e.viewer.showTooltip(i)}function q(e,t){var n=e.removeWord(t);return n}function R(e,t,n,r,i,s){if(i==null){i="black"}if(s==null){s=e.id++}t=t.__data__;n=n.__data__;var o=new Object;o.source=t.id;o.target=n.id;o["#style"]={"link-color":i};o.label=r;o["#id"]=s;e.addLink(o);e.editObject.init();e.autoHighLightOnMouseOver();return o}function U(e,t){var n=e.removeLink(t);return n}function z(e){return e.__data__.target!=null&&e.__data__.source!=null}function W(e){return e.__data__["#position"]!=null}function X(e){return e.elements!=null}function V(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date){var t=new Date;t.setTime(e.getTime());return t}if(e instanceof Array){var t=[];for(var n=0,r=e.length;n<r;n++){t[n]=V(e[n])}return t}if(e instanceof Object){var t={};for(var i in e){if(e.hasOwnProperty(i))t[i]=V(e[i])}return t}throw new Error("Unable to copy obj! Its type isn't supported.")}function $(e,t,n){e.attr("transform","translate("+t+","+n+")")}function J(e,t){var n=t.node().getBBox();var r=e.node().getBBox();e.attr("x",-r.width/2+n.width/2)}function K(e){var t=e.attr("transform");var n=/(\w+)\((.*?)\)/g;var r=new Object;var i;while((i=n.exec(t))!=null){var s=/(-*\w+\.*\w*)/g;r[i[1]]=[];var o;while((o=s.exec(i[2]))!=null){r[i[1]].push(parseFloat(o[1]))}}return r}function Q(e,t){function i(e,t,n,r){for(var s in e){if(!e.hasOwnProperty(s)){continue}if(s=="id"){n[e[s]]=e;continue}var o=typeof e[s];if(o=="object"){i(e[s],t,n,r)}else if(o=="string"){if(e[s].indexOf(t)==0){var u=e[s].substring(1);if(n[u]!=null){e[s]=n[u];i(e[s],t,n,r)}else{r.push[e[s]]}}}}}var n=[];var r=[];i(e,t,n,r);for(elt in r){if(n[elt]==null){throw"This object has missing references!"}else{elt=n[elt]}}}function G(e){var t=/(-*)(\d+\.*\d*)px/;var n=t.exec(e);if(n!=null){var r=n[1].length%2==0?"":"-";e=r+n[2]}return parseFloat(e)}function Y(){var e=0;for(var t=0;t<arguments.length;t++){var n=G(arguments[t]);e+=parseInt(n)}return e+"px"}function Z(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}function et(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function tt(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n);var s,o,u=(r+i)/2;if(r==i){s=o=0}else{var a=r-i;o=u>.5?a/(2-r-i):a/(r+i);switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4;break}s/=6}return{h:s,s:o,l:u}}function nt(e,t,n){var r,i,s;if(t==0){r=i=s=n}else{function o(e,t,n){if(n<0)n+=1;if(n>1)n-=1;if(n<1/6)return e+(t-e)*6*n;if(n<1/2)return t;if(n<2/3)return e+(t-e)*(2/3-n)*6;return e}var u=n<.5?n*(1+t):n+t-n*t;var a=2*n-u;r=o(a,u,e+1/3);i=o(a,u,e);s=o(a,u,e-1/3)}return{r:Math.floor(r*255),g:Math.floor(i*255),b:Math.floor(s*255)}}e.GraphViewer=function(t,n){if(n==null){n=Math.floor(Math.random()*1e16).toString()}this.allowFullScreen=true;this.imagemode=false;this.debugPanelActive=false;this.fixedToolbar=false;this._height="600px";this._width="100%";this.basemargin=10;this.margin={top:100,left:0,right:0,bottom:10};var n=this.uid=n;if(typeof t=="string"){t=jQuery(t)}var t=this.container=t;t.css("display","inline-block");var r=this.mainpanel=this.createDiv("gv-main-panel","gv-main-panel");t.append(r);var i=this.chart=this.createDiv("gv-chart","gv-chart");r.append(i);var s=this.toolbar=this.initToolBar();var o=this.debugpanel=this.createDebugPanel();this.tooltip=this.createToolTipPanel();this.tooltip.hide();this.altpanel=this.createDiv("gv-alt-panel","gv-alt-panel");this.altpanelcontent=this.createDiv("alt-panel-content","alt-panel-content");this.ajaxLoader=this.createDiv("ajax-loader","ajax-loader");this.ajaxLoader.hide();this.mainpanel.append(this.ajaxLoader);this.extraDiv=this.createDiv("gv-extra","gv-extra");this.extraDiv.hide();this.mainpanel.append(this.extraDiv);r.append(this.tooltip);r.append(this.altpanel);this.altpanel.append(this.altpanelcontent);e.GraphViewer.instances[n]=this;this.callbacks=new Object;this.callbacks.fullscreen=new Object;this.callbacks.fullscreen.oncomplete=[];this.callbacks.fullscreen.onclose=[];this.callbacks.showaltpanel=[];this.callbacks.hidealtpanel=[];this.toolbar.hide();this.toolbar_landing_area.hover(function(){var t=e.GraphViewer.getInstance(this);if(!t.fixedToolbar){t.toolbar.slideDown(100)}},function(){var t=e.GraphViewer.getInstance(this);if(!t.fixedToolbar){t.toolbar.slideUp(100)}})};e.GraphViewer.instances=[];e.GraphViewer.getInstance=function(t){var n="";if(e.GraphViewer.prototype.isPrototypeOf(t)){return t}else if(t.ownerSVGElement!=null){n=t.ownerSVGElement.parentNode.id}else if(typeof t=="object"&&t.id!=null){n=t.id}else{n=t}regex=/.*-(\w+)/;var r=regex.exec(n);var i=null;if(r!=null){i=e.GraphViewer.instances[r[1]]}if(i==null){i=e.GraphViewer.getInstance(t.parentNode)}return i};e.GraphViewer.prototype.initToolBar=function(){var e=this.toolbar_landing_area=this.createDiv("gv-toolbar-landing-area","gv-toolbar-landing-area");var t=this.createDiv("gv-toolbar","gv-toolbar");e.append(t);this.mainpanel.append(this.toolbar_landing_area);this.addFullScreenButton();return t};e.GraphViewer.prototype.createDebugPanel=function(){var t=this.debugpanel=this.createDiv("gv-debug-panel","gv-debug-panel");this.debugpanelinfo=this.createDiv("debug-panel-info","debug-panel-info");t.append(this.debugpanelinfo);var n=this.createDiv("debug-panel-slider","debug-panel-slider slider-button slide-up");n.click(u);t.append(n);var r=this.createDiv("debug-panel-fullscreen","debug-panel-fullscreen slider-button maximize");r.click(function(t){var n=e.GraphViewer.getInstance(this);if(n!=null){n.viewAltContent("debug-panel-content"+n.appendOwnID(""));var r=jQuery("#debug-panel-slider"+n.appendOwnID(""));if(r.hasClass("slide-down")){o.call(r)}}});t.append(r);var i=this.debugcontentcontainer=this.createDiv("debug-panel-container","debug-panel-container");t.append(i);this.debugpanelcontent=this.createDiv("debug-panel-content","debug-panel-content");i.append(this.debugpanelcontent);this.mainpanel.append(t);this.adjustDebugHeight();t.hide();return t};e.GraphViewer.prototype.debugLog=function(e){this.debugpanelcontent.append(e+"<br/>")};e.GraphViewer.prototype.createToolTipPanel=function(){var e=this;this.tooltip=this.createDiv("gv-tooltip","gv-tooltip");var t=jQuery('<div style="display:inline-block;"></div>');this.tooltip.append(t);this.tooltipExitButton=this.createDiv("tooltip-exit-button","tooltip-exit-button");this.tooltipExitButton.css("float","right");this.tooltipExitButton.css("display","block");this.tooltipExitButton.click(function(){e.hideToolTip()});t.append(this.tooltipExitButton);this.tooltipExitButton.hide();this.tooltip.draggable();this.tooltipContainer=this.createDiv("tooltip-container");t.append(this.tooltipContainer);return this.tooltip};e.GraphViewer.prototype.appendOwnID=function(e){if(e.endsWith(this.uid)){return e}else{return e+"-"+this.uid}};e.GraphViewer.prototype.addWrapper=function(e){var t=this;var n=this.wrapper=t.createElement("a","gv-wrapper","gv-wrapper");n.html(e);t.container.prepend(n);t.mainpanel.hide();n.click(function(e){t.mainpanel.toggle()});return n};e.GraphViewer.prototype.createDiv=function(e,t){return this.createElement("div",e,t)};e.GraphViewer.prototype.createElement=function(e,t,n){n=n!=null?'class="'+n+'"':"";var r="<"+e+' id="'+this.appendOwnID(t)+'" '+n+"></"+e+">";return jQuery(r)};e.GraphViewer.prototype.adjustDebugHeight=function(){var e=this.mainpanel.height()-this.toolbar.height();this.debugpanel.css("height",e);this.debugcontentcontainer.css("height",e-20);this.debugpanel.css("bottom",-e+20)};e.GraphViewer.prototype.shrinkHeightToContent=function(e){if(e==null){e=0}var t=d3.select(this.chart.children()[0]).select("g");var n=t.node().getBBox();var r=K(t);this.setHeight(r.translate[1]+n.y+n.height+e)};e.GraphViewer.prototype.shrinkWidthToContent=function(e){if(e==null){e=0}var t=d3.select(this.chart.children()[0]).select("g");var n=t.node().getBBox();var r=K(t);this.setWidth(r.translate[0]+n.x+n.width+marginLeft)};e.GraphViewer.prototype.shrinkToContent=function(e,t){if(t==null){t=0}if(e==null){e=0}var n=d3.select(this.chart.children()[0]).select("g");var r=n.node().getBBox();var i=K(n);var s=this.mainpanel.width();var o=i.translate[0]+r.x+r.width+e;this.setSize(o,i.translate[1]+r.y+r.height+t)};e.GraphViewer.prototype.setSize=function(e,t){this.setWidth(e);this.setHeight(t)};e.GraphViewer.prototype.setImageMode=function(e){if(e==null){e=true}this.imagemode=e;if(e){this.toolbar.detach();this.debugpanel.detach();this.tooltip.detach()}else{mainpanel.append(this.toolbar);mainpanel.append(this.debugpanel);mainpanel.append(this.tooltip)}this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20);this.margin.bottom=this.basemargin+(this.imagemode?0:20)};e.GraphViewer.prototype.noBorders=function(){if(this.imagemode){this.mainpanel.css("border","none")}};e.GraphViewer.prototype.debugMode=function(e){if(e==null){e=true}this.debugPanelActive=e;if(e){this.debugpanel.show()}else{this.debugpanel.hide()}};e.GraphViewer.prototype.setWidth=function(e){this._width=e;this.mainpanel.css("width",e);this.ajaxLoader.width(e)};e.GraphViewer.prototype.setHeight=function(e){this._height=e;this.mainpanel.css("height",e);this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20);this.margin.bottom=this.basemargin+this.imagemode?0:20;this.ajaxLoader.height(e-this.toolbar.height());this.ajaxLoader.css("top",this.toolbar.height());if(this.debugPanelActive){this.adjustDebugHeight()}};e.GraphViewer.prototype.setFixedToolbar=function(e){if(e==null){e=true}this.fixedToolbar=e;if(e){this.toolbar.show()}else{this.toolbar.hide()}};e.GraphViewer.prototype.addFullScreenButton=function(){if(!this.allowFullScreen){return}if(typeof this.container.colorbox!="undefined"){this.addToolbarButton("fullscreen",null,"right","fullscreen");this.initFullscreenMode()}};e.GraphViewer.prototype.existToolbarButton=function(e){return jQuery("#button-"+this.appendOwnID(e)).length>0};e.GraphViewer.prototype.getToolbarButton=function(e){return jQuery("#button-"+this.appendOwnID(e))};e.GraphViewer.prototype.setToolbarButtons=function(e){this.tmpLeft=[];e.forEach(function(e,t){if(e[2]=="left"){this.tmpLeft.push(e)}else{this.addToolbarButton(e[0],e[1],e[2],e[3])}},this);this.tmpLeft.forEach(function(e,t){this.addToolbarButton(e[0],e[1],e[2],e[3])},this);this.tmpLeft=null};e.GraphViewer.prototype.resetToolbarButtons=function(){var e=jQuery("#"+this.appendOwnID("gv-toolbar")).children();e.remove();this.addFullScreenButton()};e.GraphViewer.prototype.addToolbarElement=function(e,t){e.css("float",t);jQuery("#"+this.appendOwnID("gv-toolbar")).append(e)};e.GraphViewer.prototype.addToolbarButton=function(e,t,n,r){var i="";if(r==null){r="button white";i=e}else{r+=" icon"}if(n==null){n="left"}var s='<div id="button-'+this.appendOwnID(e)+'" title="'+e+'" class="'+r+" tab "+n+'">'+i+"</div>";s=jQuery(s);s.click(t);jQuery("#"+this.appendOwnID("gv-toolbar")).append(s)};e.GraphViewer.prototype.removeToolbarButton=function(e){jQuery("#button-"+this.appendOwnID(e)).remove()};e.GraphViewer.prototype.viewAltContent=function(e){this.resetAltPanel();this.addContentToAltPanel(e);this.showAltPanel()};e.GraphViewer.prototype.hideAltPanel=function(){this.chart.show();this.altpanel.hide();this.removeToolbarButton("back");a(this.callbacks.hidealtpanel)};e.GraphViewer.prototype.showAltPanel=function(t){this.chart.hide();this.altpanel.show();this.addToolbarButton("back",function(){e.GraphViewer.getInstance(this.id).hideAltPanel()},"left","back");a(this.callbacks.showaltpanel)};e.GraphViewer.prototype.addContentToAltPanel=function(t,n){this.altpanelcontent.html(jQuery("#"+this.appendOwnID(t)).html());if(n!=null){this.addToolbarButton(n,function(){e.GraphViewer.getInstance(this.id).addContentOnAltPanel(t)},"left")}};e.GraphViewer.prototype.resetAltPanel=function(){this.altpanelcontent.html("")};e.GraphViewer.prototype.loadTooltipContent=function(t){var n;var r=e.GraphViewer.getInstance(this);if(typeof t=="string"){n=jQuery("#"+r.appendOwnID(t))}else{n=t}r.tooltipContainer.html(n.html());r.tooltip.draggable()};e.GraphViewer.prototype.lockTooltip=function(){var t=e.GraphViewer.getInstance(this);t.tooltip.draggable("destroy")};e.GraphViewer.prototype.showTooltip=function(t){var n=e.GraphViewer.getInstance(this);n.tooltip.css("left",t.x);n.tooltip.css("top",t.y);n.tooltip.show()};e.GraphViewer.prototype.hideToolTip=function(){var t=e.GraphViewer.getInstance(this);t.tooltip.hide()};e.GraphViewer.prototype.ajaxStart=function(){this.ajaxLoader.show()};e.GraphViewer.prototype.ajaxFinished=function(){this.ajaxLoader.hide()};e.GraphViewer.prototype.initFullscreenMode=function(){var e=this;var t=jQuery("#button-fullscreen"+this.appendOwnID(""));t.colorbox({inline:true,href:"#"+"gv-main-panel"+e.appendOwnID(""),width:"95%",height:"95%",onLoad:function(){e.removeToolbarButton("fullscreen");e.mainpanel.width("99%");e.mainpanel.height("99%");e.adjustDebugHeight()},onComplete:function(){a(e.callbacks.fullscreen.oncomplete)},onClosed:function(){e.mainpanel.width(e._width);e.mainpanel.height(e._height);e.addToolbarButton("fullscreen",null,"right","fullscreen");e.adjustDebugHeight();e.initFullscreenMode();a(e.callbacks.fullscreen.onclose)}})};String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1};e.GraphViewer.prototype.screenCoordsForElt=function(e){while(Object.prototype.toString.call(e)==="[object Array]"){e=e[0]}var t=e.getBBox();var n=this.chart[0].querySelector("svg");var r=n.createSVGPoint();var i={};var s=e.getScreenCTM();r.x=t.x;r.y=t.y;i.nw=r.matrixTransform(s);r.x+=t.width;i.ne=r.matrixTransform(s);r.y+=t.height;i.se=r.matrixTransform(s);r.x-=t.width;i.sw=r.matrixTransform(s);return i};e.DepGraph=function(t,n,r){this.options=r||{};this.viewer=new e.GraphViewer(t,this.options.uid);e.DepGraph.instances[this.viewer.uid]=this;this.callbacks=new Object;this.setData(n);this.original_data=V(this.data);this.createLayout();this.update();this.postProcesses();this.autoHighLightOnMouseOver();this.viewerSettings();this.editObject=new e.EditObject(this)};e.DepGraph.prototype.viewerSettings=function(){this.viewer.callbacks.fullscreen.oncomplete.push({method:this.rescale,caller:this});this.viewer.callbacks.fullscreen.onclose.push({method:this.rescale,caller:this})};e.DepGraph.prototype.rescale=function(){var e=this.viewer.chart;var t=e[0].getBoundingClientRect();var n=this.vis.node().getBBox();var r=(t.width-n.width)/2;var i=(t.height-n.height)/2;i=i>0?i:G(this.data.graph["#style"].margin.top);r=r>0?r:G(this.data.graph["#style"].margin.left);this.vis.attr("transform","translate("+(r-n.x)+","+(i-n.y)+") scale(1)")};e.DepGraph.prototype.autoHighLightOnMouseOver=function(e){if(e==null||e){this.vis.selectAll("g.link").on("mouseover.autohighlight",function(){d(this,true)});this.vis.selectAll("g.link").on("mouseout.autohighlight",function(){d(this,false)});this.vis.selectAll("g.word").on("mouseover.autohighlight",function(){v(this,true)});this.vis.selectAll("g.word").on("mouseout.autohighlight",function(){v(this,false)})}else{this.vis.selectAll("g.link").on("mouseover.autohighlight",null);this.vis.selectAll("g.link").on("mouseout.autohighlight",null);this.vis.selectAll("g.word").on("mouseover.autohighlight",null);this.vis.selectAll("g.word").on("mouseout.autohighlight",null)}};e.DepGraph.instances=[];e.DepGraph.getInstance=function(t){if(e.DepGraph.prototype.isPrototypeOf(t)){return t}else if(t.ownerSVGElement!=null){t=t.ownerSVGElement.parentNode.id}else if(typeof t=="object"&&t.id!=null){t=t.id}regex=/.*-(\w+)/;var n=regex.exec(t);if(n!=null){return e.DepGraph.instances[n[1]]}return null};e.DepGraph.prototype.setData=function(e){this.data=e;this.prepareData()};e.DepGraph.prototype.resetData=function(e){this.setData(e);this.createLayout();this.update();this.postProcesses();this.autoHighLightOnMouseOver();this.editObject.init()};e.DepGraph.prototype.cleanData=function(){var e=this.vis.selectAll("g.link");this.resetLinksProperties(e)};e.DepGraph.prototype.prepareData=function(){Q(this.data,"@");this.id=0;for(var e=0;this.data.graph.words&&e<this.data.graph.words.length;e++){var t=this.data.graph.words[e];t["#id"]=this.id++;t["#position"]=e}for(var e=0;this.data.graph.links&&e<this.data.graph.links.length;e++){this.data.graph.links[e]["#id"]=this.id++;this.data.graph.links[e]["#properties"]=null}for(var e=0;this.data.graph.chunks&&e<this.data.graph.chunks.length;e++){this.data.graph.chunks[e]["#id"]=this.id++}var n=this.data.graph["#style"]?this.data.graph["#style"]:this.data.graph["#style"]=new Object;var r=this.data.graph["#word-style"]?this.data.graph["#word-style"]:this.data.graph["#word-style"]=new Object;var i=this.data.graph["#link-style"]?this.data.graph["#link-style"]:this.data.graph["#link-style"]=new Object;var s=this.data.graph["#chunk-style"]?this.data.graph["#chunk-style"]:this.data.graph["#chunk-style"]=new Object;n["margin"]=n["margin"]?n["margin"]:{top:"50px",right:"20px",bottom:"20px",left:"20px"};n["margin"].top=n["margin-top"]?n["margin-top"]:n["margin"].top;n["margin"].right=n["margin-right"]?n["margin-right"]:n["margin"].right;n["margin"].left=n["margin-left"]?n["margin-left"]:n["margin"].left;n["margin"].bottom=n["margin-bottom"]?n["margin-bottom"]:n["margin"].bottom;n["background-color"]=n["background-color"]?n["background-color"]:"white";n["font-family"]=n["font-family"]?n["font-family"]:"inherit";r["margin"]=r["margin"]?r["margin"]:{top:"10px",right:"15px",bottom:"10px",left:"15px"};r["sub-margin"]=r["sub-margin"]?r["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"};r["font-size"]=r["font-size"]?r["font-size"]:"14px";r["sub-font-size"]=r["sub-font-size"]?r["sub-font-size"]:"10px";r["color"]=r["color"]?r["color"]:"black";r["sub-color"]=r["sub-color"]?r["sub-color"]:"black";r["font-weight"]=r["font-weight"]?r["font-weight"]:"normal";r["sub-font-weight"]=r["sub-font-weight"]?r["sub-font-weight"]:"normal";r["font-style"]=r["font-style"]?r["font-style"]:"normal";r["sub-font-style"]=r["sub-font-style"]?r["sub-font-style"]:"normal";i["margin"]=i["margin"]?i["margin"]:{top:"5px",right:"10px",bottom:"10px",left:"10px"};i["font-size"]=i["font-size"]?i["font-size"]:"12px";i["color"]=i["color"]?i["color"]:"black";i["link-color"]=i["link-color"]?i["link-color"]:"#000000";i["link-size"]=i["link-size"]?i["link-size"]:"2px";i["font-weight"]=i["font-weight"]?i["font-weight"]:"normal";i["font-style"]=i["font-style"]?i["font-style"]:"normal";i["oriented"]=i["oriented"]?i["oriented"]:true;i["align"]=i["align"]?i["align"]:"center";i["higlighted"]=false;s["margin"]=s["margin"]?s["margin"]:{top:"10px",right:"10px",bottom:"10px",left:"10px"};s["sub-margin"]=s["sub-margin"]?s["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"};s["font-size"]=s["font-size"]?s["font-size"]:"12px";s["sub-font-size"]=s["sub-font-size"]?s["sub-font-size"]:"10px";s["background-color"]=s["background-color"]?s["background-color"]:"transparent";s["color"]=s["color"]?s["color"]:"black";s["sub-color"]=s["sub-color"]?s["sub-color"]:"black";s["border-color"]=s["border-color"]?s["border-color"]:"black";s["font-weight"]=s["font-weight"]?s["font-weight"]:"normal";s["sub-font-weight"]=s["sub-font-weight"]?s["sub-font-weight"]:"normal";s["font-style"]=s["font-style"]?s["font-style"]:"normal";s["sub-font-style"]=s["sub-font-style"]?s["sub-font-style"]:"normal";s["border-size"]=s["border-size"]?s["border-size"]:"1px"};e.DepGraph.prototype.postProcesses=function(){var e=this.vis.node().getBBox();this.vis.attr("transform","translate("+(G(this.data.graph["#style"].margin.left)-e.x)+","+(G(this.data.graph["#style"].margin.top)-e.y)+") scale(1)");this.viewer.shrinkToContent(G(this.data.graph["#style"]["margin"].right),G(this.data.graph["#style"]["margin"].bottom)+20)};e.DepGraph.prototype.createLayout=function(){if(this.svg!=null){this.svg.remove()}this.svg=d3.select(this.viewer.chart[0]).append("svg").attr("width","100%").attr("height","100%");this.viewer.chart.css("background-color",this.data.graph["#style"]["background-color"]);this.setSVGDefs();this.vis=this.svg.append("g").attr("transform","translate("+G(this.data.graph["#style"].margin.left)+","+G(this.data.graph["#style"].margin.top)+") scale(1)");var t=this;d3.select(this.viewer.chart[0]).on("click.focus"+t.viewer.uid,function(e){depgraphActive="-"+t.viewer.uid});d3.select(document).on("keydown.move"+t.viewer.uid,function(t){var n=10;if(depgraphActive!=null){var r=e.DepGraph.getInstance(depgraphActive);if(d3.event.keyCode==37){r.translateGraph(-n,0)}else if(d3.event.keyCode==39){r.translateGraph(n,0)}}})};e.DepGraph.prototype.translateGraph=function(t,n){var r=e.DepGraph.getInstance(this);var i=K(r.vis);r.vis.attr("transform","translate("+(i.translate[0]+t)+","+(i.translate[1]+n)+")"+" scale("+i.scale[0]+")")};e.DepGraph.prototype.redraw=function(){var t=e.DepGraph.getInstance(this.parentNode);var n=K(t.vis);t.vis.attr("transform","translate("+d3.event.translate[0]+","+n.translate[1]+")"+" scale("+d3.event.scale+")")};e.DepGraph.prototype.update=function(){var e;var t;if(this.data.graph.chunks!=null){e=this.chunks=this.vis.selectAll("g.chunk").data(this.data.graph.chunks,function(e){return e["#id"]});t=e.enter().append("g").classed("chunk",true)}var n=this.words=this.vis.selectAll("g.word").data(this.data.graph.words,function(e){return e["#id"]});var r=n.enter().append("g").classed("word",true);var i=n.exit();i.remove();n.each(c);if(this.data.graph.chunks!=null){t.each(h)}var s=this.links=this.vis.selectAll("g.link").data(this.data.graph.links,function(e){return e["#id"]});var o=s.enter().append("g").classed("link",true);var u=s.exit();u.remove();this.resetLinksProperties(s);this.preprocessLinksPosition(s);s.each(p)};e.DepGraph.prototype.insertWord=function(e,t){if(e["#id"]==null){e["#id"]=this.id++}if(e["id"]==null){e["id"]="_w"+e["#id"]}this.data.graph.words.splice(t,0,e);for(var n=t+1;n<this.data.graph.words.length;++n){this.data.graph.words[n]["#position"]++}this.update();this.postProcesses()};e.DepGraph.prototype.addLink=function(e){if(e["#id"]==null){e["#id"]=this.id++}this.data.graph.links.push(e);this.update();this.postProcesses()};e.DepGraph.prototype.addChunk=function(e){};e.DepGraph.prototype.removeWord=function(e){var t=[];var n=this.getWordIndexById(e);if(n==null){return false}var r=this.data.graph.words[n]["#position"];var i=this.data.graph.words[n].id;this.data.graph.words.splice(n,1);for(var s=r;s<this.data.graph.words.length;++s){this.data.graph.words[s]["#position"]--}for(var s=0;s<this.data.graph.links.length;s++){var o=this.data.graph.links[s];if(o.source==i||o.target==i){t.push(V(o));this.data.graph.links.splice(s,1);s--}}this.update();this.postProcesses();return t};e.DepGraph.prototype.removeLink=function(e){var t=this.getLinkIndexById(e);if(t==null){return false}this.data.graph.links.splice(t,1);this.update();this.postProcesses();return true};e.DepGraph.prototype.removeChunk=function(e){};e.DepGraph.prototype.getWordNodeByPosition=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["#position"]==e)return t[0][n]}return null};e.DepGraph.prototype.getWordNodeByOriginalId=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["id"]==e)return t[0][n]}};e.DepGraph.prototype.getChunkNodeByOriginalId=function(e){var t=this.vis.selectAll("g.chunk");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["id"]==e)return t[0][n]}};e.DepGraph.prototype.getWordNodeById=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["#id"]==e)return t[0][n]}};e.DepGraph.prototype.getWordIndexById=function(e){for(var t in this.data.graph.words){if(this.data.graph.words[t]["#id"]==e){return t}}};e.DepGraph.prototype.getLinkById=function(e){for(var t in this.data.graph.links){if(this.data.graph.links[t]["#id"]==e){return this.data.graph.links[t]}}};e.DepGraph.prototype.getLinkIndexById=function(e){for(var t in this.data.graph.links){if(this.data.graph.links[t]["#id"]==e){return t}}};e.DepGraph.prototype.getLinkIndexByOriginalId=function(e){for(var t in this.data.graph.links){if(this.data.graph.links[t].id==e){return t}}};e.DepGraph.prototype.getObjectById=function(e){for(var t in this.data.graph.words){if(this.data.graph.words[t]["#id"]==e){return this.data.graph.words[t]}}for(var t in this.data.graph.links){if(this.data.graph.links[t]["#id"]==e){return this.data.graph.links[t]}}for(var t in this.data.graph.chunks){if(this.data.graph.chunks[t]["#id"]==e){return this.data.graph.chunks[t]}}};e.DepGraph.prototype.getObjectNodeFromObject=function(e){};SVGElement.prototype.getStyle=function(t,n){var r=e.DepGraph.getInstance(this);if(this.__data__["#style"]!=null&&this.__data__["#style"][t]!=null){return this.__data__["#style"][t]}var i=null;if(this.className!=null){i=r.data.graph["#"+this.className.animVal+"-style"][t]}if(i==null&&n!=null){return n}else{return i}};e.DepGraph.prototype.setSVGDefs=function(){this.defs=this.svg.append("defs");this.defs.append("marker").attr("id",this.viewer.appendOwnID("arrow")).attr("viewBox","0 0 10 10").attr("refX","8").attr("refY","5").attr("markerUnits","strokeWidth").attr("orient","auto").attr("markerWidth","3").attr("markerHeight","3").append("polyline").attr("points","0,0 10,5 0,10 1,5").attr("fill","inherit")};e.DepGraph.prototype.crossed=function(e,t){var n=this.getLinkProperties(e);var r=this.getLinkProperties(t);return w(n.nodeStart,r)&&b(n.nodeEnd,r)||w(n.nodeEnd,r)&&b(n.nodeStart,r)};e.DepGraph.prototype.preprocessLinksPosition=function(e){this.sortLinksByLength(e[0]);var t=e[0].length;var n=[];for(var r=0;r<t;++r){var i=e[0][r];var s=this.getLinkProperties(i);var o=1;while(true){if(n[o]==null){n[o]=new Array;for(var u=s.min*2;u<s.max*2;u++){n[o][u]=i}s.strate=o;break}var a=null;for(var u=s.min*2;u<s.max*2;u++){if(n[o][u]!=null){a=n[o][u];if(this.crossed(i,a)){break}}}if(a!=null){var f=this.getLinkProperties(a);if(this.crossed(i,a)){o=-1;while(true){if(n[o]==null){n[o]=new Array;for(var u=s.min*2;u<s.max*2;u++){n[o][u]=i}s.strate=o;break}var l=null;for(var u=s.min*2;u<s.max*2;u++){if(n[o][u]!=null){l=n[o][u];break}}if(l!=null){o--}else{for(var u=s.min*2;u<s.max*2;u++){n[o][u]=i}s.strate=o;break}}break}else{o++}}else{for(var u=s.min*2;u<s.max*2;u++){n[o][u]=i}s.strate=o;break}}}for(var r=0;r<t;r++){var i=e[0][r];var s=this.getLinkProperties(i);var c;if(s.strate>0){c=-1}else{c=1}for(var o=s.strate;o!=0;o+=c){var h=n[o][s.min*2];if(h!=null&&h!=i){var f=this.getLinkProperties(h);if(f.min==s.min){f.offsetXmin++}}h=n[o][s.max*2-1];if(h!=null&&h!=i){var f=this.getLinkProperties(h);if(f.max==s.max){f.offsetXmax++}}}}};e.DepGraph.prototype.sortLinksByLength=function(e){var t=this;e.sort(function(e,n){return t.getLinkProperties(e).length-t.getLinkProperties(n).length})};e.DepGraph.prototype.getLinkProperties=function(e){var t=e.__data__;if(t["#properties"]==null){var n=new Object;n.nodeStart=this.getWordNodeByOriginalId(t.source);if(n.nodeStart==null){n.nodeStart=this.getChunkNodeByOriginalId(t.source)}n.nodeEnd=this.getWordNodeByOriginalId(t.target);if(n.nodeEnd==null){n.nodeEnd=this.getChunkNodeByOriginalId(t.target)}if(E(n.nodeStart)<E(n.nodeEnd)){n.min=E(n.nodeStart);n.max=E(n.nodeEnd);n.hdir=1}else{n.max=E(n.nodeStart);n.min=E(n.nodeEnd);n.hdir=-1}n.vdir=1;n.offsetXmax=0;n.offsetXmin=0;n.strate=0;n.length=n.max-n.min;n.outer=0;t["#properties"]=n}return t["#properties"]};e.DepGraph.prototype.resetLinksProperties=function(e){e.each(function(e,t){e["#properties"]=null})};e.EditObject=function(e){this.depgraph=e;this.editMode=false;this.mode=[];this.highlightMode=false;this.previousSelectedObject=null;this.actionsLog=[];this.currentPtr=-1;this.lastSavedPtr=-1;this.defaultMode={name:"default",onWordSelect:B,onLinkSelect:x,onChunkSelect:x,onWordContext:{"Show Infos":function(e,t){k(e,t)},"Add Node to the left":function(e,t){I(e,t[0],0)},"Add Node to the right":function(e,t){I(e,t[0],1)},Delete:function(e,t){var n=V(t[0].__data__);var r=q(e,t[0].__data__["#id"]);e.editObject.previousSelectedObject=null;return{baseAction:"wordRemoval",word:n,affectedLinks:r}}},onLinkContext:{"Show Infos":function(e,t){k(e,t)},Delete:function(e,t){var n=V(t[0]);n.color=f(t[0],"link-color","black");var r=U(e,t[0].__data__["#id"]);e.editObject.previousSelectedObject=null;if(r){return{baseAction:"linkRemoval",link:n}}}},onChunkContext:null,keyHandler:C,save:null,undo:T,redo:null};this.addEditMode(this.defaultMode)};e.EditObject.prototype.dataChanged=function(){if(this.actionsLog.length==0){return false}else{if(this.currentPtr==this.lastSavedPtr){return true}else{return false}}};e.EditObject.prototype.setEditMode=function(e){var t=this;if(e==null){e="default"}else{editModeExist=false;for(i in this.mode){if(this.mode[i].name==e){editModeExist=true;break}}if(!editModeExist){alert("this edition mode does not exist! switching to default mode");e="default"}}this.editMode=e;if(e){window.onbeforeunload=function(e){var t="Changes made to the graph are not saved. If you leave this page all modifications will be lost.";e=e||window.event;if(e){e.returnValue=t}return t}}else{window.onbeforeunload=null}this.init();this.initToolbar()};e.EditObject.prototype.initToolbar=function(){function n(){var t=e.editObject;t.highlightMode=!t.highlightMode;if(t.highlightMode){e.viewer.getToolbarButton("highlight").removeClass("highlightoff").addClass("highlighton")}else{e.viewer.getToolbarButton("highlight").removeClass("highlighton").addClass("highlightoff")}}function r(){var t=e.editObject;if(t.mode[t.editMode].save!=null){t.mode[t.editMode].save(e)}}function i(){var t=e.editObject;if(e.editObject.currentPtr==0){e.viewer.getToolbarButton("undo").hide()}var n=e.editObject.actionsLog[e.editObject.currentPtr];if(t.mode[n.mode].undo!=null){t.mode[n.mode].undo.call(t,e,n.rollbackdata)}e.editObject.currentPtr--;if(t.mode[n.mode].redo!=null){e.viewer.getToolbarButton("redo").show()}t.updateSaveState()}function s(){var t=e.editObject;e.editObject.currentPtr++;if(e.editObject.currentPtr==e.editObject.actionsLog.length-1){e.viewer.getToolbarButton("redo").hide()}var n=e.editObject.actionsLog[e.editObject.currentPtr];if(t.mode[n.mode].redo!=null){t.mode[n.mode].redo.call(t,e,n.rollbackdata)}e.viewer.getToolbarButton("undo").show();t.updateSaveState()}function o(){var t=this.getBoundingClientRect();var n={x:t.left,y:t.top+t.height+2};var r="<div>";r+="Export Format : "+'<select name="type">'+'<option value="json" selected>json</option>'+'<option value="depxml">depxml</option>'+'<option value="dep2pict">dep2pict</option>'+'<option value="conll">conll</option>'+"</select><br/>"+'<input id="export-data'+e.viewer.appendOwnID("")+'"  type="button" value="Export"></div>';r=jQuery(r);e.viewer.loadTooltipContent(r);e.viewer.lockTooltip();jQuery("#export-data"+e.viewer.appendOwnID("")).click(function(){var t=jQuery("select",this.parentNode);var n=t[0].options[t[0].selectedIndex].value;window.open("edit/export/"+n);e.viewer.hideToolTip()});e.viewer.tooltipExitButton.show();e.viewer.showTooltip(n)}var e=this.depgraph;e.viewer.resetToolbarButtons();var t=[["save",r,"right","saved"],["undo",i,"left","undo"],["redo",s,"left","redo"],["highlight",n,"left","highlightoff"],["export",o,"right","export"]];if(this.mode[this.editMode].buttons!=null){for(button in this.mode[this.editMode].buttons){t.push(button)}}e.viewer.setToolbarButtons(t);if(this.currentPtr<0||this.mode[this.editMode].undo==null){e.viewer.getToolbarButton("undo").hide()}if(this.currentPtr==this.actionsLog.length-1||this.mode[this.editMode].redo==null){e.viewer.getToolbarButton("redo").hide()}};e.EditObject.prototype.setNeedToSave=function(){this.depgraph.viewer.getToolbarButton("save").removeClass("saved").addClass("save")};e.EditObject.prototype.updateSaveState=function(){if(this.lastSavedPtr==this.currentPtr){this.depgraph.viewer.getToolbarButton("save").removeClass("save").addClass("saved")}else{this.depgraph.viewer.getToolbarButton("save").removeClass("saved").addClass("save")}};e.EditObject.prototype.init=function(){function n(t,n,r){var i=e.editObject;var n=n.menu;if(i.mode[i.editMode][t][n]!=null){var s=i.mode[i.editMode][t][n].call(this,e,r);i.pushAction({mode:i.editMode,rollbackdata:s,data:{event:"onContextClick",params:{object_type:t,menu:n,object:r}}})}}function r(t,n){var r=e.editObject;if(r.mode[r.editMode].onWordSelect!=null){var i=r.mode[r.editMode].onWordSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onWordSelect",params:{d:t,i:n}}})}}function i(t,n){var r=e.editObject;if(r.mode[r.editMode].onLinkSelect!=null){var i=r.mode[r.editMode].onLinkSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onLinkSelect",params:{d:t,i:n}}})}}function s(t,n){var r=e.editObject;if(r.mode[r.editMode].onChunkSelect!=null){var i=r.mode[r.editMode].onChunkSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onChunkSelect",params:{d:t,i:n}}})}}function o(t){var n=e.editObject;if(n.mode[n.editMode].keyHandler!=null){var r=n.mode[n.editMode].keyHandler.call(this,e,{keyCode:d3.event.keyCode});n.pushAction({mode:n.editMode,rollbackdata:r,data:{event:"keyHandler",params:{keyCode:d3.event.keyCode}}})}}var e=this.depgraph;if(!this.editMode){this.depgraph.vis.selectAll("g.word").on("click",null);this.depgraph.vis.selectAll("g.link").on("click",null);this.depgraph.vis.selectAll("g.chunk").on("click",null);d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,null);this.depgraph.viewer.resetToolbarButtons();jQuery(".link",this.depgraph.vis.node()).contextMenu("",{});jQuery(".word",this.depgraph.vis.node()).contextMenu("",{});jQuery(".chunk",this.depgraph.vis.node()).contextMenu("",{});return}this.depgraph.vis.selectAll("g.word").on("click",r);this.depgraph.vis.selectAll("g.link").on("click",i);this.depgraph.vis.selectAll("g.chunk").on("click",s);d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,o);if(this.mode[this.editMode].onLinkContext!=null){var t={};for(menu in this.mode[this.editMode].onLinkContext){t[menu]={menu:menu,click:function(e){n("onLinkContext",this,e)},klass:"menu-item-1"}}jQuery(".link",this.depgraph.vis.node()).contextMenu("link-context-menu",t)}if(this.mode[this.editMode].onWordContext!=null){var t={};for(menu in this.mode[this.editMode].onWordContext){t[menu]={menu:menu,click:function(e){n("onWordContext",this,e)},klass:"menu-item-1"}}jQuery(".word",this.depgraph.vis.node()).contextMenu("word-context-menu",t)}if(this.mode[this.editMode].onChunkContext!=null){var t={};for(menu in this.mode[this.editMode].onChunkContext){t[menu]={menu:menu,click:function(e){n("onChunkContext",this,e)},klass:"menu-item-1"}}jQuery(".chunk",this.depgraph.vis.node()).contextMenu("chunk-context-menu",t)}};e.EditObject.prototype.addEditMode=function(e){this.mode[e.name]=e};e.EditObject.prototype.pushAction=function(e){if(e.rollbackdata!=null&&this.mode[e.mode].undo!=null){this.depgraph.viewer.getToolbarButton("redo").hide();var t=this.depgraph.viewer.getToolbarButton("undo");t.show();this.actionsLog.splice(++this.currentPtr,this.actionsLog.length-this.currentPtr,e);this.updateSaveState()}};e.EditObject.prototype.clearSelection=function(){if(this.previousSelectedObject!=null){try{this.previousSelectedObject.selected=false;m(this.previousSelectedObject,false)}catch(e){}this.previousSelectedObject=null}};e.EditObject.prototype.selectObject=function(e){if(this.previousSelectedObject==e){this.clearSelection();return}this.clearSelection();this.previousSelectedObject=e;m(this.previousSelectedObject,true);e.selected=true};e.EditObject.prototype.changeAttributes=function(e,t,n){var r=V(e);var i=[];for(var s=0;s<t.length;s++){var o=S(e,t[s].path,t[s].value);i.push({path:t[s].path,value:o})}if(n!=null&&n){var u={mode:this.editMode,rollbackdata:{baseAction:"changeAttr",obj:r,attrs:t,oldAttrs:i}};this.pushAction(u)}};})(window.depgraphlib=window.depgraphlib||{},jQuery)