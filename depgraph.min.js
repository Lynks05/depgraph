(function(e,t,n){function r(){var e=jQuery(this);e.parent().animate({bottom:"0px"});e.removeClass("slide-up");e.addClass("slide-down")}function s(){var e=jQuery(this);var t=e.parent();t.animate({bottom:-t.height()+20+"px"});e.removeClass("slide-down");e.addClass("slide-up")}function o(){var e=jQuery(this);if(e.hasClass("slide-up")){r.call(e)}else{s.call(e)}}function u(e){for(var t=0;t<e.length;t++){e[t].method.call(e[t].caller,e[t].args)}}function a(e,t,n){if(e.__data__["#style"]!=null&&e.__data__["#style"][t]!=null){return e.__data__["#style"][t]}return n}function f(e,t,n){if(e.__data__["#style"]==null){e.__data__["#style"]={}}e.__data__["#style"][t]=n}function l(t,n){var r=d3.select(this);var i=r.node();var s=i.getStyle("font-size");var o=i.getStyle("sub-font-size");var u=i.getStyle("color");var a=i.getStyle("sub-color");var f=i.getStyle("font-weight");var l=i.getStyle("sub-font-weight");var c=i.getStyle("font-style");var h=i.getStyle("sub-font-style");var p=i.components!=null?i.components.rect:r.append("rect");var d=i.components!=null?i.components.text:r.append("text");var v=i.components!=null?i.components.label:d.append("tspan");var m=i.components!=null?i.components.sublabels:[];v.text(t.label).style("fill",u).style("font-style",c).style("font-weight",f).style("font-size",s);if(t.sublabel){for(var n=0;n<t.sublabel.length;++n){var g=null;if(m[n]!=null){g=m[n]}else{g=d.append("tspan");m.push(g)}g.text(t.sublabel[n]).style("font-size",o).style("font-style",h).style("font-weight",l).style("fill",a).attr("x","0px").attr("dy","1.25em")}}var y="none";if(t.selected!=null||i.getStyle("highlighted",false)){y="yellow"}var b=d.node().getBBox();p.attr("x",0).attr("y",b.y).attr("rx",10).attr("ry",10).attr("width",b.width).attr("height",b.height).style("stroke","transparent").style("fill",y).style("stroke-width",1);var w=e.DepGraph.getInstance(this);var E=w.getWordNodeByPosition(r.datum()["#position"]-1);var S=i.getStyle("margin");if(E!=null){var x=J(d3.select(E));var b=E.getBBox();var T=Q(G(x.translate[0],b.width,S.right,S.left));var N=Q(S.top);V(r,T,N)}else{var T=Q(S.left);var N=Q(S.top);V(r,T,N)}r.node().components={text:d,label:v,rect:p,sublabels:m}}function c(t,n){var r=d3.select(this);var i=e.DepGraph.getInstance(r.node());var s=r.node();var o=r.append("rect");var u={x:99999,y:99999};var a={x:0,y:0};for(var n=0;n<t.elements.length;n++){var f=i.getWordNodeByOriginalId(t.elements[n]);var l=J(d3.select(f));var c={x:l.translate[0],y:l.translate[1]};var h=f.getBBox();if(c.x+h.x<u.x){u.x=c.x+h.x}if(c.y+h.y<u.y){u.y=c.y+h.y}if(c.x+h.width+h.x>a.x){a.x=c.x+h.width+h.x}if(c.y+h.height+h.y>a.y){a.y=c.y+h.height+h.y}}var p=s.getStyle("margin");var d=s.getStyle("font-size");var v=s.getStyle("sub-font-size");var m=s.getStyle("color");var g=s.getStyle("sub-color");var y=s.getStyle("font-weight");var b=s.getStyle("sub-font-weight");var w=s.getStyle("font-style");var E=s.getStyle("sub-font-style");var S=s.getStyle("background-color");var x=s.getStyle("border-color");var T=s.getStyle("border-size");var N=r.append("line");N.attr("y1",G(a.y,2*Q(p.top))).attr("x1",0).attr("y2",G(a.y,2*Q(p.top))).attr("x2",a.x-u.x+Q(p.left)+Q(p.right)).style("stroke",x).style("stroke-width",T);var C=r.append("text");C.attr("y",G(20,a.y,2*Q(p.top)));C.append("tspan").text(t.label).style("fill",m).style("font-style",w).style("font-weight",y).style("font-size",d);if(t.sublabel){for(var n=0;n<t.sublabel.length;++n){var k=C.append("tspan").text(t.sublabel[n]).style("font-size",v).style("font-style",E).style("font-weight",b).style("fill",g).attr("dx",-(t.sublabel[n].length-1)*Q(v)).attr("dy","1.25em")}}$(C,r);var L=C.node().getBBox().height;o.attr("x",0).attr("y",0).attr("rx",10).attr("ry",10).attr("width",a.x-u.x+Q(p.left)+Q(p.right)).attr("height",G(a.y,-u.y,L,2*Q(p.top),20)).style("fill",S).style("stroke",x).style("stroke-width",T);r.node().components={text:C,rect:o};V(r,u.x-Q(p.left),u.y-Q(p.top))}function h(t,n){var r=d3.select(this);var i=e.DepGraph.getInstance(this);var s=this;var o=i.getLinkProperties(r.node());var u=s.getStyle("margin");var a=s.getStyle("font-size");var f=s.getStyle("color");var l=s.getStyle("link-color");var c=s.getStyle("link-size");var h=s.getStyle("font-weight");var p=s.getStyle("font-style");var d=s.getStyle("oriented");var v=s.getStyle("align");var m=s.getStyle("highlighted",false);var y=s.getStyle("stroke-dasharray","none");var b=false;if(!o.nodeStart){o.nodeStart=o.nodeEnd;b=true}var E=w(o.nodeEnd)-w(o.nodeStart)>0?1:-1;var S=o.strate>0?1:-1;var x=J(d3.select(o.nodeStart)).translate;var T=J(d3.select(o.nodeEnd)).translate;var N=o.nodeStart.getBBox();var C=o.nodeEnd.getBBox();var k=N.width/2;var L=C.width/2;var A=3;var O=E>0?5*o.offsetXmin+A:-5*o.offsetXmax-A;var M=E>0?-5*o.offsetXmax-A:5*o.offsetXmin+A;var _=5;var D=x[0]+k+O;var P=T[0]+L+M;var H=P-D-E*2*_;if(i.wordY==null){var B=i.vis.selectAll("g.word");i.wordY=0;i.wordHeight=0;for(var n=0;n<B[0].length;++n){var j=B[0][n].getBBox();if(i.wordY>j.y){i.wordY=j.y}if(i.wordHeight<j.height){i.wordHeight=j.height}}}var F=o.nodeStart.className.animVal=="chunk"?N.height:N.height+i.wordY;var I=o.nodeEnd.className.animVal=="chunk"?C.height:C.height+i.wordY;var q=o.nodeStart.className.animVal=="chunk"?0:i.wordY;var R=o.nodeEnd.className.animVal=="chunk"?0:i.wordY;var U=S>0?q:F;var z=S>0?R:I;var W=x[1]+U;var X=T[1]+z;var V=15;var $=30;var K=-S*V-$*o.strate;if(b){K=-S*V-$*S*i.maxLinksStrate}var Y=-(K+W-X);var Z=(1+E*S)/2;var et=(1+E*S)/2;var tt="transparent";if(m){tt=g(l)}var nt=s.components!=null?s.components.highlightPath:r.append("path");var rt=s.components!=null?s.components.path:r.append("path");if(b){nt.attr("d","M "+D+","+(W+K)+" v "+ -K);rt.attr("d","M "+D+","+(W+K)+" v "+ -K)}else{nt.attr("d","M "+D+","+W+" v "+K+" a 5 5 0 0 "+Z+" "+E*_+" "+ -S*_+" h "+H+" a 5 5 0 0 "+et+" "+E*_+" "+S*_+" v "+Y);rt.attr("d","M "+D+","+W+" v "+K+" a 5 5 0 0 "+Z+" "+E*_+" "+ -S*_+" h "+H+" a 5 5 0 0 "+et+" "+E*_+" "+S*_+" v "+Y)}nt.attr("stroke",tt).attr("stroke-width",Q(c)+3).attr("fill","none");rt.attr("stroke",l).attr("stroke-dasharray",y).attr("stroke-width",c).attr("fill","none");if(d){rt.attr("marker-end","url(#"+i.viewer.appendOwnID("arrow")+")")}var it=s.components!=null?s.components.label:r.append("text");it.text(t.label).style("fill",f).style("font-weight",h).style("font-style",p).style("font-size",a);var st=it.node().getBBox();it.attr("x",-st.width/2+D+H/2+E*_).attr("y",Q(G(-Q(u.top),W,K,-S*_)));s.components={highlightPath:nt,path:rt,label:it}}function p(e,t,n){if(e.selected||!n&&e.getStyle("highlighted",false)){return}if(n){f(e,"highlighted",t)}var r=e.getStyle("link-color");var i=e.getStyle("font-weight");if(t!==false){e.components.highlightPath.attr("stroke",g(r));e.components.label.style("font-weight","bold")}else{e.components.highlightPath.attr("stroke","transparent");e.components.label.style("font-weight",i)}}function d(e,t,n){if(e.selected||!n&&e.getStyle("highlighted",false)){return}if(n){f(e,"highlighted",t)}e.components.rect.style("fill",t?"yellow":"none")}function v(e,t,n){if(e.classList!=null&&e.classList.length>0){var r=e.classList[0];if(r=="link"){p(e,t,n)}else if(r="word"){d(e,t,n)}}}function m(e){return e.getStyle("highlighted",false)}function g(e){if(e=="#000000"||e.slice(0,1)!="#")return"yellow";var t=-.3;var n=Z(e);var r=et(n.r,n.g,n.b);r.l+=t;r.l=r.l<0?0:r.l>1?1:r.l;n=tt(r.h,r.s,r.l);return Y(n.r,n.g,n.b)}function y(e,t){return w(e)*2<t.min*2||w(e)*2>t.max*2}function b(e,t){return w(e)*2>t.min*2&&w(e)*2<t.max*2}function w(t){if(t){if(t.__data__["#position"]!=null)return t.__data__["#position"];else{var n=e.DepGraph.getInstance(t);var r=Math.floor(t.__data__["elements"].length/2);var i=n.getWordNodeByOriginalId(t.__data__["elements"][r]);return i.__data__["#position"]}}else{return-1}}function E(e,t,n){var r=t.split("/");var i=e;for(var s=0;s<r.length-1;s++){var o=i[r[s]];if(typeof o=="object"){if(o==null){i[r[s]]=new Object}i=null;i=o}else{}}var u=X(i[r[r.length-1]]);i[r[r.length-1]]=n;return u}function S(e,t){if(e.editObject.highlightMode){var n=!m(this);v(this,n,true)}e.editObject.selectObject(this)}function x(e,t){if(t.baseAction=="linkRemoval"){var n=t.link;var r=e.getWordNodeByOriginalId(n.__data__["source"]);var i=e.getWordNodeByOriginalId(n.__data__["target"]);q(e,r,i,n.__data__.label,n.color,n.__data__["#id"])}else if(t.baseAction=="linkAddition"){R(e,t.addedLink["#id"])}else if(t.baseAction=="wordAddition"){I(e,t.addedWord["#id"])}else if(t.baseAction=="wordRemoval"){var s=t.word;j(e,s);if(t.affectedLinks!=null){for(var o=0;o<t.affectedLinks.length;o++){var n=t.affectedLinks[o];var r=e.getWordNodeByOriginalId(n["source"]);var i=e.getWordNodeByOriginalId(n["target"]);n.color=n["#style"]["link-color"]?n["#style"]["link-color"]:e.data.graph["#link-style"]["link-color"];q(e,r,i,n.label,n.color,n["#id"])}}}else if(t.baseAction=="changeAttr"){var u=t.obj["#id"];var a=e.getObjectById(u);e.editObject.changeAttributes(a,t.oldAttrs);e.update();e.postProcesses()}}function T(e,t){}function N(e,t){if(t.keyCode==46){if(e.editObject.previousSelectedObject!=null){if(U(e.editObject.previousSelectedObject)){var n=X(e.editObject.previousSelectedObject);n.color=a(e.editObject.previousSelectedObject,"link-color","black");var r=R(e,e.editObject.previousSelectedObject.__data__["#id"]);e.editObject.previousSelectedObject=null;if(r){return{baseAction:"linkRemoval",link:n}}}else if(z(e.editObject.previousSelectedObject)){var i=X(e.editObject.previousSelectedObject.__data__);var s=I(e,e.editObject.previousSelectedObject.__data__["#id"]);e.editObject.previousSelectedObject=null;return{baseAction:"wordRemoval",word:i,affectedLinks:s}}}}}function C(e,t){var n=e.viewer.screenCoordsForElt(t[0]);var r={x:(n.ne.x+n.nw.x)/2,y:n.nw.y};var i=M(e,t[0]);e.viewer.loadTooltipContent(i);e.viewer.tooltipExitButton.show();e.viewer.showTooltip(r)}function k(e,t,n){var r=n["#style"]!=null&&n["#style"]["link-color"]!=null?n["#style"]["link-color"]:e.data.graph["#link-style"]["link-color"];t+='<tr><td>label</td><td><input type="text" name="label" value="'+n.label+'"></td></tr>';t+="<tr><td>source</td><td>"+O(e,n.source)+"</td></tr>";t+="<tr><td>target</td><td>"+O(e,n.target)+"</td></tr>";t+="<tr><td>color</td><td>"+A("colorPicker",r)+"</td></tr>";return t}function L(e,t,n){t+='<tr><td>label</td><td><input type="text" name="label" value="'+n.label+'"></td></tr>';for(var r=0;r<n.sublabel.length;r++){t+="<tr><td>sublabel"+r+'</td><td><input type="text" name="sublabel'+r+'" value="'+n.sublabel[r]+'"></td></tr>'}return t}function A(e,t){var n='<table><tr><td><input type="text" name="'+e+'" value="'+t+'" onkeydown="jQuery(jQuery(jQuery(this).parent().parent().children()[1]).children()[0]).css(\'background-color\',this.value+String.fromCharCode(event.keyCode));"></td><td><div style="display:inline-block; width:30px; height:30px; background-color:'+t+';"></div></td></tr></table>';return n}function O(e,t){var n="<select>";for(var r in e.data.graph.words){var i=e.data.graph.words[r];n+='<option value="'+i.id+'" ';n+=i.id==t?'selected="true"':"";n+=">#"+i["#position"]+" "+i["label"]+" ("+i.id+")";n+="</option>"}n+="</select>";return n}function M(e,t){var n=t.__data__;var r="";if(t.classList!=null&&t.classList.length>0){r=t.classList[0]}var i="<div>"+'<h3 id="edit-info-title">Edit '+r+" (original id: "+n.id+")</h3>"+'<table class="main-properties-table" ref="'+n["#id"]+'">';if(r=="word"){i=L(e,i,n)}else if(r=="link"){i=k(e,i,n)}else{}i+="</table>";i+='<input id="'+e.viewer.appendOwnID(r+"-save-properties")+'" type="button" value="Save" onclick="saveProperties.call(this,arguments);">';i+="</div>";var s=jQuery(i);return s}function _(){var t=this.id.substring(0,this.id.indexOf("-"));var n=e.DepGraph.getInstance(this);var r=n.viewer;var i=jQuery(this).parent().find("table.main-properties-table");if(t=="link"){D(n,i)}else if(t=="word"){P(n,i)}else{}n.update();n.postProcesses();r.hideToolTip()}function D(e,t){var n=e.getLinkById(t.attr("ref"));var r=t[0].rows;var i=[];for(var s=0;s<r.length;s++){var o=r[s];var u=o.cells;var a=u[0].innerHTML;var f=u[1];if(a=="label"){i.push({path:"label",value:f.firstChild.value})}else if(a=="color"){i.push({path:"#style/link-color",value:f.firstChild.rows[0].cells[0].firstChild.value})}else if(a=="source"){i.push({path:"source",value:f.childNodes[0].options[f.childNodes[0].options.selectedIndex].value})}else if(a=="target"){i.push({path:"target",value:f.childNodes[0].options[f.childNodes[0].options.selectedIndex].value})}else{}}e.editObject.changeAttributes(n,i,true)}function P(e,t){var n=e.getWordNodeById(t.attr("ref")).__data__;var r=t[0].rows;var i=[];for(var s=0;s<r.length;s++){var o=r[s];var u=o.cells;var a=u[0].innerHTML;var f=u[1];if(a=="label"){i.push({path:"label",value:f.firstChild.value})}else if(a.substring(0,8)=="sublabel"){i.push({path:"sublabel/"+a.substring(8),value:f.firstChild.value})}else{}}e.editObject.changeAttributes(n,i,true)}function H(e,t){if(e.editObject.previousSelectedObject==null||U(e.editObject.previousSelectedObject)){S.call(this,e,t)}else{if(this.__data__["#id"]==e.editObject.previousSelectedObject.__data__["#id"]){e.editObject.clearSelection();return}B(e,e.editObject.previousSelectedObject,this,t)}}function B(e,t,n,r){var i=e.viewer.screenCoordsForElt(n);var s={x:(i.ne.x+i.nw.x)/2,y:i.nw.y};var o='<div><table style="margin:5px 0px 0px 0px;">'+"<tr><td>Link name : </td>"+'<td><input type="text" name="link-name" value=""></td></tr>'+"<tr><td>Link color : </td>"+'<td><input type="text" name="link-color" value="black"></td></tr>'+'<tr><td colspant="2"><input id="link-settings'+e.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Create Link"></td></tr>'+"</table></div>";o=jQuery(o);e.viewer.loadTooltipContent(o);e.editObject.clearSelection();jQuery("#link-settings"+e.viewer.appendOwnID("")).click(function(){var i=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value;var s=this.parentNode.parentNode.parentNode.childNodes[1].childNodes[1].childNodes[0].value;var o=q(e,t,n,i,s);var u={baseAction:"linkAddition",addedLink:o};e.editObject.pushAction({mode:e.editObject.editMode,rollbackdata:u,data:{event:"onWordSelect",params:r}});e.viewer.hideToolTip()});e.viewer.tooltipExitButton.show();e.viewer.showTooltip(s)}function j(e,t){var n=t["#position"];e.insertWord(t,n);e.editObject.init();e.autoHighLightOnMouseOver();return X(t)}function F(e,t,n){var r=e.viewer.screenCoordsForElt(t);var i={x:(r.ne.x+r.nw.x)/2,y:r.nw.y};var s='<div><table style="margin:5px 0px 0px 0px;">'+"<tr><td>Word label : </td>"+'<td><input type="text" name="word-label" value=""></td></tr>'+'<tr><td colspant="2"><input id="word-settings'+e.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Insert Word"></td></tr>'+"</table></div>";s=jQuery(s);e.viewer.loadTooltipContent(s);e.editObject.clearSelection();jQuery("#word-settings"+e.viewer.appendOwnID("")).click(function(){var r=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value;if(r==null||r==""){alert("you must fill all required fields");return}var i={label:r,"#position":t.__data__["#position"]+n};var s=j(e,i);var o={baseAction:"wordAddition",addedWord:s};e.editObject.pushAction({mode:e.editObject.editMode,rollbackdata:o,data:{event:"onWordContext",params:t}});e.viewer.hideToolTip()});e.viewer.tooltipExitButton.show();e.viewer.showTooltip(i)}function I(e,t){var n=e.removeWord(t);return n}function q(e,t,n,r,i,s){if(i==null){i="black"}if(s==null){s=e.id++}t=t.__data__;n=n.__data__;var o=new Object;o.source=t.id;o.target=n.id;o["#style"]={"link-color":i};o.label=r;o["#id"]=s;e.addLink(o);e.editObject.init();e.autoHighLightOnMouseOver();return o}function R(e,t){var n=e.removeLink(t);return n}function U(e){return e.__data__.target!=null&&e.__data__.source!=null}function z(e){return e.__data__["#position"]!=null}function W(e){return e.elements!=null}function X(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date){var t=new Date;t.setTime(e.getTime());return t}if(e instanceof Array){var t=[];for(var n=0,r=e.length;n<r;n++){t[n]=X(e[n])}return t}if(e instanceof Object){var t={};for(var i in e){if(e.hasOwnProperty(i))t[i]=X(e[i])}return t}throw new Error("Unable to copy obj! Its type isn't supported.")}function V(e,t,n){e.attr("transform","translate("+t+","+n+")")}function $(e,t){var n=t.node().getBBox();var r=e.node().getBBox();e.attr("x",-r.width/2+n.width/2)}function J(e){var t=e.attr("transform");var n=/(\w+)\((.*?)\)/g;var r=new Object;var i;while((i=n.exec(t))!=null){var s=/(-*\w+\.*\w*)/g;r[i[1]]=[];var o;while((o=s.exec(i[2]))!=null){r[i[1]].push(parseFloat(o[1]))}}return r}function K(e,t){function i(e,t,n,r){for(var s in e){if(!e.hasOwnProperty(s)){continue}if(s=="id"){n[e[s]]=e;continue}var o=typeof e[s];if(o=="object"){i(e[s],t,n,r)}else if(o=="string"){if(e[s].indexOf(t)==0){var u=e[s].substring(1);if(n[u]!=null){e[s]=n[u];i(e[s],t,n,r)}else{r.push[e[s]]}}}}}var n=[];var r=[];i(e,t,n,r);for(elt in r){if(n[elt]==null){throw"This object has missing references!"}else{elt=n[elt]}}}function Q(e){var t=/(-*)(\d+\.*\d*)px/;var n=t.exec(e);if(n!=null){var r=n[1].length%2==0?"":"-";e=r+n[2]}return parseFloat(e)}function G(){var e=0;for(var t=0;t<arguments.length;t++){var n=Q(arguments[t]);e+=parseInt(n)}return e+"px"}function Y(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)}function Z(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function et(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n);var s,o,u=(r+i)/2;if(r==i){s=o=0}else{var a=r-i;o=u>.5?a/(2-r-i):a/(r+i);switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4;break}s/=6}return{h:s,s:o,l:u}}function tt(e,t,n){var r,i,s;if(t==0){r=i=s=n}else{function o(e,t,n){if(n<0)n+=1;if(n>1)n-=1;if(n<1/6)return e+(t-e)*6*n;if(n<1/2)return t;if(n<2/3)return e+(t-e)*(2/3-n)*6;return e}var u=n<.5?n*(1+t):n+t-n*t;var a=2*n-u;r=o(a,u,e+1/3);i=o(a,u,e);s=o(a,u,e-1/3)}return{r:Math.floor(r*255),g:Math.floor(i*255),b:Math.floor(s*255)}}if(typeof jQuery=="undefined"){alert("DepGraph : Error. This library needs jQuery!")}e.GraphViewer=function(t,n){if(n==null){n=Math.floor(Math.random()*1e16).toString()}this.allowFullScreen=true;this.imagemode=false;this.debugPanelActive=false;this.fixedToolbar=false;this._height="600px";this._width="100%";this.basemargin=10;this.margin={top:100,left:0,right:0,bottom:10};if(e.GraphViewer.instances[n]){n+="_"}var n=this.uid=n;if(typeof t=="string"){t=jQuery(t)}var t=this.container=t;t.css("display","inline-block");var r=this.mainpanel=this.createDiv("gv-main-panel","gv-main-panel");t.append(r);var i=this.chart=this.createDiv("gv-chart","gv-chart");r.append(i);var s=this.toolbar=this.initToolBar();var o=this.debugpanel=this.createDebugPanel();this.tooltip=this.createToolTipPanel();this.tooltip.hide();this.altpanel=this.createDiv("gv-alt-panel","gv-alt-panel");this.altpanelcontent=this.createDiv("alt-panel-content","alt-panel-content");this.ajaxLoader=this.createDiv("ajax-loader","ajax-loader");this.ajaxLoader.hide();this.mainpanel.append(this.ajaxLoader);this.extraDiv=this.createDiv("gv-extra","gv-extra");this.extraDiv.hide();this.mainpanel.append(this.extraDiv);r.append(this.tooltip);r.append(this.altpanel);this.altpanel.append(this.altpanelcontent);e.GraphViewer.instances[n]=this;this.callbacks=new Object;this.callbacks.fullscreen=new Object;this.callbacks.fullscreen.oncomplete=[];this.callbacks.fullscreen.onclose=[];this.callbacks.showaltpanel=[];this.callbacks.hidealtpanel=[];this.toolbar.hide();this.toolbar_landing_area.hover(function(){var t=e.GraphViewer.getInstance(this);if(!t.fixedToolbar){t.toolbar.slideDown(100)}},function(){var t=e.GraphViewer.getInstance(this);if(!t.fixedToolbar){t.toolbar.slideUp(100)}})};e.GraphViewer.instances=[];e.GraphViewer.getInstance=function(t){var n="";if(e.GraphViewer.prototype.isPrototypeOf(t)){return t}else if(t.ownerSVGElement!=null){n=t.ownerSVGElement.parentNode.id}else if(typeof t=="object"&&t.id!=null){n=t.id}else{n=t}regex=/.*-(\w+)/;var r=regex.exec(n);var i=null;if(r!=null){i=e.GraphViewer.instances[r[1]]}if(i==null){i=e.GraphViewer.getInstance(t.parentNode)}return i};e.GraphViewer.prototype.initToolBar=function(){var e=this.toolbar_landing_area=this.createDiv("gv-toolbar-landing-area","gv-toolbar-landing-area");var t=this.createDiv("gv-toolbar","gv-toolbar");e.append(t);this.mainpanel.append(this.toolbar_landing_area);this.addFullScreenButton();return t};e.GraphViewer.prototype.createDebugPanel=function(){var t=this.debugpanel=this.createDiv("gv-debug-panel","gv-debug-panel");this.debugpanelinfo=this.createDiv("debug-panel-info","debug-panel-info");t.append(this.debugpanelinfo);var n=this.createDiv("debug-panel-slider","debug-panel-slider slider-button slide-up");n.click(o);t.append(n);var r=this.createDiv("debug-panel-fullscreen","debug-panel-fullscreen slider-button maximize");r.click(function(t){var n=e.GraphViewer.getInstance(this);if(n!=null){n.viewAltContent("debug-panel-content"+n.appendOwnID(""));var r=jQuery("#debug-panel-slider"+n.appendOwnID(""));if(r.hasClass("slide-down")){s.call(r)}}});t.append(r);var i=this.debugcontentcontainer=this.createDiv("debug-panel-container","debug-panel-container");t.append(i);this.debugpanelcontent=this.createDiv("debug-panel-content","debug-panel-content");i.append(this.debugpanelcontent);this.mainpanel.append(t);this.adjustDebugHeight();t.hide();return t};e.GraphViewer.prototype.debugLog=function(e){this.debugpanelcontent.append(e+"<br/>")};e.GraphViewer.prototype.createToolTipPanel=function(){var e=this;this.tooltip=this.createDiv("gv-tooltip","gv-tooltip");var t=jQuery('<div style="display:inline-block;"></div>');this.tooltip.append(t);this.tooltipExitButton=this.createDiv("tooltip-exit-button","tooltip-exit-button");this.tooltipExitButton.css("float","right");this.tooltipExitButton.css("display","block");this.tooltipExitButton.click(function(){e.hideToolTip()});t.append(this.tooltipExitButton);this.tooltipExitButton.hide();this.tooltip.draggable();this.tooltipContainer=this.createDiv("tooltip-container");t.append(this.tooltipContainer);return this.tooltip};e.GraphViewer.prototype.appendOwnID=function(e){if(e.endsWith(this.uid)){return e}else{return e+"-"+this.uid}};e.GraphViewer.prototype.addWrapper=function(e){var t=this;var n=this.wrapper=t.createElement("a","gv-wrapper","gv-wrapper");n.html(e);t.container.prepend(n);t.mainpanel.hide();n.click(function(e){t.mainpanel.toggle()});return n};e.GraphViewer.prototype.createDiv=function(e,t){return this.createElement("div",e,t)};e.GraphViewer.prototype.createElement=function(e,t,n){n=n!=null?'class="'+n+'"':"";var r="<"+e+' id="'+this.appendOwnID(t)+'" '+n+"></"+e+">";return jQuery(r)};e.GraphViewer.prototype.adjustDebugHeight=function(){var e=this.mainpanel.height()-this.toolbar.height();this.debugpanel.css("height",e);this.debugcontentcontainer.css("height",e-20);this.debugpanel.css("bottom",-e+20)};e.GraphViewer.prototype.shrinkHeightToContent=function(e){if(e==null){e=0}var t=d3.select(this.chart.children()[0]).select("g");var n=t.node().getBBox();var r=J(t);this.setHeight(r.translate[1]+n.y*r.scale[0]+n.height*r.scale[0]+e*r.scale[0])};e.GraphViewer.prototype.shrinkWidthToContent=function(e){if(e==null){e=0}var t=d3.select(this.chart.children()[0]).select("g");var n=t.node().getBBox();var r=J(t);this.setWidth(r.translate[0]+n.x+n.width+marginLeft)};e.GraphViewer.prototype.shrinkToContent=function(e,t){if(t==null){t=0}if(e==null){e=0}var n=d3.select(this.chart.children()[0]).select("g");var r=n.node().getBBox();var i=J(n);var s=this.mainpanel.width();var o=i.translate[0]+r.x+r.width+e;this.setSize(o,i.translate[1]+r.y+r.height+t)};e.GraphViewer.prototype.setSize=function(e,t){this.setWidth(e);this.setHeight(t)};e.GraphViewer.prototype.setImageMode=function(e){if(e==null){e=true}this.imagemode=e;if(e){this.toolbar.detach();this.debugpanel.detach();this.tooltip.detach()}else{mainpanel.append(this.toolbar);mainpanel.append(this.debugpanel);mainpanel.append(this.tooltip)}this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20);this.margin.bottom=this.basemargin+(this.imagemode?0:20)};e.GraphViewer.prototype.noBorders=function(){if(this.imagemode){this.mainpanel.css("border","none")}};e.GraphViewer.prototype.debugMode=function(e){if(e==null){e=true}this.debugPanelActive=e;if(e){this.debugpanel.show()}else{this.debugpanel.hide()}};e.GraphViewer.prototype.setWidth=function(e){this._width=e;this.mainpanel.css("width",e);this.ajaxLoader.width(e)};e.GraphViewer.prototype.setHeight=function(e){this._height=e;this.mainpanel.css("height",e);this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20);this.margin.bottom=this.basemargin+this.imagemode?0:20;this.ajaxLoader.height(e-this.toolbar.height());this.ajaxLoader.css("top",this.toolbar.height());if(this.debugPanelActive){this.adjustDebugHeight()}};e.GraphViewer.prototype.setFixedToolbar=function(e){if(e==null){e=true}this.fixedToolbar=e;if(e){this.toolbar.show()}else{this.toolbar.hide()}};e.GraphViewer.prototype.addFullScreenButton=function(){if(!this.allowFullScreen){return}if(typeof this.container.colorbox!="undefined"){this.addToolbarButton("fullscreen",null,"right","fullscreen","View in fullscreen");this.initFullscreenMode()}};e.GraphViewer.prototype.existToolbarButton=function(e){return jQuery("#button-"+this.appendOwnID(e)).length>0};e.GraphViewer.prototype.getToolbarButton=function(e){return jQuery("#button-"+this.appendOwnID(e))};e.GraphViewer.prototype.setToolbarButtons=function(e){this.tmpLeft=[];e.forEach(function(e,t){if(e[2]=="left"){this.tmpLeft.push(e)}else{this.addToolbarButton(e[0],e[1],e[2],e[3],e[4])}},this);this.tmpLeft.forEach(function(e,t){this.addToolbarButton(e[0],e[1],e[2],e[3],e[4])},this);this.tmpLeft=null};e.GraphViewer.prototype.resetToolbarButtons=function(){var e=jQuery("#"+this.appendOwnID("gv-toolbar")).children();e.remove();this.addFullScreenButton()};e.GraphViewer.prototype.addToolbarElement=function(e,t){e.css("float",t);jQuery("#"+this.appendOwnID("gv-toolbar")).append(e)};e.GraphViewer.prototype.addToolbarButton=function(e,t,n,r,i){var s="";if(r==null){r="button white";s=e}else{r+=" icon"}if(n==null){n="left"}var o='<div id="button-'+this.appendOwnID(e)+'" title="'+(i||e)+'" class="'+r+" tab "+n+'">'+s+"</div>";o=jQuery(o);o.click(t);jQuery("#"+this.appendOwnID("gv-toolbar")).append(o)};e.GraphViewer.prototype.removeToolbarButton=function(e){jQuery("#button-"+this.appendOwnID(e)).remove()};e.createDropDownMenu=function(e,t,n,r){var s=jQuery('<div class="gv-menu"><div class="gv-menu-header"></div><div class="gv-menu-body"></div></div>');var o=jQuery(".gv-menu-header",s);var u=jQuery(".gv-menu-body",s);u.hide();o.html(e);o.attr("title",r||e);for(i in t){var a=jQuery("<div>"+i+"</div>");a.attr("title",t[i].tt||i);u.append(a);jQuery(a).click(t[i].cb)}if(n===false){jQuery(".gv-menu-header",s).click(function(e){jQuery(".gv-menu-body",e.currentTarget.parentNode).slideDown()});jQuery(s).mouseleave(function(e){jQuery(".gv-menu-body",e.currentTarget).slideUp()})}else{s.hover(function(e){jQuery(".gv-menu-body",e.currentTarget).slideDown()},function(e){jQuery(".gv-menu-body",e.currentTarget).slideUp()})}return s};e.GraphViewer.prototype.viewAltContent=function(e){this.resetAltPanel();this.addContentToAltPanel(e);this.showAltPanel()};e.GraphViewer.prototype.hideAltPanel=function(){this.chart.show();this.altpanel.hide();this.removeToolbarButton("back");u(this.callbacks.hidealtpanel)};e.GraphViewer.prototype.showAltPanel=function(t){this.chart.hide();this.altpanel.show();this.addToolbarButton("back",function(){e.GraphViewer.getInstance(this.id).hideAltPanel()},"left","back");u(this.callbacks.showaltpanel)};e.GraphViewer.prototype.addContentToAltPanel=function(t,n){this.altpanelcontent.html(jQuery("#"+this.appendOwnID(t)).html());if(n!=null){this.addToolbarButton(n,function(){e.GraphViewer.getInstance(this.id).addContentOnAltPanel(t)},"left")}};e.GraphViewer.prototype.resetAltPanel=function(){this.altpanelcontent.html("")};e.GraphViewer.prototype.loadTooltipContent=function(t){var n;var r=e.GraphViewer.getInstance(this);if(typeof t=="string"){n=jQuery("#"+r.appendOwnID(t))}else{n=t}r.tooltipContainer.html(n.html());r.tooltip.draggable()};e.GraphViewer.prototype.lockTooltip=function(){var t=e.GraphViewer.getInstance(this);t.tooltip.draggable("destroy")};e.GraphViewer.prototype.showTooltip=function(t,n){var r=e.GraphViewer.getInstance(this);r.tooltip.css("left",t.x);r.tooltip.css("top",t.y);r.tooltip.show();if(!n){d3.select(document).on("click.tooltip_"+r.uid,function(e){if(!jQuery.contains(r.tooltip[0],d3.event.originalTarget)){alert("auto closing due to event")}})}};e.GraphViewer.prototype.hideToolTip=function(){var t=e.GraphViewer.getInstance(this);t.tooltip.hide()};e.GraphViewer.prototype.ajaxStart=function(){this.ajaxLoader.show()};e.GraphViewer.prototype.ajaxFinished=function(){this.ajaxLoader.hide()};e.GraphViewer.prototype.initFullscreenMode=function(){var e=this;var t=jQuery("#button-fullscreen"+this.appendOwnID(""));t.colorbox({inline:true,href:"#"+"gv-main-panel"+e.appendOwnID(""),width:"95%",height:"95%",onLoad:function(){e.removeToolbarButton("fullscreen");e.mainpanel.width("99%");e.mainpanel.height("99%");e.adjustDebugHeight()},onComplete:function(){u(e.callbacks.fullscreen.oncomplete)},onClosed:function(){e.mainpanel.width(e._width);e.mainpanel.height(e._height);e.addToolbarButton("fullscreen",null,"right","fullscreen");e.adjustDebugHeight();e.initFullscreenMode();u(e.callbacks.fullscreen.onclose)}})};String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1};e.GraphViewer.prototype.screenCoordsForElt=function(e){while(Object.prototype.toString.call(e)==="[object Array]"){e=e[0]}var t=e.getBBox();var n=this.chart[0].querySelector("svg");var r=n.createSVGPoint();var i={};var s=e.getScreenCTM();r.x=t.x;r.y=t.y;i.nw=r.matrixTransform(s);r.x+=t.width;i.ne=r.matrixTransform(s);r.y+=t.height;i.se=r.matrixTransform(s);r.x-=t.width;i.sw=r.matrixTransform(s);return i};e.DepGraph=function(t,n,r){this.options=r||{};this.viewer=new e.GraphViewer(t,this.options.uid);e.DepGraph.instances[this.viewer.uid]=this;this.callbacks=new Object;this.setData(n);this.original_data=X(this.data);this.createLayout();this.update();this.postProcesses();this.autoHighLightOnMouseOver();this.viewerSettings();this.editObject=new e.EditObject(this)};e.DepGraph.prototype.viewerSettings=function(){this.viewer.callbacks.fullscreen.oncomplete.push({method:this.centerGraph,caller:this});this.viewer.callbacks.fullscreen.onclose.push({method:this.centerGraph,caller:this})};e.DepGraph.prototype.centerGraph=function(){var e=this.viewer.chart;var t=e[0].getBoundingClientRect();var n=this.vis.node().getBBox();var r=J(this.vis);var i=(t.width-n.width)/2;var s=(t.height-n.height)/2;s=s>0?s:Q(this.data.graph["#style"].margin.top);i=i>0?i:Q(this.data.graph["#style"].margin.left);this.vis.attr("transform","translate("+(i-n.x)+","+(s-n.y)+") scale("+r.scale[0]+")")};e.DepGraph.prototype.autoHighLightOnMouseOver=function(e){if(e==null||e){this.vis.selectAll("g.link").on("mouseover.autohighlight",function(){p(this,true)});this.vis.selectAll("g.link").on("mouseout.autohighlight",function(){p(this,false)});this.vis.selectAll("g.word").on("mouseover.autohighlight",function(){d(this,true)});this.vis.selectAll("g.word").on("mouseout.autohighlight",function(){d(this,false)})}else{this.vis.selectAll("g.link").on("mouseover.autohighlight",null);this.vis.selectAll("g.link").on("mouseout.autohighlight",null);this.vis.selectAll("g.word").on("mouseover.autohighlight",null);this.vis.selectAll("g.word").on("mouseout.autohighlight",null)}};e.DepGraph.instances=[];e.DepGraph.getInstance=function(t){if(t){if(e.DepGraph.prototype.isPrototypeOf(t)){return t}else if(t.ownerSVGElement!=null){t=t.ownerSVGElement.parentNode.id}else if(t.nodeName&&t.nodeName=="svg"){t=t.parentNode.id}else if(typeof t=="object"&&t.id!=null){t=t.id}regex=/.*-(\w+)/;var n=regex.exec(t);if(n!=null){return e.DepGraph.instances[n[1]]}return null}};e.DepGraph.prototype.setData=function(e){this.data=e;this.prepareData()};e.DepGraph.prototype.resetData=function(e){this.setData(e);this.createLayout();this.update();this.postProcesses();this.autoHighLightOnMouseOver();this.editObject.init()};e.DepGraph.prototype.cleanData=function(){var e=this.vis.selectAll("g.link");this.resetLinksProperties(e)};e.DepGraph.prototype.prepareData=function(){K(this.data,"@");this.id=0;for(var e=0;this.data.graph.words&&e<this.data.graph.words.length;e++){var t=this.data.graph.words[e];t["#id"]=this.id++;t["#position"]=e}for(var e=0;this.data.graph.links&&e<this.data.graph.links.length;e++){this.data.graph.links[e]["#id"]=this.id++;this.data.graph.links[e]["#properties"]=null}for(var e=0;this.data.graph.chunks&&e<this.data.graph.chunks.length;e++){this.data.graph.chunks[e]["#id"]=this.id++}var n=this.data.graph["#style"]?this.data.graph["#style"]:this.data.graph["#style"]=new Object;var r=this.data.graph["#word-style"]?this.data.graph["#word-style"]:this.data.graph["#word-style"]=new Object;var i=this.data.graph["#link-style"]?this.data.graph["#link-style"]:this.data.graph["#link-style"]=new Object;var s=this.data.graph["#chunk-style"]?this.data.graph["#chunk-style"]:this.data.graph["#chunk-style"]=new Object;n["margin"]=n["margin"]?n["margin"]:{top:"50px",right:"20px",bottom:"20px",left:"20px"};n["margin"].top=n["margin-top"]?n["margin-top"]:n["margin"].top;n["margin"].right=n["margin-right"]?n["margin-right"]:n["margin"].right;n["margin"].left=n["margin-left"]?n["margin-left"]:n["margin"].left;n["margin"].bottom=n["margin-bottom"]?n["margin-bottom"]:n["margin"].bottom;n["background-color"]=n["background-color"]?n["background-color"]:"white";n["font-family"]=n["font-family"]?n["font-family"]:"inherit";r["margin"]=r["margin"]?r["margin"]:{top:"10px",right:"15px",bottom:"10px",left:"15px"};r["sub-margin"]=r["sub-margin"]?r["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"};r["font-size"]=r["font-size"]?r["font-size"]:"14px";r["sub-font-size"]=r["sub-font-size"]?r["sub-font-size"]:"10px";r["color"]=r["color"]?r["color"]:"black";r["sub-color"]=r["sub-color"]?r["sub-color"]:"black";r["font-weight"]=r["font-weight"]?r["font-weight"]:"normal";r["sub-font-weight"]=r["sub-font-weight"]?r["sub-font-weight"]:"normal";r["font-style"]=r["font-style"]?r["font-style"]:"normal";r["sub-font-style"]=r["sub-font-style"]?r["sub-font-style"]:"normal";i["margin"]=i["margin"]?i["margin"]:{top:"5px",right:"10px",bottom:"10px",left:"10px"};i["font-size"]=i["font-size"]?i["font-size"]:"12px";i["color"]=i["color"]?i["color"]:"black";i["link-color"]=i["link-color"]?i["link-color"]:"#000000";i["link-size"]=i["link-size"]?i["link-size"]:"2px";i["font-weight"]=i["font-weight"]?i["font-weight"]:"normal";i["font-style"]=i["font-style"]?i["font-style"]:"normal";i["oriented"]=i["oriented"]?i["oriented"]:true;i["align"]=i["align"]?i["align"]:"center";i["higlighted"]=false;s["margin"]=s["margin"]?s["margin"]:{top:"10px",right:"10px",bottom:"10px",left:"10px"};s["sub-margin"]=s["sub-margin"]?s["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"};s["font-size"]=s["font-size"]?s["font-size"]:"12px";s["sub-font-size"]=s["sub-font-size"]?s["sub-font-size"]:"10px";s["background-color"]=s["background-color"]?s["background-color"]:"transparent";s["color"]=s["color"]?s["color"]:"black";s["sub-color"]=s["sub-color"]?s["sub-color"]:"black";s["border-color"]=s["border-color"]?s["border-color"]:"black";s["font-weight"]=s["font-weight"]?s["font-weight"]:"normal";s["sub-font-weight"]=s["sub-font-weight"]?s["sub-font-weight"]:"normal";s["font-style"]=s["font-style"]?s["font-style"]:"normal";s["sub-font-style"]=s["sub-font-style"]?s["sub-font-style"]:"normal";s["border-size"]=s["border-size"]?s["border-size"]:"1px"};e.DepGraph.prototype.postProcesses=function(){var e=this.vis.node().getBBox();this.vis.attr("transform","translate("+(Q(this.data.graph["#style"].margin.left)-e.x)+","+(Q(this.data.graph["#style"].margin.top)-e.y)+") scale(1)");this.setViewMode()};e.DepGraph.prototype.setViewMode=function(){if(this.options.viewmode&&this.options.viewmode!="full"){this.viewer.shrinkHeightToContent(Q(this.data.graph["#style"]["margin"].bottom)+20);if(!this.options.viewsize){alert("options.viewsize not defined, using 600px as default value");this.options.viewsize="600px"}this.viewer.setWidth(this.options.viewsize);if(this.options.viewmode=="cropped"){this.createScrollBar()}else{var e=this.vis.node().getBBox();var t=this.viewer.chart.width()/(e.width+Q(this.data.graph["#style"]["margin"].right)*2);this.scale(t);this.viewer.shrinkHeightToContent(Q(this.data.graph["#style"]["margin"].bottom)+20)}}else{this.viewer.shrinkToContent(Q(this.data.graph["#style"]["margin"].right),Q(this.data.graph["#style"]["margin"].bottom)+20)}};e.DepGraph.prototype.createScrollBar=function(){var t=this;var n=this.vis.node().getBBox();var r=n.width+2*Q(this.data.graph["#style"]["margin"].right);var i=this.viewer.mainpanel.width();if(r>i){var s=2*i-r;this.scrollbar=this.svg.append("rect").classed("scrollbar",true);this.scrollbar.attr("x",0).attr("y",this.viewer.mainpanel.height()-10).attr("rx",1).attr("ry",1).attr("width",s).attr("height",5).style("stroke","grey").style("fill","lightgrey").style("stroke-width",1).__info__={maxX:i-s};this.scrollMouseSelected=null;this.scrollbar.on("mousedown",function(t){var n=e.DepGraph.getInstance(this);e.depgraphActive="-"+n.viewer.uid;n.scrollMouseSelected=d3.event.clientX;d3.event.preventDefault?d3.event.preventDefault():d3.event.returnValue=false});d3.select(document).on("click.focus",function(t){var n=e.DepGraph.getInstance(d3.event.originalTarget);if(n){e.depgraphActive="-"+n.viewer.uid}else{e.depgraphActive=null}});d3.select(document).on("wheel.scrollbar",function(t){var n=e.DepGraph.getInstance(e.depgraphActive);if(n&&n.scrollbar){n.translateGraph(3*d3.event.deltaY,0);d3.event.preventDefault?d3.event.preventDefault():d3.event.returnValue=false}});d3.select(document).on("mousemove.scrollbar"+t.viewer.uid,function(t){var n=e.DepGraph.getInstance(e.depgraphActive);if(n&&(n.scrollMouseSelected||n.scrollMouseSelected===0)){var r=d3.event.clientX-n.scrollMouseSelected;n.translateGraph(r,0);n.scrollMouseSelected=d3.event.clientX}});d3.select(document).on("mouseup.scrollbar"+t.viewer.uid,function(t){var n=e.DepGraph.getInstance(e.depgraphActive);if(n){n.scrollMouseSelected=null}})}d3.select(document).on("keydown.move"+t.viewer.uid,function(t){var n=10;if(e.depgraphActive){var r=e.DepGraph.getInstance(e.depgraphActive);if(d3.event.keyCode==37){r.translateGraph(-n,0)}else if(d3.event.keyCode==39){r.translateGraph(n,0)}}})};e.DepGraph.prototype.createLayout=function(){if(this.svg!=null){this.svg.remove()}this.svg=d3.select(this.viewer.chart[0]).append("svg").attr("width","100%").attr("height","100%");this.viewer.chart.css("background-color",this.data.graph["#style"]["background-color"]);this.svg.append("rect").attr("width","100%").attr("height","100%").style("fill",this.data.graph["#style"]["background-color"]);this.setSVGDefs();this.vis=this.svg.append("g").attr("transform","translate("+Q(this.data.graph["#style"].margin.left)+","+Q(this.data.graph["#style"].margin.top)+") scale(1)")};e.DepGraph.prototype.scale=function(t){var n=e.DepGraph.getInstance(this);var r=J(n.vis);n.vis.attr("transform","translate("+r.translate[0]*t+","+r.translate[1]*t+")"+" scale("+t+")")};e.DepGraph.prototype.translateGraph=function(t,n){var r=e.DepGraph.getInstance(this);var i=J(r.vis);if(r.scrollbar){var s=parseFloat(r.scrollbar.attr("x"));if(r.scrollbar.__info__.maxX<s+t){t=r.scrollbar.__info__.maxX-s}else if(s+t<0){t=-s}r.scrollbar.attr("x",s+t)}r.vis.attr("transform","translate("+(i.translate[0]-t)+","+(i.translate[1]-n)+")"+" scale("+i.scale[0]+")")};e.DepGraph.prototype.update=function(){var e;var t;if(this.data.graph.chunks!=null){e=this.chunks=this.vis.selectAll("g.chunk").data(this.data.graph.chunks,function(e){return e["#id"]});t=e.enter().append("g").classed("chunk",true)}var n=this.words=this.vis.selectAll("g.word").data(this.data.graph.words,function(e){return e["#id"]});var r=n.enter().append("g").classed("word",true);var i=n.exit();i.remove();n.each(l);if(this.data.graph.chunks!=null){t.each(c)}var s=this.links=this.vis.selectAll("g.link").data(this.data.graph.links,function(e){return e["#id"]});var o=s.enter().append("g").classed("link",true);var u=s.exit();u.remove();this.resetLinksProperties(s);this.preprocessLinksPosition(s);s.each(h)};e.DepGraph.prototype.insertWord=function(e,t){if(e["#id"]==null){e["#id"]=this.id++}if(e["id"]==null){e["id"]="_w"+e["#id"]}this.data.graph.words.splice(t,0,e);for(var n=t+1;n<this.data.graph.words.length;++n){this.data.graph.words[n]["#position"]++}this.update();this.postProcesses()};e.DepGraph.prototype.addLink=function(e){if(e["#id"]==null){e["#id"]=this.id++}this.data.graph.links.push(e);this.update();this.postProcesses()};e.DepGraph.prototype.addChunk=function(e){};e.DepGraph.prototype.removeWord=function(e){var t=[];var n=this.getWordIndexById(e);if(n==null){return false}var r=this.data.graph.words[n]["#position"];var i=this.data.graph.words[n].id;this.data.graph.words.splice(n,1);for(var s=r;s<this.data.graph.words.length;++s){this.data.graph.words[s]["#position"]--}for(var s=0;s<this.data.graph.links.length;s++){var o=this.data.graph.links[s];if(o.source==i||o.target==i){t.push(X(o));this.data.graph.links.splice(s,1);s--}}this.update();this.postProcesses();return t};e.DepGraph.prototype.removeLink=function(e){var t=this.getLinkIndexById(e);if(t==null){return false}this.data.graph.links.splice(t,1);this.update();this.postProcesses();return true};e.DepGraph.prototype.removeChunk=function(e){};e.DepGraph.prototype.getWordNodeByPosition=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["#position"]==e)return t[0][n]}return null};e.DepGraph.prototype.getWordNodeByOriginalId=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["id"]==e)return t[0][n]}};e.DepGraph.prototype.getChunkNodeByOriginalId=function(e){var t=this.vis.selectAll("g.chunk");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["id"]==e)return t[0][n]}};e.DepGraph.prototype.getWordNodeById=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++){if(t[0][n].__data__["#id"]==e)return t[0][n]}};e.DepGraph.prototype.getWordIndexById=function(e){for(var t in this.data.graph.words){if(this.data.graph.words[t]["#id"]==e){return t}}};e.DepGraph.prototype.getLinkById=function(e){for(var t in this.data.graph.links){if(this.data.graph.links[t]["#id"]==e){return this.data.graph.links[t]}}};e.DepGraph.prototype.getLinkIndexById=function(e){for(var t in this.data.graph.links){if(this.data.graph.links[t]["#id"]==e){return t}}};e.DepGraph.prototype.getLinkIndexByOriginalId=function(e){for(var t in this.data.graph.links){if(this.data.graph.links[t].id==e){return t}}};e.DepGraph.prototype.getObjectById=function(e){for(var t in this.data.graph.words){if(this.data.graph.words[t]["#id"]==e){return this.data.graph.words[t]}}for(var t in this.data.graph.links){if(this.data.graph.links[t]["#id"]==e){return this.data.graph.links[t]}}for(var t in this.data.graph.chunks){if(this.data.graph.chunks[t]["#id"]==e){return this.data.graph.chunks[t]}}};e.DepGraph.prototype.getObjectNodeFromObject=function(e){};SVGElement.prototype.getStyle=function(t,n){var r=e.DepGraph.getInstance(this);if(this.__data__["#style"]!=null&&this.__data__["#style"][t]!=null){return this.__data__["#style"][t]}var i=null;if(this.className!=null){i=r.data.graph["#"+this.className.animVal+"-style"][t]}if(i==null&&n!=null){return n}else{return i}};e.highlightObject=function(e,t,n){return v(e,t,n)};e.isObjectPermanentHighlighted=function(e){return m(e)};e.DepGraph.prototype.setSVGDefs=function(){this.defs=this.svg.append("defs");this.defs.append("marker").attr("id",this.viewer.appendOwnID("arrow")).attr("viewBox","0 0 10 10").attr("refX","8").attr("refY","5").attr("markerUnits","strokeWidth").attr("orient","auto").attr("markerWidth","3").attr("markerHeight","3").append("polyline").attr("points","0,0 10,5 0,10 1,5")};e.DepGraph.prototype.crossed=function(e,t){var n=this.getLinkProperties(e);var r=this.getLinkProperties(t);return b(n.nodeStart,r)&&y(n.nodeEnd,r)||b(n.nodeEnd,r)&&y(n.nodeStart,r)};e.DepGraph.prototype.preprocessLinksPosition=function(e){function d(e){var n=Math.abs(e);t.maxLinksStrate=t.maxLinksStrate<n?n:t.maxLinksStrate}var t=this;this.sortLinksByLength(e[0]);var n=e[0].length;var r=[];for(var i=0;i<n;++i){var s=e[0][i];var o=this.getLinkProperties(s);var u=1;while(true){if(r[u]==null){r[u]=new Array;for(var a=o.min*2;a<o.max*2;a++){r[u][a]=s}o.strate=u;break}var f=null;for(var a=o.min*2;a<o.max*2;a++){if(r[u][a]!=null){f=r[u][a];if(this.crossed(s,f)){break}}}if(f!=null){if(this.crossed(s,f)){u=-1;while(true){if(r[u]==null){r[u]=new Array;for(var a=o.min*2;a<o.max*2;a++){r[u][a]=s}o.strate=u;d(u);break}var l=null;for(var a=o.min*2;a<o.max*2;a++){if(r[u][a]!=null){l=r[u][a];break}}if(l!=null){u--}else{for(var a=o.min*2;a<o.max*2;a++){r[u][a]=s}o.strate=u;d(u);break}}break}else{u++}}else{for(var a=o.min*2;a<o.max*2;a++){r[u][a]=s}o.strate=u;d(u);break}}}for(var i=0;i<n;i++){var s=e[0][i];var o=this.getLinkProperties(s);var c;if(o.strate>0){c=-1}else{c=1}for(var u=o.strate;u!=0;u+=c){var h=r[u][o.min*2];if(h!=null&&h!=s){var p=this.getLinkProperties(h);if(p.min==o.min){p.offsetXmin++}}h=r[u][o.max*2-1];if(h!=null&&h!=s){var p=this.getLinkProperties(h);if(p.max==o.max){p.offsetXmax++}}}}};e.DepGraph.prototype.sortLinksByLength=function(e){var t=this;e.sort(function(e,n){return t.getLinkProperties(e).length-t.getLinkProperties(n).length})};e.DepGraph.prototype.getLinkProperties=function(e){var t=e.__data__;if(t["#properties"]==null){var n=new Object;n.nodeStart=this.getWordNodeByOriginalId(t.source);if(n.nodeStart==null){n.nodeStart=this.getChunkNodeByOriginalId(t.source)}n.nodeEnd=this.getWordNodeByOriginalId(t.target);if(n.nodeEnd==null){n.nodeEnd=this.getChunkNodeByOriginalId(t.target)}if(w(n.nodeStart)<w(n.nodeEnd)){n.min=w(n.nodeStart);n.max=w(n.nodeEnd);n.hdir=1}else{n.max=w(n.nodeStart);n.min=w(n.nodeEnd);n.hdir=-1}n.vdir=1;n.offsetXmax=0;n.offsetXmin=0;n.strate=0;n.length=n.max-n.min;if(!n.nodeStart){n.length=0}n.outer=0;t["#properties"]=n}return t["#properties"]};e.DepGraph.prototype.resetLinksProperties=function(e){e.each(function(e,t){e["#properties"]=null});this.maxLinksStrate=0};e.EditObject=function(e){this.depgraph=e;this.editMode=false;this.mode=[];this.highlightMode=false;this.previousSelectedObject=null;this.actionsLog=[];this.currentPtr=-1;this.lastSavedPtr=-1;this.defaultMode={name:"default",onWordSelect:H,onLinkSelect:S,onChunkSelect:S,onWordContext:{"Show Infos":function(e,t){C(e,t)},"Add Node to the left":function(e,t){F(e,t[0],0)},"Add Node to the right":function(e,t){F(e,t[0],1)},Delete:function(e,t){var n=X(t[0].__data__);var r=I(e,t[0].__data__["#id"]);e.editObject.previousSelectedObject=null;return{baseAction:"wordRemoval",word:n,affectedLinks:r}}},onLinkContext:{"Show Infos":function(e,t){C(e,t)},Delete:function(e,t){var n=X(t[0]);n.color=a(t[0],"link-color","black");var r=R(e,t[0].__data__["#id"]);e.editObject.previousSelectedObject=null;if(r){return{baseAction:"linkRemoval",link:n}}}},onChunkContext:null,keyHandler:N,save:null,undo:x,redo:null};this.addEditMode(this.defaultMode)};e.EditObject.prototype.dataChanged=function(){if(this.actionsLog.length==0){return false}else{if(this.currentPtr==this.lastSavedPtr){return true}else{return false}}};e.EditObject.prototype.setEditMode=function(e){var t=this;if(e==null){e="default"}else{editModeExist=false;for(i in this.mode){if(this.mode[i].name==e){editModeExist=true;break}}if(!editModeExist){alert("this edition mode does not exist! switching to default mode");e="default"}}this.editMode=e;if(e){window.onbeforeunload=function(e){var t="Changes made to the graph are not saved. If you leave this page all modifications will be lost.";e=e||window.event;if(e){e.returnValue=t}return t}}else{window.onbeforeunload=null}this.init();this.initToolbar()};e.EditObject.prototype.addEditModeSwitcher=function(){};e.EditObject.prototype.initToolbar=function(){function n(){var t=e.editObject;t.highlightMode=!t.highlightMode;if(t.highlightMode){e.viewer.getToolbarButton("highlight").removeClass("highlightoff").addClass("highlighton")}else{e.viewer.getToolbarButton("highlight").removeClass("highlighton").addClass("highlightoff")}}function r(){var t=e.editObject;if(t.mode[t.editMode].save!=null){t.mode[t.editMode].save(e)}}function i(){var t=e.editObject;if(e.editObject.currentPtr==0){e.viewer.getToolbarButton("undo").hide()}var n=e.editObject.actionsLog[e.editObject.currentPtr];if(t.mode[n.mode].undo!=null){t.mode[n.mode].undo.call(t,e,n.rollbackdata)}e.editObject.currentPtr--;if(t.mode[n.mode].redo!=null){e.viewer.getToolbarButton("redo").show()}t.updateSaveState()}function s(){var t=e.editObject;e.editObject.currentPtr++;if(e.editObject.currentPtr==e.editObject.actionsLog.length-1){e.viewer.getToolbarButton("redo").hide()}var n=e.editObject.actionsLog[e.editObject.currentPtr];if(t.mode[n.mode].redo!=null){t.mode[n.mode].redo.call(t,e,n.rollbackdata)}e.viewer.getToolbarButton("undo").show();t.updateSaveState()}function o(){var t=this.getBoundingClientRect();var n={x:t.left,y:t.top+t.height+2};var r="<div>";r+="Export Format : "+'<select name="type">'+'<option value="json" selected>json</option>'+'<option value="depxml">depxml</option>'+'<option value="dep2pict">dep2pict</option>'+'<option value="conll">conll</option>'+"</select><br/>"+'<input id="export-data'+e.viewer.appendOwnID("")+'"  type="button" value="Export"></div>';r=jQuery(r);e.viewer.loadTooltipContent(r);e.viewer.lockTooltip();jQuery("#export-data"+e.viewer.appendOwnID("")).click(function(){var t=jQuery("select",this.parentNode);var n=t[0].options[t[0].selectedIndex].value;window.open("edit/export/"+n);e.viewer.hideToolTip()});e.viewer.tooltipExitButton.show();e.viewer.showTooltip(n)}var e=this.depgraph;e.viewer.resetToolbarButtons();var t=[["save",r,"right","saved"],["undo",i,"left","undo"],["redo",s,"left","redo"],["highlight",n,"left","highlightoff"],["export",o,"right","export"]];if(this.mode[this.editMode].buttons!=null){for(button in this.mode[this.editMode].buttons){t.push(button)}}e.viewer.setToolbarButtons(t);if(this.currentPtr<0||this.mode[this.editMode].undo==null){e.viewer.getToolbarButton("undo").hide()}if(this.currentPtr==this.actionsLog.length-1||this.mode[this.editMode].redo==null){e.viewer.getToolbarButton("redo").hide()}};e.EditObject.prototype.setNeedToSave=function(){this.depgraph.viewer.getToolbarButton("save").removeClass("saved").addClass("save")};e.EditObject.prototype.updateSaveState=function(){if(this.lastSavedPtr==this.currentPtr){this.depgraph.viewer.getToolbarButton("save").removeClass("save").addClass("saved")}else{this.depgraph.viewer.getToolbarButton("save").removeClass("saved").addClass("save")}};e.EditObject.prototype.init=function(){function n(t,n,r){var i=e.editObject;var n=n.menu;if(i.mode[i.editMode][t][n]!=null){var s=i.mode[i.editMode][t][n].call(this,e,r);i.pushAction({mode:i.editMode,rollbackdata:s,data:{event:"onContextClick",params:{object_type:t,menu:n,object:r}}})}}function r(t,n){var r=e.editObject;if(r.mode[r.editMode].onWordSelect!=null){var i=r.mode[r.editMode].onWordSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onWordSelect",params:{d:t,i:n}}})}}function i(t,n){var r=e.editObject;if(r.mode[r.editMode].onLinkSelect!=null){var i=r.mode[r.editMode].onLinkSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onLinkSelect",params:{d:t,i:n}}})}}function s(t,n){var r=e.editObject;if(r.mode[r.editMode].onChunkSelect!=null){var i=r.mode[r.editMode].onChunkSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onChunkSelect",params:{d:t,i:n}}})}}function o(t){var n=e.editObject;if(n.mode[n.editMode].keyHandler!=null){var r=n.mode[n.editMode].keyHandler.call(this,e,{keyCode:d3.event.keyCode});n.pushAction({mode:n.editMode,rollbackdata:r,data:{event:"keyHandler",params:{keyCode:d3.event.keyCode}}})}}var e=this.depgraph;if(!this.editMode){this.depgraph.vis.selectAll("g.word").on("click",null);this.depgraph.vis.selectAll("g.link").on("click",null);this.depgraph.vis.selectAll("g.chunk").on("click",null);d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,null);this.depgraph.viewer.resetToolbarButtons();jQuery(".link",this.depgraph.vis.node()).contextMenu("",{});jQuery(".word",this.depgraph.vis.node()).contextMenu("",{});jQuery(".chunk",this.depgraph.vis.node()).contextMenu("",{});return}this.depgraph.vis.selectAll("g.word").on("click",r);this.depgraph.vis.selectAll("g.link").on("click",i);this.depgraph.vis.selectAll("g.chunk").on("click",s);d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,o);if(this.mode[this.editMode].onLinkContext!=null){var t={};for(menu in this.mode[this.editMode].onLinkContext){t[menu]={menu:menu,click:function(e){n("onLinkContext",this,e)},klass:"menu-item-1"}}jQuery(".link",this.depgraph.vis.node()).contextMenu("link-context-menu",t)}if(this.mode[this.editMode].onWordContext!=null){var t={};for(menu in this.mode[this.editMode].onWordContext){t[menu]={menu:menu,click:function(e){n("onWordContext",this,e)},klass:"menu-item-1"}}jQuery(".word",this.depgraph.vis.node()).contextMenu("word-context-menu",t)}if(this.mode[this.editMode].onChunkContext!=null){var t={};for(menu in this.mode[this.editMode].onChunkContext){t[menu]={menu:menu,click:function(e){n("onChunkContext",this,e)},klass:"menu-item-1"}}jQuery(".chunk",this.depgraph.vis.node()).contextMenu("chunk-context-menu",t)}};e.EditObject.prototype.addEditMode=function(e){this.mode[e.name]=e};e.EditObject.prototype.pushAction=function(e){if(e.rollbackdata!=null&&this.mode[e.mode].undo!=null){this.depgraph.viewer.getToolbarButton("redo").hide();var t=this.depgraph.viewer.getToolbarButton("undo");t.show();this.actionsLog.splice(++this.currentPtr,this.actionsLog.length-this.currentPtr,e);this.updateSaveState()}};e.EditObject.prototype.clearSelection=function(){if(this.previousSelectedObject!=null){try{this.previousSelectedObject.selected=false;v(this.previousSelectedObject,false)}catch(e){}this.previousSelectedObject=null}};e.EditObject.prototype.selectObject=function(e){if(this.previousSelectedObject==e){this.clearSelection();return}this.clearSelection();this.previousSelectedObject=e;v(this.previousSelectedObject,true);e.selected=true};e.EditObject.prototype.changeAttributes=function(e,t,n){var r=X(e);var i=[];for(var s=0;s<t.length;s++){var o=E(e,t[s].path,t[s].value);i.push({path:t[s].path,value:o})}if(n!=null&&n){var u={mode:this.editMode,rollbackdata:{baseAction:"changeAttr",obj:r,attrs:t,oldAttrs:i}};this.pushAction(u)}};e.selectObject=function(e,t){return S(e,t)};e.showToolTip=function(e,t){return C(e,t)};e.isALink=function(e){return U(e)};e.isAWord=function(e){return z(e)};e.isAChunk=function(e){return W(e)};e.clone=X;e.removeUnit=function(e){return Q(e)}})(window.depgraphlib=window.depgraphlib||{},jQuery)