(function(){function e(){var e={};return e.windowOpenPost=function(t,n){e.windowOpenPostForm='<form id="depgraphlibWindowOpenPostForm" method="post" action="'+n+'" target="_blank"></form>';var r=jQuery("#depgraphlibWindowOpenPostForm");r.length||(r=jQuery(e.windowOpenPostForm),jQuery("body").append(r)),r.html("");for(param in t){var i=null;typeof t[param]=="string"?i=t[param]:i=JSON.stringify(t[param]),r.append('<input type="hidden" name="'+param+'" value="">'),r[0][param].value=i}document.getElementById("depgraphlibWindowOpenPostForm").submit()},e.clone=function(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date){var n=new Date;return n.setTime(t.getTime()),n}if(t instanceof Array){var n=[];for(var r=0,i=t.length;r<i;r++)n[r]=e.clone(t[r]);return n}if(t instanceof Object){var n={};for(var s in t)t.hasOwnProperty(s)&&(n[s]=e.clone(t[s]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")},e.setGroupPosition=function(e,t,n){e.attr("transform","translate("+t+","+n+")")},e.center=function(e,t){var n=t.node().getBBox(),r=e.node().getBBox();e.attr("x",-r.width/2+n.width/2)},e.getTransformValues=function(e){var t=e.attr("transform"),n=/(\w+)\((.*?)\)/g,r=new Object,i;while((i=n.exec(t))!=null){var s=/(-*\w+\.*\w*)/g;r[i[1]]=[];var o;while((o=s.exec(i[2]))!=null)r[i[1]].push(parseFloat(o[1]))}return r},e.JSONresolveReferences=function(e,t){function i(e,t,n,r){for(var s in e){if(!e.hasOwnProperty(s))continue;if(s=="id"){n[e[s]]=e;continue}var o=typeof e[s];if(o=="object")i(e[s],t,n,r);else if(o=="string"&&e[s].indexOf(t)==0){var u=e[s].substring(1);n[u]!=null?(e[s]=n[u],i(e[s],t,n,r)):r.push[e[s]]}}}var n=[],r=[];i(e,t,n,r);for(elt in r){if(n[elt]==null)throw"This object has missing references!";elt=n[elt]}},e.removeUnit=function(e){var t=/(-*)(\d+\.*\d*)px/,n=t.exec(e);if(n!=null){var r=n[1].length%2==0?"":"-";e=r+n[2]}return parseFloat(e)},e.addPxs=function(){var t=0;for(var n=0;n<arguments.length;n++){var r=e.removeUnit(arguments[n]);t+=parseInt(r)}return t+"px"},e.rgbToHex=function(e,t,n){return"#"+((1<<24)+(e<<16)+(t<<8)+n).toString(16).slice(1)},e.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},e.rgbToHsl=function(e,t,n){e/=255,t/=255,n/=255;var r=Math.max(e,t,n),i=Math.min(e,t,n),s,o,u=(r+i)/2;if(r==i)s=o=0;else{var a=r-i;o=u>.5?a/(2-r-i):a/(r+i);switch(r){case e:s=(t-n)/a+(t<n?6:0);break;case t:s=(n-e)/a+2;break;case n:s=(e-t)/a+4}s/=6}return{h:s,s:o,l:u}},e.hslToRgb=function(e,t,n){var r,i,s;if(t==0)r=i=s=n;else{function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var u=n<.5?n*(1+t):n+t-n*t,a=2*n-u;r=o(a,u,e+1/3),i=o(a,u,e),s=o(a,u,e-1/3)}return{r:Math.floor(r*255),g:Math.floor(i*255),b:Math.floor(s*255)}},window.depgraphlib=e,e}typeof define=="undefined"?e():define("app/depgraphlib",e)})(),function(){function e(e){function n(){var e=jQuery(this),n=t.getInstance(e[0].id);e.parent().animate({bottom:"0px"}),e.removeClass("slide-up"),e.addClass("slide-down"),n.mainpanel.css("border","1px solid grey")}function r(){var e=jQuery(this),n=t.getInstance(e[0].id),r=e.parent();r.animate({bottom:-r.height()+20+"px"}),e.removeClass("slide-down"),e.addClass("slide-up"),n.mainpanel.css("border","none")}function s(){var e=jQuery(this);e.hasClass("slide-up")?n.call(e):r.call(e)}function o(e){for(var t=0;t<e.length;t++)e[t].method.call(e[t].caller,e[t].args)}var t=function(e,n){n==null&&(n=Math.floor(Math.random()*1e16).toString()),this.allowFullScreen=!0,this.imagemode=!1,this.debugPanelActive=!1,this.fixedToolbar=!1,this._height="600px",this._width="100%",this.basemargin=10,this.margin={top:100,left:0,right:0,bottom:10},this.borders=!0,t.instances[n]&&(n+="_");var n=this.uid=n;typeof e=="string"&&(e=jQuery(e));var e=this.container=e;e.css("display","inline-block");var r=this.mainpanel=this.createDiv("gv-main-panel","gv-main-panel");e.append(r);var i=this.chart=this.createDiv("gv-chart","gv-chart");r.append(i);var s=this.toolbar=this.initToolBar(),o=this.debugpanel=this.createDebugPanel();this.tooltip=this.createToolTipPanel(),this.tooltip.hide(),this.altpanel=this.createDiv("gv-alt-panel","gv-alt-panel"),this.altpanelcontent=this.createDiv("alt-panel-content","alt-panel-content"),this.ajaxLoader=this.createDiv("ajax-loader","ajax-loader"),this.ajaxLoader.hide(),this.mainpanel.append(this.ajaxLoader),this.extraDiv=this.createDiv("gv-extra","gv-extra"),this.extraDiv.hide(),this.mainpanel.append(this.extraDiv),r.append(this.tooltip),r.append(this.altpanel),this.altpanel.append(this.altpanelcontent),t.instances[n]=this,this.callbacks=new Object,this.callbacks.fullscreen=new Object,this.callbacks.fullscreen.oncomplete=[],this.callbacks.fullscreen.onclose=[],this.callbacks.showaltpanel=[],this.callbacks.hidealtpanel=[],this.toolbar.hide(),this.toolbar_landing_area.hover(function(){var e=t.getInstance(this);e.fixedToolbar||(e.toolbar.queue().length==0?(e.toolbar.slideDown(100,function(){e.toolbar.queue("depgraph_toolbar_hiding_bufferqueue").length%2==1&&e.toolbar.dequeue("depgraph_toolbar_hiding_bufferqueue")}),e.mainpanel.css("border","1px solid grey")):e.toolbar.slideDown({duration:100,queue:"depgraph_toolbar_hiding_bufferqueue"}))},function(){var e=t.getInstance(this);e.fixedToolbar||(e.toolbar.queue().length==0?(e.toolbar.slideUp(100,function(){e.toolbar.queue("depgraph_toolbar_hiding_bufferqueue").length%2==1&&e.toolbar.dequeue("depgraph_toolbar_hiding_bufferqueue")}),e.borders||e.mainpanel.css("border","none")):e.toolbar.slideUp({duration:100,queue:"depgraph_toolbar_hiding_bufferqueue"}))})};return t.instances=t.instances||[],t.getInstance=function(e){var n="";if(t.prototype.isPrototypeOf(e))return e;e.ownerSVGElement!=null?n=e.ownerSVGElement.parentNode.id:typeof e=="object"&&e.id!=null?n=e.id:n=e,regex=/.*-(\w+)/;var r=regex.exec(n),i=null;return r!=null&&(i=t.instances[r[1]]),i==null&&(i=t.getInstance(e.parentNode)),i},t.prototype.initToolBar=function(){var e=this.toolbar_landing_area=this.createDiv("gv-toolbar-landing-area","gv-toolbar-landing-area"),t=this.createDiv("gv-toolbar","gv-toolbar");e.append(t),this.mainpanel.append(this.toolbar_landing_area);var n=this.toolbarbuttons=this.createDiv("gv-toolbarbuttons","gv-toolbarbuttons");return t.append(n),this.addFullScreenButton(),t},t.prototype.createDebugPanel=function(){var e=this.debugpanel=this.createDiv("gv-debug-panel","gv-debug-panel");this.debugpanelinfo=this.createDiv("debug-panel-info","debug-panel-info"),e.append(this.debugpanelinfo);var n=this.createDiv("debug-panel-slider","debug-panel-slider slider-button slide-up");n.click(s),e.append(n);var i=this.createDiv("debug-panel-fullscreen","debug-panel-fullscreen slider-button maximize");i.click(function(e){var n=t.getInstance(this);if(n!=null){n.viewAltContent("debug-panel-content"+n.appendOwnID(""));var i=jQuery("#debug-panel-slider"+n.appendOwnID(""));i.hasClass("slide-down")&&r.call(i)}}),e.append(i);var o=this.debugcontentcontainer=this.createDiv("debug-panel-container","debug-panel-container");return e.append(o),this.debugpanelcontent=this.createDiv("debug-panel-content","debug-panel-content"),o.append(this.debugpanelcontent),this.mainpanel.append(e),this.adjustDebugHeight(),e.hide(),e},t.prototype.debugLog=function(e){this.debugpanelcontent.append(e+"<br/>")},t.prototype.createToolTipPanel=function(){var e=this;this.tooltip=this.createDiv("gv-tooltip","gv-tooltip");var t=jQuery('<div style="display:inline-block;"></div>');return this.tooltip.append(t),this.tooltipExitButton=this.createDiv("tooltip-exit-button","tooltip-exit-button"),this.tooltipExitButton.css("float","right"),this.tooltipExitButton.css("display","block"),this.tooltipExitButton.click(function(){e.hideToolTip()}),t.append(this.tooltipExitButton),this.tooltipExitButton.hide(),this.tooltip.draggable(),this.tooltipContainer=this.createDiv("tooltip-container"),t.append(this.tooltipContainer),this.tooltip},t.prototype.appendOwnID=function(e){return e.endsWith(this.uid)?e:e+"-"+this.uid},t.prototype.addWrapper=function(e){var t=this,n=this.wrapper=t.createElement("a","gv-wrapper","gv-wrapper");return n.html(e),t.container.prepend(n),t.mainpanel.hide(),n.click(function(e){t.mainpanel.toggle()}),n},t.prototype.createDiv=function(e,t){return this.createElement("div",e,t)},t.prototype.createElement=function(e,t,n){n=n!=null?'class="'+n+'"':"";var r="<"+e+' id="'+this.appendOwnID(t)+'" '+n+"></"+e+">";return jQuery(r)},t.prototype.adjustDebugHeight=function(){var e=this.mainpanel.height()-this.toolbar.height();this.debugpanel.css("height",e),this.debugcontentcontainer.css("height",e-20),this.debugpanel.css("bottom",-e+20)},t.prototype.shrinkHeightToContent=function(t){t==null&&(t=0);var n=d3.select(this.chart.children()[0]).select("g"),r=n.node().getBBox(),i=e.getTransformValues(n);this.setHeight(i.translate[1]+r.y*i.scale[0]+r.height*i.scale[0]+t*i.scale[0])},t.prototype.shrinkWidthToContent=function(t){t==null&&(t=0);var n=d3.select(this.chart.children()[0]).select("g"),r=n.node().getBBox(),i=e.getTransformValues(n);this.setWidth(i.translate[0]+r.x+r.width+marginLeft)},t.prototype.shrinkToContent=function(t,n){n==null&&(n=0),t==null&&(t=0);var r=d3.select(this.chart.children()[0]).select("g"),i=r.node().getBBox(),s=e.getTransformValues(r),o=this.mainpanel.width(),u=s.translate[0]+i.x+i.width+t;this.setSize(u,s.translate[1]+i.y+i.height+n)},t.prototype.setSize=function(e,t){this.setWidth(e),this.setHeight(t)},t.prototype.setImageMode=function(e){e==null&&(e=!0),this.imagemode=e,e?(this.toolbar.detach(),this.debugpanel.detach(),this.tooltip.detach()):(this.mainpanel.append(this.toolbar),this.mainpanel.append(this.debugpanel),this.mainpanel.append(this.tooltip)),this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20),this.margin.bottom=this.basemargin+(this.imagemode?0:20)},t.prototype.noBorders=function(){this.borders=!1,this.mainpanel.css("border","none")},t.prototype.debugMode=function(e){e==null&&(e=!0),this.debugPanelActive=e,e?this.debugpanel.show():this.debugpanel.hide()},t.prototype.setWidth=function(e){this._width=e,this.mainpanel.css("width",e),this.ajaxLoader.width(e)},t.prototype.setHeight=function(e){e+=30,this._height=e,this.mainpanel.css("height",e),this.margin.top=this.chart.height()/10+this.basemargin+(this.imagemode?0:20),this.margin.bottom=this.basemargin+this.imagemode?0:20,this.ajaxLoader.height(e-this.toolbar.height()),this.ajaxLoader.css("top",this.toolbar.height()),this.debugPanelActive&&this.adjustDebugHeight()},t.prototype.setFixedToolbar=function(e){e==null&&(e=!0),this.fixedToolbar=e,e?this.toolbar.show():this.toolbar.hide()},t.prototype.addFullScreenButton=function(){if(!this.allowFullScreen)return;typeof this.container.colorbox!="undefined"&&(this.addToolbarButton("fullscreen",null,"right","fullscreen","View in fullscreen"),this.initFullscreenMode())},t.prototype.existToolbarButton=function(e){return jQuery("#button-"+this.appendOwnID(e)).length>0},t.prototype.getToolbarButton=function(e){return jQuery("#button-"+this.appendOwnID(e))},t.prototype.setToolbarButtons=function(e){this.tmpLeft=[],e.forEach(function(e,t){e[2]=="left"?this.tmpLeft.push(e):this.addToolbarButton(e[0],e[1],e[2],e[3],e[4])},this),this.tmpLeft.forEach(function(e,t){this.addToolbarButton(e[0],e[1],e[2],e[3],e[4])},this),this.tmpLeft=null},t.prototype.resetToolbarButtons=function(){var e=this.toolbarbuttons.children();e.remove(),this.addFullScreenButton()},t.prototype.addToolbarElement=function(e,t){e.css("float",t),this.toolbarbuttons.append(e)},t.prototype.addToolbarButton=function(e,t,n,r,i){var s="";r==null?(r="tab white",s=e):r+=" icon",n==null&&(n="left");var o='<div id="button-'+this.appendOwnID(e)+'" title="'+(i||e)+'" class="'+r+" tab "+n+'">'+s+"</div>";o=jQuery(o),o.click(t),this.toolbarbuttons.append(o)},t.prototype.removeToolbarButton=function(e){jQuery("#button-"+this.appendOwnID(e)).remove()},t.createDropDownMenu=function(e,t,n,r){var s=jQuery('<div class="gv-menu"><div class="gv-menu-header"></div><div class="gv-menu-body"></div></div>'),o=jQuery(".gv-menu-header",s),u=jQuery(".gv-menu-body",s);u.hide(),o.html(e),o.attr("title",r||e),o.addClass("white");for(i in t){var a=jQuery("<div>"+i+"</div>");a.attr("title",t[i].tt||i),u.append(a),jQuery(a).click(t[i].cb)}return n===!1?(jQuery(".gv-menu-header",s).click(function(e){jQuery(".gv-menu-body",e.currentTarget.parentNode).slideDown()}),jQuery(s).mouseleave(function(e){jQuery(".gv-menu-body",e.currentTarget).slideUp()})):s.hover(function(e){jQuery(".gv-menu-body",e.currentTarget).slideDown()},function(e){jQuery(".gv-menu-body",e.currentTarget).slideUp()}),s},t.prototype.viewAltContent=function(e){this.resetAltPanel(),this.addContentToAltPanel(e),this.showAltPanel()},t.prototype.hideAltPanel=function(){this.chart.show(),this.altpanel.hide(),this.removeToolbarButton("back"),o(this.callbacks.hidealtpanel)},t.prototype.showAltPanel=function(e){this.chart.hide(),this.altpanel.show(),this.addToolbarButton("back",function(){t.getInstance(this.id).hideAltPanel()},"left","back"),o(this.callbacks.showaltpanel)},t.prototype.addContentToAltPanel=function(e,n){this.altpanelcontent.html(jQuery("#"+this.appendOwnID(e)).html()),n!=null&&this.addToolbarButton(n,function(){t.getInstance(this.id).addContentOnAltPanel(e)},"left")},t.prototype.resetAltPanel=function(){this.altpanelcontent.html("")},t.prototype.createBox=function(t){return t.viewer=this,new e.Box(t)},e.Box=function(t){var n=this;t.viewer!=null&&(e.Box.instances.push(this),this.viewer=t.viewer),this.object=jQuery('<div class="depgraphlib-box"><div class="depgraphlib-box-header"></div><div class="depgraphlib-box-content"></div><div class="depgraphlib-box-footer"></div></div>'),t.id&&this.object.attr("id",t.id);if(t.closeButton){var r=jQuery('<div class="tooltip-exit-button"/>');r.css("float","right"),r.css("display","block"),r.click(function(){n.close(!0)}),jQuery(".depgraphlib-box-header",this.object).append(r)}return t.position&&(this.object.css("top",t.position.y),this.object.css("left",t.position.x)),t.draggable&&this.object.draggable(),t.autodestroy&&(this.tooltipCreationBug=!0,d3.select(document).on("click.box_"+e.Box.instances.length,function(e){!n.tooltipCreationBug&&!jQuery.contains(n.object[0],d3.event.originalTarget)&&n.destroy(),delete n.tooltipCreationBug})),jQuery("body").append(this.object),this},e.Box.prototype.setContent=function(e){var t=jQuery(".depgraphlib-box-content",this.object);return t.html(e.html()),this},e.Box.prototype.setHeader=function(e){return this},e.Box.prototype.setFooter=function(e){return this},e.Box.instances=e.Box.instances||[],e.Box.prototype.open=function(e){return e&&(this.object.css("top",e.y),this.object.css("left",e.x)),this.object.show(),this},e.Box.prototype.getDOM=function(e){return e?this.dom:this.object},e.Box.getBox=function(t){for(var n=0;n<e.Box.instances.length;++n)if(jQuery.contains(e.Box.instances[n],t))return e.Box.instances[n]},e.Box.prototype.close=function(e){e?this.destroy():this.object.hide()},e.Box.prototype.destroy=function(){this.object.remove()},t.prototype.loadTooltipContent=function(e){var n,r=t.getInstance(this);typeof e=="string"?n=jQuery("#"+r.appendOwnID(e)):n=e,r.tooltipContainer.html(n.html())},t.prototype.showTooltip=function(e){var n=t.getInstance(this);n.tooltip.css("left",e.x),n.tooltip.css("top",e.y),n.tooltip.show()},t.prototype.hideToolTip=function(){var e=t.getInstance(this);e.tooltip.hide()},t.prototype.ajaxStart=function(){this.ajaxLoader.show()},t.prototype.ajaxFinished=function(){this.ajaxLoader.hide()},t.prototype.initFullscreenMode=function(){var e=this,t=jQuery("#button-fullscreen"+this.appendOwnID(""));t.colorbox({inline:!0,href:"#gv-main-panel"+e.appendOwnID(""),width:"95%",height:"95%",onLoad:function(){e.removeToolbarButton("fullscreen"),e.mainpanel.width("99%"),e.mainpanel.height("99%")},onComplete:function(){e.adjustDebugHeight(),o(e.callbacks.fullscreen.oncomplete)},onClosed:function(){e.mainpanel.width(e._width),e.mainpanel.height(e._height),e.addToolbarButton("fullscreen",null,"right","fullscreen"),e.adjustDebugHeight(),e.initFullscreenMode(),o(e.callbacks.fullscreen.onclose)}})},String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1},t.prototype.screenCoordsForElt=function(e){while(Object.prototype.toString.call(e)==="[object Array]")e=e[0];var t=e.getBBox(),n=this.chart[0].querySelector("svg"),r=n.createSVGPoint(),i={},s=e.getScreenCTM();return r.x=t.x,r.y=t.y,i.nw=r.matrixTransform(s),r.x+=t.width,i.ne=r.matrixTransform(s),r.y+=t.height,i.se=r.matrixTransform(s),r.x-=t.width,i.sw=r.matrixTransform(s),i},e.GraphViewer=t,t}typeof define=="undefined"?e(depgraphlib):define("app/graphviewer",["app/depgraphlib"],e)}(),function(){function e(e){function n(t,n,r){var i=n.split("/"),s=t;for(var o=0;o<i.length-1;o++){var u=s[i[o]];typeof u=="object"&&(u==null&&(s[i[o]]=new Object),s=null,s=u)}var a=e.clone(s[i[i.length-1]]);return s[i[i.length-1]]=r,a}function r(t,n){if(t.editObject.highlightMode){var r=!e.isObjectPermanentHighlighted(this);e.highlightObject(this,r,!0),t.editObject.setNeedToSave();return}t.editObject.selectObject(this)}function s(e,t){if(t.baseAction=="linkRemoval"){var n=t.link,r=e.getWordNodeByOriginalId(n.__data__.source),i=e.getWordNodeByOriginalId(n.__data__.target);T(e,r,i,n.__data__.label,n.color,n.__data__["#id"])}else if(t.baseAction=="linkAddition")N(e,t.addedLink["#id"]);else if(t.baseAction=="wordAddition")x(e,t.addedWord["#id"]);else if(t.baseAction=="wordRemoval"){var s=t.word;E(e,s);if(t.affectedLinks!=null)for(var o=0;o<t.affectedLinks.length;o++){var n=t.affectedLinks[o],r=e.getWordNodeByOriginalId(n.source),i=e.getWordNodeByOriginalId(n.target);n.color=n["#style"]["link-color"]?n["#style"]["link-color"]:e.data.graph["#link-style"]["link-color"],T(e,r,i,n.label,n.color,n["#id"])}}else if(t.baseAction=="changeAttr"){var u=t.obj["#id"],a=e.getObjectById(u);e.editObject.changeAttributes(a,t.oldAttrs),e.update(),e.postProcesses()}}function o(e,t){}function u(t,n){if(n.keyCode==46&&t.editObject.previousSelectedObject!=null)if(C(t.editObject.previousSelectedObject)){var r=e.clone(t.editObject.previousSelectedObject);r.color=e.getStyleElement(t.editObject.previousSelectedObject,"link-color","black");var i=N(t,t.editObject.previousSelectedObject.__data__["#id"]);t.editObject.previousSelectedObject=null;if(i)return{baseAction:"linkRemoval",link:r}}else if(k(t.editObject.previousSelectedObject)){var s=e.clone(t.editObject.previousSelectedObject.__data__),o=x(t,t.editObject.previousSelectedObject.__data__["#id"]);return t.editObject.previousSelectedObject=null,{baseAction:"wordRemoval",word:s,affectedLinks:o}}}function a(e,t){var n=e.viewer.screenCoordsForElt(t[0]),r={x:(n.ne.x+n.nw.x)/2,y:n.nw.y},i=v(e,t[0]);e.viewer.createBox({closeButton:!0,draggable:!0}).setContent(i).open(r)}function f(e,t,n){var r=n["#style"]!=null&&n["#style"]["link-color"]!=null?n["#style"]["link-color"]:e.data.graph["#link-style"]["link-color"];return t+='<tr><td>label</td><td><input type="text" name="label" value="'+n.label+'"></td></tr>',t+="<tr><td>source</td><td>"+h(e,n.source)+"</td></tr>",t+="<tr><td>target</td><td>"+h(e,n.target)+"</td></tr>",t+="<tr><td>color</td><td>"+c("colorPicker",r)+"</td></tr>",t}function l(e,t,n){var r=e.editObject.dataModel;if(!r.words){r.words=[],r.words[0]={name:"label"};for(var i=0;i<n.sublabel.length;i++)r.words[i+1]={name:"sublabel"+i}}t+="<tr><td>"+r.words[0].name+'</td><td><input id="word-edit-'+r.words[0].name+'" type="text" name="'+r.words[0].name+'" value="'+n.label+'"></td></tr>';for(var i=1;i<r.words.length;i++)t+="<tr><td>"+r.words[i].name+'</td><td><input id="word-edit-'+r.words[i].name+'" type="text" name="'+r.words[i].name+'" value="'+n.sublabel[i-1]+'"></td></tr>';return t}function c(e,t){var n='<table><tr><td><input type="text" name="'+e+'" value="'+t+'" onkeydown="jQuery(jQuery(jQuery(this).parent().parent().children()[1]).children()[0]).css(\'background-color\',this.value+String.fromCharCode(event.keyCode));"></td><td><div style="display:inline-block; width:30px; height:30px; background-color:'+t+';"></div></td></tr></table>';return n}function h(e,t){var n="<select>";for(var r=0;r<e.data.graph.words.length;r++){var i=e.data.graph.words[r];n+='<option value="'+i.id+'" ',n+=i.id==t?'selected="true"':"",n+=">#"+i["#position"]+" "+i.label+" ("+i.id+")",n+="</option>"}return n+="</select>",n}function p(e){var t="<select>";for(var n=0;n<e.data.graph.words.length+1;n++){var r=n>0&&n<e.data.graph.words.length+1?e.data.graph.words[n-1]:{label:"^"},i=n<e.data.graph.words.length?e.data.graph.words[n]:{label:"$"};t+='<option value="'+n+'" ',t+=">#"+n+" ("+r.label+" x "+i.label+")",t+="</option>"}return t+="</select>",t}function d(e){var t="";return t+="<div><h3>Add a new word</h3>",t+="<table><tr>",t+="<td><label>Label</label></td>",t+='<td><input type="text" name="label"></td></tr>',t+="<tr><td><label>Sublabels (separated by commas, use \\, for commas)</label></td>",t+='<td><input type="text" name="sublabels"></td></tr>',t+="<tr><td><label>Position</label></td>",t+="<td>"+p(e)+"</td></tr>",t+="</table></div>",t}function v(e,t){var n=t.__data__,r="";t.classList!=null&&t.classList.length>0&&(r=t.classList[0]);var i='<div><h3 id="edit-info-title">Edit '+r+" (original id: "+n.id+")</h3>"+'<table class="main-properties-table" ref="'+n["#id"]+'">';r=="word"?i=l(e,i,n):r=="link"&&(i=f(e,i,n)),i+="</table>",i+='<input id="'+e.viewer.appendOwnID(r+"-save-properties")+'" type="button" value="Save" onclick="depgraphlib.saveProperties.call(this,arguments);">',i+="</div>";var s=jQuery(i);return s}function m(){var t=this.id.substring(0,this.id.indexOf("-")),n=e.DepGraph.getInstance(this),r=n.viewer,i=jQuery(this).parent().find("table.main-properties-table");t=="link"?g(n,i):t=="word"&&y(n,i),n.update(),n.postProcesses();var s=e.Box.getBox(this);s.destroy()}function g(e,t){var n=e.getLinkById(t.attr("ref")),r=t[0].rows,i=[];for(var s=0;s<r.length;s++){var o=r[s],u=o.cells,a=u[0].innerHTML,f=u[1];a=="label"?i.push({path:"label",value:f.firstChild.value}):a=="color"?i.push({path:"#style/link-color",value:f.firstChild.rows[0].cells[0].firstChild.value}):a=="source"?i.push({path:"source",value:f.childNodes[0].options[f.childNodes[0].options.selectedIndex].value}):a=="target"&&i.push({path:"target",value:f.childNodes[0].options[f.childNodes[0].options.selectedIndex].value})}e.editObject.changeAttributes(n,i,!0)}function y(e,t){var n=e.getWordNodeById(t.attr("ref")).__data__,r=t[0].rows,i=[];for(var s=0;s<r.length;s++){var o=r[s],u=o.cells,a=u[0].innerHTML,f=u[1];s==0?i.push({path:"label",value:f.firstChild.value}):i.push({path:"sublabel/"+(s-1),value:f.firstChild.value})}e.editObject.changeAttributes(n,i,!0)}function b(e,t){if(e.editObject.previousSelectedObject==null||C(e.editObject.previousSelectedObject))r.call(this,e,t);else{if(this.__data__["#id"]==e.editObject.previousSelectedObject.__data__["#id"]){e.editObject.clearSelection();return}w(e,e.editObject.previousSelectedObject,this,t)}}function w(e,t,n,r){var i=e.viewer.screenCoordsForElt(n),s={x:(i.ne.x+i.nw.x)/2,y:i.nw.y},o='<div><table style="margin:5px 0px 0px 0px;"><tr><td>Link name : </td><td><input type="text" name="link-name" value=""></td></tr><tr><td>Link color : </td><td><input type="text" name="link-color" value="black"></td></tr><tr><td colspant="2"><input id="link-settings'+e.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Create Link"></td></tr>'+"</table></div>";o=jQuery(o);var u=e.viewer.createBox({closeButton:!0,draggable:!0}).setContent(o).open(s);e.editObject.clearSelection(),jQuery("#link-settings"+e.viewer.appendOwnID("")).click(function(){var i=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value,s=this.parentNode.parentNode.parentNode.childNodes[1].childNodes[1].childNodes[0].value,o=T(e,t,n,i,s),a={baseAction:"linkAddition",addedLink:o};e.editObject.pushAction({mode:e.editObject.editMode,rollbackdata:a,data:{event:"onWordSelect",params:r}}),u.destroy()})}function E(t,n){var r=n["#position"];return t.insertWord(n,r),t.editObject.init(),t.autoHighLightOnMouseOver(),e.clone(n)}function S(e,t,n){var r=e.viewer.screenCoordsForElt(t),i={x:(r.ne.x+r.nw.x)/2,y:r.nw.y},s='<div><table style="margin:5px 0px 0px 0px;"><tr><td>Word label : </td><td><input type="text" name="word-label" value=""></td></tr><tr><td colspant="2"><input id="word-settings'+e.viewer.appendOwnID("")+'"  type="button" style="margin:0" value="Insert Word"></td></tr>'+"</table></div>";s=jQuery(s);var o=e.viewer.createBox({closeButton:!0,draggable:!0}).setContent(s).open(i);e.editObject.clearSelection(),jQuery("#word-settings"+e.viewer.appendOwnID("")).click(function(){var r=this.parentNode.parentNode.parentNode.childNodes[0].childNodes[1].childNodes[0].value;if(r==null||r==""){alert("you must fill all required fields");return}var i={label:r,sublabel:[],"#position":t.__data__["#position"]+n},s=E(e,i),u={baseAction:"wordAddition",addedWord:s};e.editObject.pushAction({mode:e.editObject.editMode,rollbackdata:u,data:{event:"onWordContext",params:t}}),o.destroy()})}function x(e,t){var n=e.removeWord(t);return n}function T(e,t,n,r,i,s){i==null&&(i="black"),s==null&&(s=e.id++),t=t.__data__,n=n.__data__;var o=new Object;return o.source=t.id,o.target=n.id,o["#style"]={"link-color":i},o.label=r,o["#id"]=s,e.addLink(o),e.editObject.init(),e.autoHighLightOnMouseOver(),o}function N(e,t){var n=e.removeLink(t);return n}function C(e){return e.__data__.target!=null&&e.__data__.source!=null}function k(e){return e.__data__["#position"]!=null}function L(e){return e.elements!=null}var t=function(t){this.depgraph=t,this.editMode=!1,this.mode=[],this.highlightMode=!1,this.dataModel={},this.previousSelectedObject=null,this.actionsLog=[],this.currentPtr=-1,this.lastSavedPtr=-1,this.defaultMode={name:"default",onWordSelect:b,onLinkSelect:r,onChunkSelect:r,onWordContext:{"Show Infos":function(e,t){a(e,t)},"Add Node to the left":function(e,t){S(e,t[0],0)},"Add Node to the right":function(e,t){S(e,t[0],1)},Delete:function(t,n){var r=e.clone(n[0].__data__),i=x(t,n[0].__data__["#id"]);return t.editObject.previousSelectedObject=null,{baseAction:"wordRemoval",word:r,affectedLinks:i}}},onLinkContext:{"Show Infos":function(e,t){a(e,t)},Delete:function(t,n){var r=e.clone(n[0]);r.color=e.getStyleElement(n[0],"link-color","black");var i=N(t,n[0].__data__["#id"]);t.editObject.previousSelectedObject=null;if(i)return{baseAction:"linkRemoval",link:r}}},onChunkContext:null,keyHandler:u,save:null,undo:s,redo:null},this.addEditMode(this.defaultMode)};return t.prototype.setDataModel=function(e){this.dataModel=e},t.prototype.dataChanged=function(){return this.needToSaveState?!0:this.actionsLog.length==0?!1:this.currentPtr!=this.lastSavedPtr?!0:!1},t.prototype.setEditMode=function(e){var t=this;if(e==null)e="default";else{editModeExist=!1;for(i in this.mode)if(this.mode[i].name==e){editModeExist=!0;break}editModeExist||(alert("this edition mode does not exist! switching to default mode"),e="default")}this.editMode=e,this.needToSaveState=!1,e?window.onbeforeunload=function(e){if(!t.dataChanged())return;var n="Changes made to the graph are not saved. If you leave this page all modifications will be lost.";return e=e||window.event,e&&(e.returnValue=n),n}:window.onbeforeunload=null,this.init(),this.initToolbar()},t.prototype.initToolbar=function(){function r(){var e=t.editObject;e.highlightMode=!e.highlightMode,e.highlightMode?(e.clearSelection(),t.viewer.getToolbarButton("highlight").removeClass("tab").addClass("tab_on")):t.viewer.getToolbarButton("highlight").removeClass("tab_on").addClass("tab")}function i(){var e=t.editObject;e.mode[e.editMode].save!=null&&e.mode[e.editMode].save(t)}function s(){var e=t.editObject;t.editObject.currentPtr==0&&t.viewer.getToolbarButton("undo").hide();var n=t.editObject.actionsLog[t.editObject.currentPtr];e.mode[n.mode].undo!=null&&e.mode[n.mode].undo.call(e,t,n.rollbackdata),t.editObject.currentPtr--,e.mode[n.mode].redo!=null&&t.viewer.getToolbarButton("redo").show(),e.updateSaveState()}function o(){var e=t.editObject;t.editObject.currentPtr++,t.editObject.currentPtr==t.editObject.actionsLog.length-1&&t.viewer.getToolbarButton("redo").hide();var n=t.editObject.actionsLog[t.editObject.currentPtr];e.mode[n.mode].redo!=null&&e.mode[n.mode].redo.call(e,t,n.rollbackdata),t.viewer.getToolbarButton("undo").show(),e.updateSaveState()}function u(){var n=this.getBoundingClientRect(),r={x:n.left,y:n.top+n.height+2},i="<div>";i+='Export Format : <select name="type"><option value="png">png</option><option value="json" selected>json</option><option value="depxml">depxml</option><option value="dep2pict">dep2pict</option><option value="conll">conll</option></select><br/><input id="export-data'+t.viewer.appendOwnID("")+'"  type="button" value="Export"></div>',i=jQuery(i);var s=t.viewer.createBox({closeButton:!0,autodestroy:!0});s.setContent(jQuery(i)),jQuery("#export-data"+t.viewer.appendOwnID("")).click(function(){var n=jQuery("select",this.parentNode),r=n[0].options[n[0].selectedIndex].value;r=="png"?a():(t.cleanData(),e.windowOpenPost({action:"export",data:t.data,source_format:"json",target_format:r},t.wsurl)),s.destroy()}),s.open(r)}function a(){d3.select("rect.export_bg").attr("width","100%").attr("height","100%");var n=t.svg.node().getBBox();t.svg.attr("width",n.width),t.svg.attr("height",n.height);var r=(new XMLSerializer).serializeToString(t.svg.node());e.windowOpenPost({action:"export",data:r,source_format:"json",target_format:"png"},t.wsurl),d3.select("rect.export_bg").attr("width","0").attr("height","0")}var t=this.depgraph;t.viewer.resetToolbarButtons();var n=[["save",i,"right","saved"],["undo",s,"left","undo"],["redo",o,"left","redo"],["highlight",r,"left","highlightoff"],["export",u,"right","export"]];if(this.mode[this.editMode].buttons!=null)for(button in this.mode[this.editMode].buttons)n.push(button);t.viewer.setToolbarButtons(n),(this.currentPtr<0||this.mode[this.editMode].undo==null)&&t.viewer.getToolbarButton("undo").hide(),(this.currentPtr==this.actionsLog.length-1||this.mode[this.editMode].redo==null)&&t.viewer.getToolbarButton("redo").hide()},t.prototype.setNeedToSave=function(){this.needToSaveState=!0,this.updateSaveState()},t.prototype.updateSaveState=function(){this.lastSavedPtr==this.currentPtr&&!this.needToSaveState?this.depgraph.viewer.getToolbarButton("save").removeClass("save").addClass("saved"):this.depgraph.viewer.getToolbarButton("save").removeClass("saved").addClass("save")},t.prototype.init=function(){function n(t,n,r){var i=e.editObject,n=n.menu;if(i.mode[i.editMode][t][n]!=null){var s=i.mode[i.editMode][t][n].call(this,e,r);i.pushAction({mode:i.editMode,rollbackdata:s,data:{event:"onContextClick",params:{object_type:t,menu:n,object:r}}})}}function r(t,n){var r=e.editObject;if(r.mode[r.editMode].onWordSelect!=null){var i=r.mode[r.editMode].onWordSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onWordSelect",params:{d:t,i:n}}})}}function i(t,n){var r=e.editObject;if(r.mode[r.editMode].onLinkSelect!=null){var i=r.mode[r.editMode].onLinkSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onLinkSelect",params:{d:t,i:n}}})}}function s(t,n){var r=e.editObject;if(r.mode[r.editMode].onChunkSelect!=null){var i=r.mode[r.editMode].onChunkSelect.call(this,e,{d:t,i:n});r.pushAction({mode:r.editMode,rollbackdata:i,data:{event:"onChunkSelect",params:{d:t,i:n}}})}}function o(t){var n=e.editObject;if(n.mode[n.editMode].keyHandler!=null){var r=n.mode[n.editMode].keyHandler.call(this,e,{keyCode:d3.event.keyCode});n.pushAction({mode:n.editMode,rollbackdata:r,data:{event:"keyHandler",params:{keyCode:d3.event.keyCode}}})}}var e=this.depgraph;if(!this.editMode){this.depgraph.vis.selectAll("g.word").on("click",null),this.depgraph.vis.selectAll("g.link").on("click",null),this.depgraph.vis.selectAll("g.chunk").on("click",null),d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,null),this.depgraph.viewer.resetToolbarButtons(),jQuery(".link",this.depgraph.vis.node()).contextMenu("",{}),jQuery(".word",this.depgraph.vis.node()).contextMenu("",{}),jQuery(".chunk",this.depgraph.vis.node()).contextMenu("",{});return}this.depgraph.vis.selectAll("g.word").on("click",r),this.depgraph.vis.selectAll("g.link").on("click",i),this.depgraph.vis.selectAll("g.chunk").on("click",s),d3.select(document).on("keydown.edit"+this.depgraph.viewer.uid,o);if(this.mode[this.editMode].onLinkContext!=null){var t={};for(menu in this.mode[this.editMode].onLinkContext)t[menu]={menu:menu,click:function(e){n("onLinkContext",this,e)},klass:"menu-item-1"};jQuery(".link",this.depgraph.vis.node()).contextMenu("link-context-menu",t)}if(this.mode[this.editMode].onWordContext!=null){var t={};for(menu in this.mode[this.editMode].onWordContext)t[menu]={menu:menu,click:function(e){n("onWordContext",this,e)},klass:"menu-item-1"};jQuery(".word",this.depgraph.vis.node()).contextMenu("word-context-menu",t)}if(this.mode[this.editMode].onChunkContext!=null){var t={};for(menu in this.mode[this.editMode].onChunkContext)t[menu]={menu:menu,click:function(e){n("onChunkContext",this,e)},klass:"menu-item-1"};jQuery(".chunk",this.depgraph.vis.node()).contextMenu("chunk-context-menu",t)}jQuery(this.depgraph.svg.node()).contextMenu("main-menu",{"add word":{menu:"add word",click:function(t){var n=e.viewer.screenCoordsForElt(t[0]),r={x:(n.ne.x+n.nw.x)/2,y:n.nw.y},i=jQuery(d(e));e.viewer.createBox({closeButton:!0,draggable:!0}).setContent(i).open(r)}}})},t.prototype.addEditMode=function(e){this.mode[e.name]=e},t.prototype.pushAction=function(e){if(e.rollbackdata!=null&&this.mode[e.mode].undo!=null){this.depgraph.viewer.getToolbarButton("redo").hide();var t=this.depgraph.viewer.getToolbarButton("undo");t.show(),this.actionsLog.splice(++this.currentPtr,this.actionsLog.length-this.currentPtr,e),this.updateSaveState()}},t.prototype.clearSelection=function(){if(this.previousSelectedObject!=null){try{this.previousSelectedObject.selected=!1,e.highlightObject(this.previousSelectedObject,!1)}catch(t){}this.previousSelectedObject=null}},t.prototype.selectObject=function(t){if(this.previousSelectedObject==t){this.clearSelection();return}this.clearSelection(),this.previousSelectedObject=t,e.highlightObject(this.previousSelectedObject,!0),t.selected=!0},t.prototype.changeAttributes=function(t,r,i){var s=e.clone(t),o=[];for(var u=0;u<r.length;u++){var a=n(t,r[u].path,r[u].value);o.push({path:r[u].path,value:a})}if(i!=null&&i){var f={mode:this.editMode,rollbackdata:{baseAction:"changeAttr",obj:s,attrs:r,oldAttrs:o}};this.pushAction(f)}},e.selectObject=function(e,t){return r(e,t)},e.showEditPanel=function(e,t){return a(e,t)},e.saveProperties=m,e.isALink=function(e){return C(e)},e.isAWord=function(e){return k(e)},e.isAChunk=function(e){return L(e)},e.EditObject=t,t}typeof define=="undefined"?e(depgraphlib):define("app/editobject",["app/depgraphlib"],e)}(),function(){function e(e,t,n){function i(t,n){var i=d3.select(this),s=i.node(),o=s.getStyle("font-size"),u=s.getStyle("sub-font-size"),a=s.getStyle("color"),f=s.getStyle("sub-color"),l=s.getStyle("font-weight"),c=s.getStyle("sub-font-weight"),h=s.getStyle("font-style"),p=s.getStyle("sub-font-style"),d=s.components!=null?s.components.rect:i.append("rect"),v=s.components!=null?s.components.text:i.append("text"),m=s.components!=null?s.components.label:v.append("tspan"),g=s.components!=null?s.components.sublabels:[];m.text(t.label).style("fill",a).style("font-style",h).style("font-weight",l).style("font-size",o);if(t.sublabel)for(var n=0;n<t.sublabel.length;++n){var y=null;g[n]!=null?y=g[n]:(y=v.append("tspan"),g.push(y)),y.text(t.sublabel[n]).style("font-size",u).style("font-style",p).style("font-weight",c).style("fill",f).attr("x","0px").attr("dy","1.25em")}var b="none";if(t.selected!=null||s.getStyle("highlighted",!1))b="yellow";var w=v.node().getBBox();d.attr("x",0).attr("y",w.y).attr("rx",10).attr("ry",10).attr("width",w.width).attr("height",w.height).style("stroke","transparent").style("fill",b).style("stroke-width",1);var E=r.getInstance(this),S=E.getWordNodeByPosition(i.datum()["#position"]-1),x=s.getStyle("margin");if(S!=null){var T=e.getTransformValues(d3.select(S)),w=S.getBBox(),N=e.removeUnit(e.addPxs(T.translate[0],w.width,x.right,x.left)),C=e.removeUnit(x.top);e.setGroupPosition(i,N,C)}else{var N=e.removeUnit(x.left),C=e.removeUnit(x.top);e.setGroupPosition(i,N,C)}i.node().components={text:v,label:m,rect:d,sublabels:g}}function s(t,n){var i=d3.select(this),s=r.getInstance(i.node()),o=i.node(),u=i.append("rect"),a={x:99999,y:99999},f={x:0,y:0};for(var n=0;n<t.elements.length;n++){var l=s.getWordNodeByOriginalId(t.elements[n]),c=e.getTransformValues(d3.select(l)),h={x:c.translate[0],y:c.translate[1]},p=l.getBBox();h.x+p.x<a.x&&(a.x=h.x+p.x),h.y+p.y<a.y&&(a.y=h.y+p.y),h.x+p.width+p.x>f.x&&(f.x=h.x+p.width+p.x),h.y+p.height+p.y>f.y&&(f.y=h.y+p.height+p.y)}var d=o.getStyle("margin"),v=o.getStyle("font-size"),m=o.getStyle("sub-font-size"),g=o.getStyle("color"),y=o.getStyle("sub-color"),b=o.getStyle("font-weight"),w=o.getStyle("sub-font-weight"),E=o.getStyle("font-style"),S=o.getStyle("sub-font-style"),x=o.getStyle("background-color"),T=o.getStyle("border-color"),N=o.getStyle("border-size"),C=i.append("line");C.attr("y1",e.addPxs(f.y,2*e.removeUnit(d.top))).attr("x1",0).attr("y2",e.addPxs(f.y,2*e.removeUnit(d.top))).attr("x2",f.x-a.x+e.removeUnit(d.left)+e.removeUnit(d.right)).style("stroke",T).style("stroke-width",N);var k=i.append("text");k.attr("y",e.addPxs(20,f.y,2*e.removeUnit(d.top))),k.append("tspan").text(t.label).style("fill",g).style("font-style",E).style("font-weight",b).style("font-size",v);if(t.sublabel)for(var n=0;n<t.sublabel.length;++n)var L=k.append("tspan").text(t.sublabel[n]).style("font-size",m).style("font-style",S).style("font-weight",w).style("fill",y).attr("dx",-(t.sublabel[n].length-1)*e.removeUnit(m)).attr("dy","1.25em");e.center(k,i);var A=k.node().getBBox().height;u.attr("x",0).attr("y",0).attr("rx",10).attr("ry",10).attr("width",f.x-a.x+e.removeUnit(d.left)+e.removeUnit(d.right)).attr("height",e.addPxs(f.y,-a.y,A,2*e.removeUnit(d.top),20)).style("fill",x).style("stroke",T).style("stroke-width",N),i.node().components={text:k,rect:u},e.setGroupPosition(i,a.x-e.removeUnit(d.left),a.y-e.removeUnit(d.top))}function o(t,n){var i=d3.select(this),s=r.getInstance(this),o=this,u=s.getLinkProperties(i.node()),a=o.getStyle("margin"),f=o.getStyle("font-size"),c=o.getStyle("color"),h=o.getStyle("link-color"),p=o.getStyle("link-size"),d=o.getStyle("font-weight"),v=o.getStyle("font-style"),m=o.getStyle("oriented"),g=o.getStyle("align"),y=o.getStyle("highlighted",!1),b=o.getStyle("stroke-dasharray","none"),w=!1;u.nodeStart||(u.nodeStart=u.nodeEnd,w=!0);var E=e.getNodePosition(u.nodeEnd)-e.getNodePosition(u.nodeStart)>0?1:-1,S=u.strate>0?1:-1,x=e.getTransformValues(d3.select(u.nodeStart)).translate,T=e.getTransformValues(d3.select(u.nodeEnd)).translate,N=u.nodeStart.getBBox(),C=u.nodeEnd.getBBox(),k=N.width/2,L=C.width/2,A=3,O=E>0?5*u.offsetXmin+A:-5*u.offsetXmax-A,M=E>0?-5*u.offsetXmax-A:5*u.offsetXmin+A,_=5,D=x[0]+k+O,P=T[0]+L+M,H=P-D-E*2*_;if(s.wordY==null){var B=s.vis.selectAll("g.word");s.wordY=0,s.wordHeight=0;for(var n=0;n<B[0].length;++n){var j=B[0][n].getBBox();s.wordY>j.y&&(s.wordY=j.y),s.wordHeight<j.height&&(s.wordHeight=j.height)}}var F=u.nodeStart.className.animVal=="chunk"?N.height:N.height+s.wordY,I=u.nodeEnd.className.animVal=="chunk"?C.height:C.height+s.wordY,q=u.nodeStart.className.animVal=="chunk"?0:s.wordY,R=u.nodeEnd.className.animVal=="chunk"?0:s.wordY,U=S>0?q:F,z=S>0?R:I,W=x[1]+U,X=T[1]+z,V=15,$=30,J=-S*V-$*u.strate;w&&(J=-S*V-$*S*s.maxLinksStrate);var K=-(J+W-X),Q=(1+E*S)/2,G=(1+E*S)/2,Y="transparent";y&&(Y=l(h));var Z=o.components!=null?o.components.highlightPath:i.append("path"),et=o.components!=null?o.components.path:i.append("path");w?(Z.attr("d","M "+D+","+(W+J)+" v "+ -J),et.attr("d","M "+D+","+(W+J)+" v "+ -J)):(Z.attr("d","M "+D+","+W+" v "+J+" a 5 5 0 0 "+Q+" "+E*_+" "+ -S*_+" h "+H+" a 5 5 0 0 "+G+" "+E*_+" "+S*_+" v "+K),et.attr("d","M "+D+","+W+" v "+J+" a 5 5 0 0 "+Q+" "+E*_+" "+ -S*_+" h "+H+" a 5 5 0 0 "+G+" "+E*_+" "+S*_+" v "+K)),Z.attr("stroke",Y).attr("stroke-width",e.removeUnit(p)+3).attr("fill","none"),et.attr("stroke",h).attr("stroke-dasharray",b).attr("stroke-width",p).attr("fill","none"),m&&et.attr("marker-end","url(#"+s.viewer.appendOwnID("arrow")+")");var tt=o.components!=null?o.components.label:i.append("text");tt.text(t.label).style("fill",c).style("font-weight",d).style("font-style",v).style("font-size",f);var nt=tt.node().getBBox();tt.attr("x",-nt.width/2+D+H/2+E*_).attr("y",e.removeUnit(e.addPxs(-e.removeUnit(a.top),W,J,-S*_))),o.components={highlightPath:Z,path:et,label:tt}}function u(t,n,r){if(!r&&(t.selected||t.getStyle("highlighted",!1)))return;r&&e.setStyle(t,"highlighted",n);var i=t.getStyle("link-color"),s=t.getStyle("font-weight");n!==!1?(t.components.highlightPath.attr("stroke",l(i)),t.components.label.style("font-weight","bold")):(t.components.highlightPath.attr("stroke","transparent"),t.components.label.style("font-weight",s))}function a(t,n,r){if(!r&&(t.selected||t.getStyle("highlighted",!1)))return;r&&e.setStyle(t,"highlighted",n),t.components.rect.style("fill",n?"yellow":"none")}function f(e,t,n){if(e.classList!=null&&e.classList.length>0){var r=e.classList[0];r=="link"?u(e,t,n):(r="word")&&a(e,t,n)}}function l(t){if(t=="#000000"||t.slice(0,1)!="#")return"yellow";var n=-0.3,r=e.hexToRgb(t),i=e.rgbToHsl(r.r,r.g,r.b);return i.l+=n,i.l=i.l<0?0:i.l>1?1:i.l,r=e.hslToRgb(i.h,i.s,i.l),e.rgbToHex(r.r,r.g,r.b)}var r=function(i,s,o){this.options=o||{},this.viewer=new t(i,this.options.uid),r.instances[this.viewer.uid]=this,this.callbacks=new Object,this.setData(s),this.original_data=e.clone(this.data),this.createLayout(),this.update(),this.postProcesses(),this.autoHighLightOnMouseOver(),this.viewerSettings(),this.editObject=new n(this)};return r.prototype.getOriginalUID=function(){return this.viewer.uid.replace(/_*$/g,"")},r.prototype.viewerSettings=function(){this.viewer.callbacks.fullscreen.oncomplete.push({method:this.centerGraph,caller:this}),this.viewer.callbacks.fullscreen.onclose.push({method:this.centerGraph,caller:this})},r.prototype.centerGraph=function(){var t=this.viewer.chart,n=t[0].getBoundingClientRect(),r=this.vis.node().getBBox(),i=e.getTransformValues(this.vis),s=(n.width-r.width)/2,o=(n.height-r.height)/2;o=o>0?o:e.removeUnit(this.data.graph["#style"].margin.top),s=s>0?s:e.removeUnit(this.data.graph["#style"].margin.left),this.vis.attr("transform","translate("+(s-r.x)+","+(o-r.y)+") scale("+i.scale[0]+")")},r.prototype.autoHighLightOnMouseOver=function(e){e==null||e?(this.vis.selectAll("g.link").on("mouseover.autohighlight",function(){u(this,!0)}),this.vis.selectAll("g.link").on("mouseout.autohighlight",function(){u(this,!1)}),this.vis.selectAll("g.word").on("mouseover.autohighlight",function(){a(this,!0)}),this.vis.selectAll("g.word").on("mouseout.autohighlight",function(){a(this,!1)})):(this.vis.selectAll("g.link").on("mouseover.autohighlight",null),this.vis.selectAll("g.link").on("mouseout.autohighlight",null),this.vis.selectAll("g.word").on("mouseover.autohighlight",null),this.vis.selectAll("g.word").on("mouseout.autohighlight",null))},r.instances=r.instances||[],r.getInstance=function(e){if(e){if(r.prototype.isPrototypeOf(e))return e;e.ownerSVGElement!=null?e=e.ownerSVGElement.parentNode.id:e.nodeName&&e.nodeName=="svg"?e=e.parentNode.id:typeof e=="object"&&e.id!=null&&(e=e.id),regex=/.*-(\w+)/;var t=regex.exec(e);return t!=null?r.instances[t[1]]:null}},r.prototype.setData=function(e){this.data=e,this.prepareData()},r.prototype.resetData=function(e){this.setData(e),this.createLayout(),this.update(),this.postProcesses(),this.autoHighLightOnMouseOver(),this.editObject.init()},r.prototype.cleanData=function(){var e=this.vis.selectAll("g.link");this.resetLinksProperties(e)},r.prototype.prepareData=function(){e.JSONresolveReferences(this.data,"@"),this.id=0;for(var t=0;this.data.graph.words&&t<this.data.graph.words.length;t++){var n=this.data.graph.words[t];n["#id"]=this.id++,n["#position"]=t}for(var t=0;this.data.graph.links&&t<this.data.graph.links.length;t++)this.data.graph.links[t]["#id"]=this.id++,this.data.graph.links[t]["#properties"]=null;for(var t=0;this.data.graph.chunks&&t<this.data.graph.chunks.length;t++)this.data.graph.chunks[t]["#id"]=this.id++;var r=this.data.graph["#style"]?this.data.graph["#style"]:this.data.graph["#style"]=new Object,i=this.data.graph["#word-style"]?this.data.graph["#word-style"]:this.data.graph["#word-style"]=new Object,s=this.data.graph["#link-style"]?this.data.graph["#link-style"]:this.data.graph["#link-style"]=new Object,o=this.data.graph["#chunk-style"]?this.data.graph["#chunk-style"]:this.data.graph["#chunk-style"]=new Object;r.margin=r.margin?r.margin:{top:"50px",right:"20px",bottom:"20px",left:"20px"},r.margin.top=r["margin-top"]?r["margin-top"]:r.margin.top,r.margin.right=r["margin-right"]?r["margin-right"]:r.margin.right,r.margin.left=r["margin-left"]?r["margin-left"]:r.margin.left,r.margin.bottom=r["margin-bottom"]?r["margin-bottom"]:r.margin.bottom,r["background-color"]=r["background-color"]?r["background-color"]:"white",r["font-family"]=r["font-family"]?r["font-family"]:"inherit",i.margin=i.margin?i.margin:{top:"10px",right:"15px",bottom:"10px",left:"15px"},i["sub-margin"]=i["sub-margin"]?i["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"},i["font-size"]=i["font-size"]?i["font-size"]:"14px",i["sub-font-size"]=i["sub-font-size"]?i["sub-font-size"]:"10px",i.color=i.color?i.color:"black",i["sub-color"]=i["sub-color"]?i["sub-color"]:"black",i["font-weight"]=i["font-weight"]?i["font-weight"]:"normal",i["sub-font-weight"]=i["sub-font-weight"]?i["sub-font-weight"]:"normal",i["font-style"]=i["font-style"]?i["font-style"]:"normal",i["sub-font-style"]=i["sub-font-style"]?i["sub-font-style"]:"normal",s.margin=s.margin?s.margin:{top:"5px",right:"10px",bottom:"10px",left:"10px"},s["font-size"]=s["font-size"]?s["font-size"]:"12px",s.color=s.color?s.color:"black",s["link-color"]=s["link-color"]?s["link-color"]:"#000000",s["link-size"]=s["link-size"]?s["link-size"]:"2px",s["font-weight"]=s["font-weight"]?s["font-weight"]:"normal",s["font-style"]=s["font-style"]?s["font-style"]:"normal",s.oriented=s.oriented?s.oriented:!0,s.align=s.align?s.align:"center",s.higlighted=!1,o.margin=o.margin?o.margin:{top:"10px",right:"10px",bottom:"10px",left:"10px"},o["sub-margin"]=o["sub-margin"]?o["sub-margin"]:{top:"4px",right:"4px",bottom:"4px",left:"4px"},o["font-size"]=o["font-size"]?o["font-size"]:"12px",o["sub-font-size"]=o["sub-font-size"]?o["sub-font-size"]:"10px",o["background-color"]=o["background-color"]?o["background-color"]:"transparent",o.color=o.color?o.color:"black",o["sub-color"]=o["sub-color"]?o["sub-color"]:"black",o["border-color"]=o["border-color"]?o["border-color"]:"black",o["font-weight"]=o["font-weight"]?o["font-weight"]:"normal",o["sub-font-weight"]=o["sub-font-weight"]?o["sub-font-weight"]:"normal",o["font-style"]=o["font-style"]?o["font-style"]:"normal",o["sub-font-style"]=o["sub-font-style"]?o["sub-font-style"]:"normal",o["border-size"]=o["border-size"]?o["border-size"]:"1px"},r.prototype.postProcesses=function(){var t=this.vis.node().getBBox();this.vis.attr("transform","translate("+(e.removeUnit(this.data.graph["#style"].margin.left)-t.x)+","+(e.removeUnit(this.data.graph["#style"].margin.top)-t.y)+") scale(1)"),this.setViewMode()},r.prototype.setViewMode=function(){if(this.options.viewmode&&this.options.viewmode!="full")this.setWidthLimitedViewMode("600px");else{var e=this.vis.node().getBBox();this.options.maxwidth&&this.options.maxwidth<e.width?(this.options.viewmode="cropped",this.setWidthLimitedViewMode(this.options.maxwidth,!0)):(this.options.viewmode="full",this.setFullViewMode())}},r.prototype.setFullViewMode=function(){this.viewer.shrinkToContent(e.removeUnit(this.data.graph["#style"].margin.right),e.removeUnit(this.data.graph["#style"].margin.bottom)+20)},r.prototype.setWidthLimitedViewMode=function(t,n){this.viewer.shrinkHeightToContent(e.removeUnit(this.data.graph["#style"].margin.bottom)+20),this.options.viewsize||(this.options.viewsize=t),this.viewer.setWidth(this.options.viewsize);if(n||this.options.viewmode=="cropped")this.createScrollBar();else{var r=this.vis.node().getBBox(),i=this.viewer.chart.width()/(r.width+e.removeUnit(this.data.graph["#style"].margin.right)*2);this.scale(i),this.viewer.shrinkHeightToContent(e.removeUnit(this.data.graph["#style"].margin.bottom)+20)}},r.prototype.createScrollBar=function(){var t=this,n=this.vis.node().getBBox(),i=n.width+2*e.removeUnit(this.data.graph["#style"].margin.right),s=this.viewer.mainpanel.width();if(i>s){var o=2*s-i,u=1;o<=0&&(o=20,u=(i-s)/(s-o)),this.scrollbar=this.svg.select(".scrollbar"),this.scrollbar.node()==null&&(this.scrollbar=this.svg.append("rect").classed("scrollbar",!0)),this.scrollbar.attr("x",0).attr("y",this.viewer.mainpanel.height()-40).attr("rx",1).attr("ry",1).attr("width",o).attr("height",5).style("stroke","grey").style("fill","lightgrey").style("stroke-width",1).__info__={maxX:s-o,k:u},this.scrollMouseSelected=null,this.scrollbar.on("mousedown",function(e){var t=r.getInstance(this);r.depgraphActive="-"+t.viewer.uid,t.scrollMouseSelected=d3.event.clientX,d3.event.preventDefault?d3.event.preventDefault():d3.event.returnValue=!1}),d3.select(document).on("click.focus",function(e){var t=r.getInstance(d3.event.originalTarget);t?r.depgraphActive="-"+t.viewer.uid:r.depgraphActive=null}),d3.select(document).on("wheel.scrollbar",function(e){var t=r.getInstance(r.depgraphActive);t&&t.scrollbar&&(t.translateGraph(3*d3.event.deltaY,0),d3.event.preventDefault?d3.event.preventDefault():d3.event.returnValue=!1)}),d3.select(document).on("mousemove.scrollbar"+t.viewer.uid,function(e){var t=r.getInstance(r.depgraphActive);if(t&&(t.scrollMouseSelected||t.scrollMouseSelected===0)){var n=d3.event.clientX-t.scrollMouseSelected;t.scrollbar&&(n*=t.scrollbar.__info__.k),t.translateGraph(n,0),t.scrollMouseSelected=d3.event.clientX}}),d3.select(document).on("mouseup.scrollbar"+t.viewer.uid,function(e){var t=r.getInstance(r.depgraphActive);t&&(t.scrollMouseSelected=null)})}d3.select(document).on("keydown.move"+t.viewer.uid,function(e){var t=10;if(r.depgraphActive){var n=r.getInstance(r.depgraphActive);d3.event.keyCode==37?n.translateGraph(-t,0):d3.event.keyCode==39&&n.translateGraph(t,0)}})},r.prototype.createLayout=function(){this.svg!=null&&this.svg.remove(),this.svg=d3.select(this.viewer.chart[0]).append("svg").attr("width","100%").attr("height","100%").style("margin-top","30px"),this.viewer.chart.css("background-color",this.data.graph["#style"]["background-color"]),this.svg.append("rect").classed("export_bg",!0).attr("width","0").attr("height","0").style("fill",this.data.graph["#style"]["background-color"]),this.setSVGDefs(),this.vis=this.svg.append("g").attr("transform","translate("+e.removeUnit(this.data.graph["#style"].margin.left)+","+e.removeUnit(this.data.graph["#style"].margin.top)+") scale(1)")},r.prototype.scale=function(t){var n=r.getInstance(this),i=e.getTransformValues(n.vis);n.vis.attr("transform","translate("+i.translate[0]*t+","+i.translate[1]*t+")"+" scale("+t+")")},r.prototype.translateGraph=function(t,n){var i=r.getInstance(this),s=e.getTransformValues(i.vis);if(i.scrollbar){var o=parseFloat(i.scrollbar.attr("x")),u=t/i.scrollbar.__info__.k;i.scrollbar.__info__.maxX<o+u?u=i.scrollbar.__info__.maxX-o:o+u<0&&(u=-o),t=i.scrollbar.__info__.k*u,i.scrollbar.attr("x",o+u)}i.vis.attr("transform","translate("+(s.translate[0]-t)+","+(s.translate[1]-n)+")"+" scale("+s.scale[0]+")")},r.prototype.update=function(){var e,t;this.data.graph.chunks!=null&&(e=this.chunks=this.vis.selectAll("g.chunk").data(this.data.graph.chunks,function(e){return e["#id"]}),t=e.enter().append("g").classed("chunk",!0));var n=this.words=this.vis.selectAll("g.word").data(this.data.graph.words,function(e){return e["#id"]}),r=n.enter().append("g").classed("word",!0),u=n.exit();u.remove(),n.each(i),this.data.graph.chunks!=null&&t.each(s);var a=this.links=this.vis.selectAll("g.link").data(this.data.graph.links,function(e){return e["#id"]}),f=a.enter().append("g").classed("link",!0),l=a.exit();l.remove(),this.resetLinksProperties(a),this.preprocessLinksPosition(a),a.each(o)},r.prototype.insertWord=function(e,t){e["#id"]==null&&(e["#id"]=this.id++),e["id"]==null&&(e.id="_w"+e["#id"]),this.data.graph.words.splice(t,0,e);for(var n=t+1;n<this.data.graph.words.length;++n)this.data.graph.words[n]["#position"]++;this.update(),this.postProcesses()},r.prototype.addLink=function(e){e["#id"]==null&&(e["#id"]=this.id++),this.data.graph.links.push(e),this.update(),this.postProcesses()},r.prototype.addChunk=function(e){},r.prototype.removeWord=function(t){var n=[],r=this.getWordIndexById(t);if(r==null)return!1;var i=this.data.graph.words[r]["#position"],s=this.data.graph.words[r].id;this.data.graph.words.splice(r,1);for(var o=i;o<this.data.graph.words.length;++o)this.data.graph.words[o]["#position"]--;for(var o=0;o<this.data.graph.links.length;o++){var u=this.data.graph.links[o];if(u.source==s||u.target==s)n.push(e.clone(u)),this.data.graph.links.splice(o,1),o--}return this.update(),this.postProcesses(),n},r.prototype.removeLink=function(e){var t=this.getLinkIndexById(e);return t==null?!1:(this.data.graph.links.splice(t,1),this.update(),this.postProcesses(),!0)},r.prototype.removeChunk=function(e){},r.prototype.getWordNodeByPosition=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++)if(t[0][n].__data__["#position"]==e)return t[0][n];return null},r.prototype.getWordNodeByOriginalId=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++)if(t[0][n].__data__["id"]==e)return t[0][n]},r.prototype.getChunkNodeByOriginalId=function(e){var t=this.vis.selectAll("g.chunk");for(var n=0;n<t[0].length;n++)if(t[0][n].__data__["id"]==e)return t[0][n]},r.prototype.getWordNodeById=function(e){var t=this.vis.selectAll("g.word");for(var n=0;n<t[0].length;n++)if(t[0][n].__data__["#id"]==e)return t[0][n]},r.prototype.getWordIndexById=function(e){for(var t in this.data.graph.words)if(this.data.graph.words[t]["#id"]==e)return t},r.prototype.getLinkById=function(e){for(var t in this.data.graph.links)if(this.data.graph.links[t]["#id"]==e)return this.data.graph.links[t]},r.prototype.getLinkIndexById=function(e){for(var t in this.data.graph.links)if(this.data.graph.links[t]["#id"]==e)return t},r.prototype.getLinkIndexByOriginalId=function(e){for(var t in this.data.graph.links)if(this.data.graph.links[t].id==e)return t},r.prototype.getObjectById=function(e){for(var t in this.data.graph.words)if(this.data.graph.words[t]["#id"]==e)return this.data.graph.words[t];for(var t in this.data.graph.links)if(this.data.graph.links[t]["#id"]==e)return this.data.graph.links[t];for(var t in this.data.graph.chunks)if(this.data.graph.chunks[t]["#id"]==e)return this.data.graph.chunks[t]},r.prototype.getObjectNodeFromObject=function(e){},e.getStyleElement=function(e,t,n){return e.__data__["#style"]!=null&&e.__data__["#style"][t]!=null?e.__data__["#style"][t]:n},SVGElement.prototype.getStyle=function(e,t){var n=r.getInstance(this);if(this.__data__["#style"]!=null&&this.__data__["#style"][e]!=null)return this.__data__["#style"][e];var i=null;return this.className!=null&&(i=n.data.graph["#"+this.className.animVal+"-style"][e]),i==null&&t!=null?t:i},e.setStyle=function(e,t,n){e.__data__["#style"]==null&&(e.__data__["#style"]={}),n?e.__data__["#style"][t]=n:delete e.__data__["#style"][t]},e.highlightObject=function(e,t,n){return f(e,t,n)},e.isObjectPermanentHighlighted=function(e){return e.getStyle("highlighted",!1)},r.prototype.setSVGDefs=function(){this.defs=this.svg.append("defs"),this.defs.append("marker").attr("id",this.viewer.appendOwnID("arrow")).attr("viewBox","0 0 10 10").attr("refX","8").attr("refY","5").attr("markerUnits","strokeWidth").attr("orient","auto").attr("markerWidth","3").attr("markerHeight","3").append("polyline").attr("points","0,0 10,5 0,10 1,5")},e.getNodePosition=function(e){if(e){if(e.__data__["#position"]!=null)return e.__data__["#position"];var t=r.getInstance(e),n=Math.floor(e.__data__.elements.length/2),i=t.getWordNodeByOriginalId(e.__data__.elements[n]);return i.__data__["#position"]}return-1},e.DepGraph=r,r}typeof define=="undefined"?e(depgraphlib,depgraphlib.GraphViewer,depgraphlib.EditObject):define("app/graphlayout",["app/depgraphlib","app/graphviewer","app/editobject"],e)}(),function(){function e(e,t){function n(t,n){return e.getNodePosition(t)*2<n.min*2||e.getNodePosition(t)*2>n.max*2}function r(t,n){return e.getNodePosition(t)*2>n.min*2&&e.getNodePosition(t)*2<n.max*2}t.prototype.crossed=function(e,t){var i=this.getLinkProperties(e),s=this.getLinkProperties(t);return r(i.nodeStart,s)&&n(i.nodeEnd,s)||r(i.nodeEnd,s)&&n(i.nodeStart,s)},t.prototype.preprocessLinksPosition=function(e){function d(e){var n=Math.abs(e);t.maxLinksStrate=t.maxLinksStrate<n?n:t.maxLinksStrate}var t=this;this.sortLinksByLength(e[0]);var n=e[0].length,r=[];for(var i=0;i<n;++i){var s=e[0][i],o=this.getLinkProperties(s),u=1;for(;;){if(r[u]==null){r[u]=new Array;for(var a=o.min*2;a<o.max*2;a++)r[u][a]=s;o.strate=u,d(u);break}var f=null;for(var a=o.min*2;a<o.max*2;a++)if(r[u][a]!=null){f=r[u][a];if(this.crossed(s,f))break}if(f==null){for(var a=o.min*2;a<o.max*2;a++)r[u][a]=s;o.strate=u,d(u);break}if(this.crossed(s,f)){u=-1;for(;;){if(r[u]==null){r[u]=new Array;for(var a=o.min*2;a<o.max*2;a++)r[u][a]=s;o.strate=u,d(u);break}var l=null;for(var a=o.min*2;a<o.max*2;a++)if(r[u][a]!=null){l=r[u][a];break}if(l==null){for(var a=o.min*2;a<o.max*2;a++)r[u][a]=s;o.strate=u,d(u);break}u--}break}u++}}for(var i=0;i<n;i++){var s=e[0][i],o=this.getLinkProperties(s),c;o.strate>0?c=-1:c=1;for(var u=o.strate;u!=0;u+=c){var h=r[u][o.min*2];if(h!=null&&h!=s){var p=this.getLinkProperties(h);p.min==o.min&&p.offsetXmin++}h=r[u][o.max*2-1];if(h!=null&&h!=s){var p=this.getLinkProperties(h);p.max==o.max&&p.offsetXmax++}}}},t.prototype.sortLinksByLength=function(e){var t=this;e.sort(function(e,n){return t.getLinkProperties(e).length-t.getLinkProperties(n).length})},t.prototype.getLinkProperties=function(t){var n=t.__data__;if(n["#properties"]==null){var r=new Object;r.nodeStart=this.getWordNodeByOriginalId(n.source),r.nodeStart==null&&(r.nodeStart=this.getChunkNodeByOriginalId(n.source)),r.nodeEnd=this.getWordNodeByOriginalId(n.target),r.nodeEnd==null&&(r.nodeEnd=this.getChunkNodeByOriginalId(n.target)),e.getNodePosition(r.nodeStart)<e.getNodePosition(r.nodeEnd)?(r.min=e.getNodePosition(r.nodeStart),r.max=e.getNodePosition(r.nodeEnd),r.hdir=1):(r.max=e.getNodePosition(r.nodeStart),r.min=e.getNodePosition(r.nodeEnd),r.hdir=-1),r.vdir=1,r.offsetXmax=0,r.offsetXmin=0,r.strate=0,r.length=r.max-r.min,r.nodeStart||(r.length=0),r.outer=0,n["#properties"]=r}return n["#properties"]},t.prototype.resetLinksProperties=function(e){e.each(function(e,t){e["#properties"]=null}),this.maxLinksStrate=0}}typeof define=="undefined"?e(depgraphlib,depgraphlib.DepGraph):define("app/anticross",["app/depgraphlib","app/graphlayout"],e)}(),require(["app/anticross","app/editobject","app/graphlayout","app/graphviewer","app/depgraphlib"],function(e,t,n,r,i){return i}),define("base.depgraph.main",function(){});